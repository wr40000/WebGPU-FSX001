var Fo=Object.defineProperty;var Go=(n,t,e)=>t in n?Fo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var it=(n,t,e)=>(Go(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();let ft=1e-6;const Ro=new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]);Ro.get(Float32Array);let I=Float32Array;function Lo(n){const t=I;return I=n,t}function Mt(n,t,e){const r=new I(3);return n!==void 0&&(r[0]=n,t!==void 0&&(r[1]=t,e!==void 0&&(r[2]=e))),r}const ko=Mt;function Vo(n,t,e,r){return r=r||new I(3),r[0]=n,r[1]=t,r[2]=e,r}function No(n,t){return t=t||new I(3),t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t}function Io(n,t){return t=t||new I(3),t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t}function Do(n,t){return t=t||new I(3),t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t}function $o(n,t=0,e=1,r){return r=r||new I(3),r[0]=Math.min(e,Math.max(t,n[0])),r[1]=Math.min(e,Math.max(t,n[1])),r[2]=Math.min(e,Math.max(t,n[2])),r}function qo(n,t,e){return e=e||new I(3),e[0]=n[0]+t[0],e[1]=n[1]+t[1],e[2]=n[2]+t[2],e}function Xo(n,t,e,r){return r=r||new I(3),r[0]=n[0]+t[0]*e,r[1]=n[1]+t[1]*e,r[2]=n[2]+t[2]*e,r}function Ho(n,t){const e=n[0],r=n[1],i=n[2],o=n[0],s=n[1],a=n[2],c=Math.sqrt(e*e+r*r+i*i),u=Math.sqrt(o*o+s*s+a*a),h=c*u,l=h&&wi(n,t)/h;return Math.acos(l)}function nn(n,t,e){return e=e||new I(3),e[0]=n[0]-t[0],e[1]=n[1]-t[1],e[2]=n[2]-t[2],e}const Wo=nn;function Yo(n,t){return Math.abs(n[0]-t[0])<ft&&Math.abs(n[1]-t[1])<ft&&Math.abs(n[2]-t[2])<ft}function jo(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function Jo(n,t,e,r){return r=r||new I(3),r[0]=n[0]+e*(t[0]-n[0]),r[1]=n[1]+e*(t[1]-n[1]),r[2]=n[2]+e*(t[2]-n[2]),r}function Zo(n,t,e,r){return r=r||new I(3),r[0]=n[0]+e[0]*(t[0]-n[0]),r[1]=n[1]+e[1]*(t[1]-n[1]),r[2]=n[2]+e[2]*(t[2]-n[2]),r}function Qo(n,t,e){return e=e||new I(3),e[0]=Math.max(n[0],t[0]),e[1]=Math.max(n[1],t[1]),e[2]=Math.max(n[2],t[2]),e}function Ko(n,t,e){return e=e||new I(3),e[0]=Math.min(n[0],t[0]),e[1]=Math.min(n[1],t[1]),e[2]=Math.min(n[2],t[2]),e}function vi(n,t,e){return e=e||new I(3),e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t,e}const ts=vi;function es(n,t,e){return e=e||new I(3),e[0]=n[0]/t,e[1]=n[1]/t,e[2]=n[2]/t,e}function bi(n,t){return t=t||new I(3),t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t}const ns=bi;function le(n,t,e){e=e||new I(3);const r=n[2]*t[0]-n[0]*t[2],i=n[0]*t[1]-n[1]*t[0];return e[0]=n[1]*t[2]-n[2]*t[1],e[1]=r,e[2]=i,e}function wi(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Mi(n){const t=n[0],e=n[1],r=n[2];return Math.sqrt(t*t+e*e+r*r)}const rs=Mi;function Si(n){const t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}const is=Si;function Ai(n,t){const e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return Math.sqrt(e*e+r*r+i*i)}const os=Ai;function Pi(n,t){const e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return e*e+r*r+i*i}const ss=Pi;function Gt(n,t){t=t||new I(3);const e=n[0],r=n[1],i=n[2],o=Math.sqrt(e*e+r*r+i*i);return o>1e-5?(t[0]=e/o,t[1]=r/o,t[2]=i/o):(t[0]=0,t[1]=0,t[2]=0),t}function as(n,t){return t=t||new I(3),t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function zi(n,t){return t=t||new I(3),t[0]=n[0],t[1]=n[1],t[2]=n[2],t}const cs=zi;function Ci(n,t,e){return e=e||new I(3),e[0]=n[0]*t[0],e[1]=n[1]*t[1],e[2]=n[2]*t[2],e}const us=Ci;function Ti(n,t,e){return e=e||new I(3),e[0]=n[0]/t[0],e[1]=n[1]/t[1],e[2]=n[2]/t[2],e}const hs=Ti;function ls(n=1,t){t=t||new I(3);const e=Math.random()*2*Math.PI,r=Math.random()*2-1,i=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(e)*i,t[1]=Math.sin(e)*i,t[2]=r*n,t}function fs(n){return n=n||new I(3),n[0]=0,n[1]=0,n[2]=0,n}function ps(n,t,e){e=e||new I(3);const r=n[0],i=n[1],o=n[2],s=t[3]*r+t[7]*i+t[11]*o+t[15]||1;return e[0]=(t[0]*r+t[4]*i+t[8]*o+t[12])/s,e[1]=(t[1]*r+t[5]*i+t[9]*o+t[13])/s,e[2]=(t[2]*r+t[6]*i+t[10]*o+t[14])/s,e}function ms(n,t,e){e=e||new I(3);const r=n[0],i=n[1],o=n[2];return e[0]=r*t[0*4+0]+i*t[1*4+0]+o*t[2*4+0],e[1]=r*t[0*4+1]+i*t[1*4+1]+o*t[2*4+1],e[2]=r*t[0*4+2]+i*t[1*4+2]+o*t[2*4+2],e}function ys(n,t,e){e=e||new I(3);const r=n[0],i=n[1],o=n[2];return e[0]=r*t[0]+i*t[4]+o*t[8],e[1]=r*t[1]+i*t[5]+o*t[9],e[2]=r*t[2]+i*t[6]+o*t[10],e}function ds(n,t,e){e=e||new I(3);const r=t[0],i=t[1],o=t[2],s=t[3]*2,a=n[0],c=n[1],u=n[2],h=i*u-o*c,l=o*a-r*u,f=r*c-i*a;return e[0]=a+h*s+(i*f-o*l)*2,e[1]=c+l*s+(o*h-r*f)*2,e[2]=u+f*s+(r*l-i*h)*2,e}function gs(n,t){return t=t||new I(3),t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function xs(n,t,e){e=e||new I(3);const r=t*4;return e[0]=n[r+0],e[1]=n[r+1],e[2]=n[r+2],e}function _s(n,t){t=t||new I(3);const e=n[0],r=n[1],i=n[2],o=n[4],s=n[5],a=n[6],c=n[8],u=n[9],h=n[10];return t[0]=Math.sqrt(e*e+r*r+i*i),t[1]=Math.sqrt(o*o+s*s+a*a),t[2]=Math.sqrt(c*c+u*u+h*h),t}var te=Object.freeze({__proto__:null,create:Mt,setDefaultType:Lo,fromValues:ko,set:Vo,ceil:No,floor:Io,round:Do,clamp:$o,add:qo,addScaled:Xo,angle:Ho,subtract:nn,sub:Wo,equalsApproximately:Yo,equals:jo,lerp:Jo,lerpV:Zo,max:Qo,min:Ko,mulScalar:vi,scale:ts,divScalar:es,inverse:bi,invert:ns,cross:le,dot:wi,length:Mi,len:rs,lengthSq:Si,lenSq:is,distance:Ai,dist:os,distanceSq:Pi,distSq:ss,normalize:Gt,negate:as,copy:zi,clone:cs,multiply:Ci,mul:us,divide:Ti,div:hs,random:ls,zero:fs,transformMat4:ps,transformMat4Upper3x3:ms,transformMat3:ys,transformQuat:ds,getTranslation:gs,getAxis:xs,getScaling:_s});let D=Float32Array;function vs(n){const t=D;return D=n,t}function bs(n,t,e,r,i,o,s,a,c,u,h,l,f,p,m,d){const y=new D(16);return n!==void 0&&(y[0]=n,t!==void 0&&(y[1]=t,e!==void 0&&(y[2]=e,r!==void 0&&(y[3]=r,i!==void 0&&(y[4]=i,o!==void 0&&(y[5]=o,s!==void 0&&(y[6]=s,a!==void 0&&(y[7]=a,c!==void 0&&(y[8]=c,u!==void 0&&(y[9]=u,h!==void 0&&(y[10]=h,l!==void 0&&(y[11]=l,f!==void 0&&(y[12]=f,p!==void 0&&(y[13]=p,m!==void 0&&(y[14]=m,d!==void 0&&(y[15]=d)))))))))))))))),y}function ws(n,t,e,r,i,o,s,a,c,u,h,l,f,p,m,d,y){return y=y||new D(16),y[0]=n,y[1]=t,y[2]=e,y[3]=r,y[4]=i,y[5]=o,y[6]=s,y[7]=a,y[8]=c,y[9]=u,y[10]=h,y[11]=l,y[12]=f,y[13]=p,y[14]=m,y[15]=d,y}function Ms(n,t){return t=t||new D(16),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=0,t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=0,t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ss(n,t){t=t||new D(16);const e=n[0],r=n[1],i=n[2],o=n[3],s=e+e,a=r+r,c=i+i,u=e*s,h=r*s,l=r*a,f=i*s,p=i*a,m=i*c,d=o*s,y=o*a,g=o*c;return t[0]=1-l-m,t[1]=h+g,t[2]=f-y,t[3]=0,t[4]=h-g,t[5]=1-u-m,t[6]=p+d,t[7]=0,t[8]=f+y,t[9]=p-d,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function As(n,t){return t=t||new D(16),t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=-n[7],t[8]=-n[8],t[9]=-n[9],t[10]=-n[10],t[11]=-n[11],t[12]=-n[12],t[13]=-n[13],t[14]=-n[14],t[15]=-n[15],t}function ar(n,t){return t=t||new D(16),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}const Ps=ar;function zs(n,t){return Math.abs(n[0]-t[0])<ft&&Math.abs(n[1]-t[1])<ft&&Math.abs(n[2]-t[2])<ft&&Math.abs(n[3]-t[3])<ft&&Math.abs(n[4]-t[4])<ft&&Math.abs(n[5]-t[5])<ft&&Math.abs(n[6]-t[6])<ft&&Math.abs(n[7]-t[7])<ft&&Math.abs(n[8]-t[8])<ft&&Math.abs(n[9]-t[9])<ft&&Math.abs(n[10]-t[10])<ft&&Math.abs(n[11]-t[11])<ft&&Math.abs(n[12]-t[12])<ft&&Math.abs(n[13]-t[13])<ft&&Math.abs(n[14]-t[14])<ft&&Math.abs(n[15]-t[15])<ft}function Cs(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]}function Ei(n){return n=n||new D(16),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ts(n,t){if(t=t||new D(16),t===n){let x;return x=n[1],n[1]=n[4],n[4]=x,x=n[2],n[2]=n[8],n[8]=x,x=n[3],n[3]=n[12],n[12]=x,x=n[6],n[6]=n[9],n[9]=x,x=n[7],n[7]=n[13],n[13]=x,x=n[11],n[11]=n[14],n[14]=x,t}const e=n[0*4+0],r=n[0*4+1],i=n[0*4+2],o=n[0*4+3],s=n[1*4+0],a=n[1*4+1],c=n[1*4+2],u=n[1*4+3],h=n[2*4+0],l=n[2*4+1],f=n[2*4+2],p=n[2*4+3],m=n[3*4+0],d=n[3*4+1],y=n[3*4+2],g=n[3*4+3];return t[0]=e,t[1]=s,t[2]=h,t[3]=m,t[4]=r,t[5]=a,t[6]=l,t[7]=d,t[8]=i,t[9]=c,t[10]=f,t[11]=y,t[12]=o,t[13]=u,t[14]=p,t[15]=g,t}function Bi(n,t){t=t||new D(16);const e=n[0*4+0],r=n[0*4+1],i=n[0*4+2],o=n[0*4+3],s=n[1*4+0],a=n[1*4+1],c=n[1*4+2],u=n[1*4+3],h=n[2*4+0],l=n[2*4+1],f=n[2*4+2],p=n[2*4+3],m=n[3*4+0],d=n[3*4+1],y=n[3*4+2],g=n[3*4+3],x=f*g,_=y*p,v=c*g,w=y*u,M=c*p,A=f*u,T=i*g,U=y*o,C=i*p,O=f*o,B=i*u,E=c*o,z=h*d,F=m*l,G=s*d,k=m*a,L=s*l,$=h*a,X=e*d,Y=m*r,ut=e*l,mt=h*r,ct=e*a,V=s*r,Lt=x*a+w*l+M*d-(_*a+v*l+A*d),$t=_*r+T*l+O*d-(x*r+U*l+C*d),qt=v*r+U*a+B*d-(w*r+T*a+E*d),Xt=A*r+C*a+E*l-(M*r+O*a+B*l),N=1/(e*Lt+s*$t+h*qt+m*Xt);return t[0]=N*Lt,t[1]=N*$t,t[2]=N*qt,t[3]=N*Xt,t[4]=N*(_*s+v*h+A*m-(x*s+w*h+M*m)),t[5]=N*(x*e+U*h+C*m-(_*e+T*h+O*m)),t[6]=N*(w*e+T*s+E*m-(v*e+U*s+B*m)),t[7]=N*(M*e+O*s+B*h-(A*e+C*s+E*h)),t[8]=N*(z*u+k*p+L*g-(F*u+G*p+$*g)),t[9]=N*(F*o+X*p+mt*g-(z*o+Y*p+ut*g)),t[10]=N*(G*o+Y*u+ct*g-(k*o+X*u+V*g)),t[11]=N*($*o+ut*u+V*p-(L*o+mt*u+ct*p)),t[12]=N*(G*f+$*y+F*c-(L*y+z*c+k*f)),t[13]=N*(ut*y+z*i+Y*f-(X*f+mt*y+F*i)),t[14]=N*(X*c+V*y+k*i-(ct*y+G*i+Y*c)),t[15]=N*(ct*f+L*i+mt*c-(ut*c+V*f+$*i)),t}function Es(n){const t=n[0],e=n[0*4+1],r=n[0*4+2],i=n[0*4+3],o=n[1*4+0],s=n[1*4+1],a=n[1*4+2],c=n[1*4+3],u=n[2*4+0],h=n[2*4+1],l=n[2*4+2],f=n[2*4+3],p=n[3*4+0],m=n[3*4+1],d=n[3*4+2],y=n[3*4+3],g=l*y,x=d*f,_=a*y,v=d*c,w=a*f,M=l*c,A=r*y,T=d*i,U=r*f,C=l*i,O=r*c,B=a*i,E=g*s+v*h+w*m-(x*s+_*h+M*m),z=x*e+A*h+C*m-(g*e+T*h+U*m),F=_*e+T*s+O*m-(v*e+A*s+B*m),G=M*e+U*s+B*h-(w*e+C*s+O*h);return t*E+o*z+u*F+p*G}const Bs=Bi;function Oi(n,t,e){e=e||new D(16);const r=n[0],i=n[1],o=n[2],s=n[3],a=n[4+0],c=n[4+1],u=n[4+2],h=n[4+3],l=n[8+0],f=n[8+1],p=n[8+2],m=n[8+3],d=n[12+0],y=n[12+1],g=n[12+2],x=n[12+3],_=t[0],v=t[1],w=t[2],M=t[3],A=t[4+0],T=t[4+1],U=t[4+2],C=t[4+3],O=t[8+0],B=t[8+1],E=t[8+2],z=t[8+3],F=t[12+0],G=t[12+1],k=t[12+2],L=t[12+3];return e[0]=r*_+a*v+l*w+d*M,e[1]=i*_+c*v+f*w+y*M,e[2]=o*_+u*v+p*w+g*M,e[3]=s*_+h*v+m*w+x*M,e[4]=r*A+a*T+l*U+d*C,e[5]=i*A+c*T+f*U+y*C,e[6]=o*A+u*T+p*U+g*C,e[7]=s*A+h*T+m*U+x*C,e[8]=r*O+a*B+l*E+d*z,e[9]=i*O+c*B+f*E+y*z,e[10]=o*O+u*B+p*E+g*z,e[11]=s*O+h*B+m*E+x*z,e[12]=r*F+a*G+l*k+d*L,e[13]=i*F+c*G+f*k+y*L,e[14]=o*F+u*G+p*k+g*L,e[15]=s*F+h*G+m*k+x*L,e}const Os=Oi;function Us(n,t,e){return e=e||Ei(),n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11]),e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Fs(n,t){return t=t||Mt(),t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function Gs(n,t,e){e=e||Mt();const r=t*4;return e[0]=n[r+0],e[1]=n[r+1],e[2]=n[r+2],e}function Rs(n,t,e,r){r!==n&&(r=ar(n,r));const i=e*4;return r[i+0]=t[0],r[i+1]=t[1],r[i+2]=t[2],r}function Ls(n,t){t=t||Mt();const e=n[0],r=n[1],i=n[2],o=n[4],s=n[5],a=n[6],c=n[8],u=n[9],h=n[10];return t[0]=Math.sqrt(e*e+r*r+i*i),t[1]=Math.sqrt(o*o+s*s+a*a),t[2]=Math.sqrt(c*c+u*u+h*h),t}function ks(n,t,e,r,i){i=i||new D(16);const o=Math.tan(Math.PI*.5-.5*n);if(i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,r===1/0)i[10]=-1,i[14]=-e;else{const s=1/(e-r);i[10]=r*s,i[14]=r*e*s}return i}function Vs(n,t,e,r,i,o,s){return s=s||new D(16),s[0]=2/(t-n),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(r-e),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1/(i-o),s[11]=0,s[12]=(t+n)/(n-t),s[13]=(r+e)/(e-r),s[14]=i/(i-o),s[15]=1,s}function Ns(n,t,e,r,i,o,s){s=s||new D(16);const a=t-n,c=r-e,u=i-o;return s[0]=2*i/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*i/c,s[6]=0,s[7]=0,s[8]=(n+t)/a,s[9]=(r+e)/c,s[10]=o/u,s[11]=-1,s[12]=0,s[13]=0,s[14]=i*o/u,s[15]=0,s}let J,et,H;function Is(n,t,e,r){return r=r||new D(16),J=J||Mt(),et=et||Mt(),H=H||Mt(),Gt(nn(t,n,H),H),Gt(le(e,H,J),J),Gt(le(H,J,et),et),r[0]=J[0],r[1]=J[1],r[2]=J[2],r[3]=0,r[4]=et[0],r[5]=et[1],r[6]=et[2],r[7]=0,r[8]=H[0],r[9]=H[1],r[10]=H[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function Ds(n,t,e,r){return r=r||new D(16),J=J||Mt(),et=et||Mt(),H=H||Mt(),Gt(nn(n,t,H),H),Gt(le(e,H,J),J),Gt(le(H,J,et),et),r[0]=J[0],r[1]=J[1],r[2]=J[2],r[3]=0,r[4]=et[0],r[5]=et[1],r[6]=et[2],r[7]=0,r[8]=H[0],r[9]=H[1],r[10]=H[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function $s(n,t,e,r){return r=r||new D(16),J=J||Mt(),et=et||Mt(),H=H||Mt(),Gt(nn(n,t,H),H),Gt(le(e,H,J),J),Gt(le(H,J,et),et),r[0]=J[0],r[1]=et[0],r[2]=H[0],r[3]=0,r[4]=J[1],r[5]=et[1],r[6]=H[1],r[7]=0,r[8]=J[2],r[9]=et[2],r[10]=H[2],r[11]=0,r[12]=-(J[0]*n[0]+J[1]*n[1]+J[2]*n[2]),r[13]=-(et[0]*n[0]+et[1]*n[1]+et[2]*n[2]),r[14]=-(H[0]*n[0]+H[1]*n[1]+H[2]*n[2]),r[15]=1,r}function qs(n,t){return t=t||new D(16),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Xs(n,t,e){e=e||new D(16);const r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],c=n[2],u=n[3],h=n[1*4+0],l=n[1*4+1],f=n[1*4+2],p=n[1*4+3],m=n[2*4+0],d=n[2*4+1],y=n[2*4+2],g=n[2*4+3],x=n[3*4+0],_=n[3*4+1],v=n[3*4+2],w=n[3*4+3];return n!==e&&(e[0]=s,e[1]=a,e[2]=c,e[3]=u,e[4]=h,e[5]=l,e[6]=f,e[7]=p,e[8]=m,e[9]=d,e[10]=y,e[11]=g),e[12]=s*r+h*i+m*o+x,e[13]=a*r+l*i+d*o+_,e[14]=c*r+f*i+y*o+v,e[15]=u*r+p*i+g*o+w,e}function Hs(n,t){t=t||new D(16);const e=Math.cos(n),r=Math.sin(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ws(n,t,e){e=e||new D(16);const r=n[4],i=n[5],o=n[6],s=n[7],a=n[8],c=n[9],u=n[10],h=n[11],l=Math.cos(t),f=Math.sin(t);return e[4]=l*r+f*a,e[5]=l*i+f*c,e[6]=l*o+f*u,e[7]=l*s+f*h,e[8]=l*a-f*r,e[9]=l*c-f*i,e[10]=l*u-f*o,e[11]=l*h-f*s,n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function Ys(n,t){t=t||new D(16);const e=Math.cos(n),r=Math.sin(n);return t[0]=e,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function js(n,t,e){e=e||new D(16);const r=n[0*4+0],i=n[0*4+1],o=n[0*4+2],s=n[0*4+3],a=n[2*4+0],c=n[2*4+1],u=n[2*4+2],h=n[2*4+3],l=Math.cos(t),f=Math.sin(t);return e[0]=l*r-f*a,e[1]=l*i-f*c,e[2]=l*o-f*u,e[3]=l*s-f*h,e[8]=l*a+f*r,e[9]=l*c+f*i,e[10]=l*u+f*o,e[11]=l*h+f*s,n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function Js(n,t){t=t||new D(16);const e=Math.cos(n),r=Math.sin(n);return t[0]=e,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Zs(n,t,e){e=e||new D(16);const r=n[0*4+0],i=n[0*4+1],o=n[0*4+2],s=n[0*4+3],a=n[1*4+0],c=n[1*4+1],u=n[1*4+2],h=n[1*4+3],l=Math.cos(t),f=Math.sin(t);return e[0]=l*r+f*a,e[1]=l*i+f*c,e[2]=l*o+f*u,e[3]=l*s+f*h,e[4]=l*a-f*r,e[5]=l*c-f*i,e[6]=l*u-f*o,e[7]=l*h-f*s,n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function Ui(n,t,e){e=e||new D(16);let r=n[0],i=n[1],o=n[2];const s=Math.sqrt(r*r+i*i+o*o);r/=s,i/=s,o/=s;const a=r*r,c=i*i,u=o*o,h=Math.cos(t),l=Math.sin(t),f=1-h;return e[0]=a+(1-a)*h,e[1]=r*i*f+o*l,e[2]=r*o*f-i*l,e[3]=0,e[4]=r*i*f-o*l,e[5]=c+(1-c)*h,e[6]=i*o*f+r*l,e[7]=0,e[8]=r*o*f+i*l,e[9]=i*o*f-r*l,e[10]=u+(1-u)*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}const Qs=Ui;function Fi(n,t,e,r){r=r||new D(16);let i=t[0],o=t[1],s=t[2];const a=Math.sqrt(i*i+o*o+s*s);i/=a,o/=a,s/=a;const c=i*i,u=o*o,h=s*s,l=Math.cos(e),f=Math.sin(e),p=1-l,m=c+(1-c)*l,d=i*o*p+s*f,y=i*s*p-o*f,g=i*o*p-s*f,x=u+(1-u)*l,_=o*s*p+i*f,v=i*s*p+o*f,w=o*s*p-i*f,M=h+(1-h)*l,A=n[0],T=n[1],U=n[2],C=n[3],O=n[4],B=n[5],E=n[6],z=n[7],F=n[8],G=n[9],k=n[10],L=n[11];return r[0]=m*A+d*O+y*F,r[1]=m*T+d*B+y*G,r[2]=m*U+d*E+y*k,r[3]=m*C+d*z+y*L,r[4]=g*A+x*O+_*F,r[5]=g*T+x*B+_*G,r[6]=g*U+x*E+_*k,r[7]=g*C+x*z+_*L,r[8]=v*A+w*O+M*F,r[9]=v*T+w*B+M*G,r[10]=v*U+w*E+M*k,r[11]=v*C+w*z+M*L,n!==r&&(r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r}const Ks=Fi;function ta(n,t){return t=t||new D(16),t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ea(n,t,e){e=e||new D(16);const r=t[0],i=t[1],o=t[2];return e[0]=r*n[0*4+0],e[1]=r*n[0*4+1],e[2]=r*n[0*4+2],e[3]=r*n[0*4+3],e[4]=i*n[1*4+0],e[5]=i*n[1*4+1],e[6]=i*n[1*4+2],e[7]=i*n[1*4+3],e[8]=o*n[2*4+0],e[9]=o*n[2*4+1],e[10]=o*n[2*4+2],e[11]=o*n[2*4+3],n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function na(n,t){return t=t||new D(16),t[0]=n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ra(n,t,e){return e=e||new D(16),e[0]=t*n[0*4+0],e[1]=t*n[0*4+1],e[2]=t*n[0*4+2],e[3]=t*n[0*4+3],e[4]=t*n[1*4+0],e[5]=t*n[1*4+1],e[6]=t*n[1*4+2],e[7]=t*n[1*4+3],e[8]=t*n[2*4+0],e[9]=t*n[2*4+1],e[10]=t*n[2*4+2],e[11]=t*n[2*4+3],n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}var at=Object.freeze({__proto__:null,setDefaultType:vs,create:bs,set:ws,fromMat3:Ms,fromQuat:Ss,negate:As,copy:ar,clone:Ps,equalsApproximately:zs,equals:Cs,identity:Ei,transpose:Ts,inverse:Bi,determinant:Es,invert:Bs,multiply:Oi,mul:Os,setTranslation:Us,getTranslation:Fs,getAxis:Gs,setAxis:Rs,getScaling:Ls,perspective:ks,ortho:Vs,frustum:Ns,aim:Is,cameraAim:Ds,lookAt:$s,translation:qs,translate:Xs,rotationX:Hs,rotateX:Ws,rotationY:Ys,rotateY:js,rotationZ:Js,rotateZ:Zs,axisRotation:Ui,rotation:Qs,axisRotate:Fi,rotate:Ks,scaling:ta,scale:ea,uniformScaling:na,uniformScale:ra});async function ia(n){if(!navigator.gpu)throw new Error("Not Support WebGPU");const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("No Adapter Found");const e=await t.requestDevice();e.limits.maxBindGroups,e.limits.maxBindingsPerBindGroup;const r=n.getContext("webgpu"),i=navigator.gpu.getPreferredCanvasFormat(),o=window.devicePixelRatio||1;n.width=n.clientWidth*o,n.height=n.clientHeight*o;const s={width:n.width,height:n.height};r.configure({device:e,format:i,alphaMode:"opaque",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const a=e.createTexture({size:[n.width,n.height],format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT}),c=a.createView();return{device:e,context:r,format:i,size:s,depthTexture:a,depthView:c}}let ot=1e-6;const oa=new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]);oa.get(Float32Array);let W=Float32Array;function sa(n){const t=W;return W=n,t}function ee(n,t,e){const r=new W(3);return n!==void 0&&(r[0]=n,t!==void 0&&(r[1]=t,e!==void 0&&(r[2]=e))),r}const aa=ee;function ca(n,t){return t=t||new W(3),t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t}function ua(n,t){return t=t||new W(3),t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t}function ha(n,t){return t=t||new W(3),t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t}function la(n,t=0,e=1,r){return r=r||new W(3),r[0]=Math.min(e,Math.max(t,n[0])),r[1]=Math.min(e,Math.max(t,n[1])),r[2]=Math.min(e,Math.max(t,n[2])),r}function fa(n,t,e){return e=e||new W(3),e[0]=n[0]+t[0],e[1]=n[1]+t[1],e[2]=n[2]+t[2],e}function pa(n,t,e,r){return r=r||new W(3),r[0]=n[0]+t[0]*e,r[1]=n[1]+t[1]*e,r[2]=n[2]+t[2]*e,r}function ma(n,t){const e=n[0],r=n[1],i=n[2],o=n[0],s=n[1],a=n[2],c=Math.sqrt(e*e+r*r+i*i),u=Math.sqrt(o*o+s*s+a*a),h=c*u,l=h&&Li(n,t)/h;return Math.acos(l)}function cr(n,t,e){return e=e||new W(3),e[0]=n[0]-t[0],e[1]=n[1]-t[1],e[2]=n[2]-t[2],e}const ya=cr;function da(n,t){return Math.abs(n[0]-t[0])<ot&&Math.abs(n[1]-t[1])<ot&&Math.abs(n[2]-t[2])<ot}function ga(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function xa(n,t,e,r){return r=r||new W(3),r[0]=n[0]+e*(t[0]-n[0]),r[1]=n[1]+e*(t[1]-n[1]),r[2]=n[2]+e*(t[2]-n[2]),r}function _a(n,t,e,r){return r=r||new W(3),r[0]=n[0]+e[0]*(t[0]-n[0]),r[1]=n[1]+e[1]*(t[1]-n[1]),r[2]=n[2]+e[2]*(t[2]-n[2]),r}function va(n,t,e){return e=e||new W(3),e[0]=Math.max(n[0],t[0]),e[1]=Math.max(n[1],t[1]),e[2]=Math.max(n[2],t[2]),e}function ba(n,t,e){return e=e||new W(3),e[0]=Math.min(n[0],t[0]),e[1]=Math.min(n[1],t[1]),e[2]=Math.min(n[2],t[2]),e}function Gi(n,t,e){return e=e||new W(3),e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t,e}const wa=Gi;function Ma(n,t,e){return e=e||new W(3),e[0]=n[0]/t,e[1]=n[1]/t,e[2]=n[2]/t,e}function Ri(n,t){return t=t||new W(3),t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t}const Sa=Ri;function Jn(n,t,e){e=e||new W(3);const r=n[2]*t[0]-n[0]*t[2],i=n[0]*t[1]-n[1]*t[0];return e[0]=n[1]*t[2]-n[2]*t[1],e[1]=r,e[2]=i,e}function Li(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function ki(n){const t=n[0],e=n[1],r=n[2];return Math.sqrt(t*t+e*e+r*r)}const Aa=ki;function Vi(n){const t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}const Pa=Vi;function Ni(n,t){const e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return Math.sqrt(e*e+r*r+i*i)}const za=Ni;function Ii(n,t){const e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return e*e+r*r+i*i}const Ca=Ii;function Sn(n,t){t=t||new W(3);const e=n[0],r=n[1],i=n[2],o=Math.sqrt(e*e+r*r+i*i);return o>1e-5?(t[0]=e/o,t[1]=r/o,t[2]=i/o):(t[0]=0,t[1]=0,t[2]=0),t}function Ta(n,t){return t=t||new W(3),t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function Di(n,t){return t=t||new W(3),t[0]=n[0],t[1]=n[1],t[2]=n[2],t}const Ea=Di;function $i(n,t,e){return e=e||new W(3),e[0]=n[0]*t[0],e[1]=n[1]*t[1],e[2]=n[2]*t[2],e}const Ba=$i;function qi(n,t,e){return e=e||new W(3),e[0]=n[0]/t[0],e[1]=n[1]/t[1],e[2]=n[2]/t[2],e}const Oa=qi;function Ua(n=1,t){t=t||new W(3);const e=Math.random()*2*Math.PI,r=Math.random()*2-1,i=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(e)*i,t[1]=Math.sin(e)*i,t[2]=r*n,t}function Fa(n){return n=n||new W(3),n[0]=0,n[1]=0,n[2]=0,n}function Ga(n,t,e){e=e||new W(3);const r=n[0],i=n[1],o=n[2],s=t[3]*r+t[7]*i+t[11]*o+t[15]||1;return e[0]=(t[0]*r+t[4]*i+t[8]*o+t[12])/s,e[1]=(t[1]*r+t[5]*i+t[9]*o+t[13])/s,e[2]=(t[2]*r+t[6]*i+t[10]*o+t[14])/s,e}function Ra(n,t,e){e=e||new W(3);const r=n[0],i=n[1],o=n[2];return e[0]=r*t[0*4+0]+i*t[1*4+0]+o*t[2*4+0],e[1]=r*t[0*4+1]+i*t[1*4+1]+o*t[2*4+1],e[2]=r*t[0*4+2]+i*t[1*4+2]+o*t[2*4+2],e}function La(n,t,e){e=e||new W(3);const r=n[0],i=n[1],o=n[2];return e[0]=r*t[0]+i*t[4]+o*t[8],e[1]=r*t[1]+i*t[5]+o*t[9],e[2]=r*t[2]+i*t[6]+o*t[10],e}var Qt=Object.freeze({__proto__:null,create:ee,setDefaultType:sa,fromValues:aa,ceil:ca,floor:ua,round:ha,clamp:la,add:fa,addScaled:pa,angle:ma,subtract:cr,sub:ya,equalsApproximately:da,equals:ga,lerp:xa,lerpV:_a,max:va,min:ba,mulScalar:Gi,scale:wa,divScalar:Ma,inverse:Ri,invert:Sa,cross:Jn,dot:Li,length:ki,len:Aa,lengthSq:Vi,lenSq:Pa,distance:Ni,dist:za,distanceSq:Ii,distSq:Ca,normalize:Sn,negate:Ta,copy:Di,clone:Ea,multiply:$i,mul:Ba,divide:qi,div:Oa,random:Ua,zero:Fa,transformMat4:Ga,transformMat4Upper3x3:Ra,transformMat3:La});let tt=Float32Array;function ka(n){const t=tt;return tt=n,t}function Va(n,t,e,r,i,o,s,a,c,u,h,l,f,p,m,d){const y=new tt(16);return n!==void 0&&(y[0]=n,t!==void 0&&(y[1]=t,e!==void 0&&(y[2]=e,r!==void 0&&(y[3]=r,i!==void 0&&(y[4]=i,o!==void 0&&(y[5]=o,s!==void 0&&(y[6]=s,a!==void 0&&(y[7]=a,c!==void 0&&(y[8]=c,u!==void 0&&(y[9]=u,h!==void 0&&(y[10]=h,l!==void 0&&(y[11]=l,f!==void 0&&(y[12]=f,p!==void 0&&(y[13]=p,m!==void 0&&(y[14]=m,d!==void 0&&(y[15]=d)))))))))))))))),y}function Na(n,t){return t=t||new tt(16),t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=-n[7],t[8]=-n[8],t[9]=-n[9],t[10]=-n[10],t[11]=-n[11],t[12]=-n[12],t[13]=-n[13],t[14]=-n[14],t[15]=-n[15],t}function ur(n,t){return t=t||new tt(16),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}const Ia=ur;function Da(n,t){return Math.abs(n[0]-t[0])<ot&&Math.abs(n[1]-t[1])<ot&&Math.abs(n[2]-t[2])<ot&&Math.abs(n[3]-t[3])<ot&&Math.abs(n[4]-t[4])<ot&&Math.abs(n[5]-t[5])<ot&&Math.abs(n[6]-t[6])<ot&&Math.abs(n[7]-t[7])<ot&&Math.abs(n[8]-t[8])<ot&&Math.abs(n[9]-t[9])<ot&&Math.abs(n[10]-t[10])<ot&&Math.abs(n[11]-t[11])<ot&&Math.abs(n[12]-t[12])<ot&&Math.abs(n[13]-t[13])<ot&&Math.abs(n[14]-t[14])<ot&&Math.abs(n[15]-t[15])<ot}function $a(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]}function Xi(n){return n=n||new tt(16),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function qa(n,t){if(t=t||new tt(16),t===n){let x;return x=n[1],n[1]=n[4],n[4]=x,x=n[2],n[2]=n[8],n[8]=x,x=n[3],n[3]=n[12],n[12]=x,x=n[6],n[6]=n[9],n[9]=x,x=n[7],n[7]=n[13],n[13]=x,x=n[11],n[11]=n[14],n[14]=x,t}const e=n[0*4+0],r=n[0*4+1],i=n[0*4+2],o=n[0*4+3],s=n[1*4+0],a=n[1*4+1],c=n[1*4+2],u=n[1*4+3],h=n[2*4+0],l=n[2*4+1],f=n[2*4+2],p=n[2*4+3],m=n[3*4+0],d=n[3*4+1],y=n[3*4+2],g=n[3*4+3];return t[0]=e,t[1]=s,t[2]=h,t[3]=m,t[4]=r,t[5]=a,t[6]=l,t[7]=d,t[8]=i,t[9]=c,t[10]=f,t[11]=y,t[12]=o,t[13]=u,t[14]=p,t[15]=g,t}function Hi(n,t){t=t||new tt(16);const e=n[0*4+0],r=n[0*4+1],i=n[0*4+2],o=n[0*4+3],s=n[1*4+0],a=n[1*4+1],c=n[1*4+2],u=n[1*4+3],h=n[2*4+0],l=n[2*4+1],f=n[2*4+2],p=n[2*4+3],m=n[3*4+0],d=n[3*4+1],y=n[3*4+2],g=n[3*4+3],x=f*g,_=y*p,v=c*g,w=y*u,M=c*p,A=f*u,T=i*g,U=y*o,C=i*p,O=f*o,B=i*u,E=c*o,z=h*d,F=m*l,G=s*d,k=m*a,L=s*l,$=h*a,X=e*d,Y=m*r,ut=e*l,mt=h*r,ct=e*a,V=s*r,Lt=x*a+w*l+M*d-(_*a+v*l+A*d),$t=_*r+T*l+O*d-(x*r+U*l+C*d),qt=v*r+U*a+B*d-(w*r+T*a+E*d),Xt=A*r+C*a+E*l-(M*r+O*a+B*l),N=1/(e*Lt+s*$t+h*qt+m*Xt);return t[0]=N*Lt,t[1]=N*$t,t[2]=N*qt,t[3]=N*Xt,t[4]=N*(_*s+v*h+A*m-(x*s+w*h+M*m)),t[5]=N*(x*e+U*h+C*m-(_*e+T*h+O*m)),t[6]=N*(w*e+T*s+E*m-(v*e+U*s+B*m)),t[7]=N*(M*e+O*s+B*h-(A*e+C*s+E*h)),t[8]=N*(z*u+k*p+L*g-(F*u+G*p+$*g)),t[9]=N*(F*o+X*p+mt*g-(z*o+Y*p+ut*g)),t[10]=N*(G*o+Y*u+ct*g-(k*o+X*u+V*g)),t[11]=N*($*o+ut*u+V*p-(L*o+mt*u+ct*p)),t[12]=N*(G*f+$*y+F*c-(L*y+z*c+k*f)),t[13]=N*(ut*y+z*i+Y*f-(X*f+mt*y+F*i)),t[14]=N*(X*c+V*y+k*i-(ct*y+G*i+Y*c)),t[15]=N*(ct*f+L*i+mt*c-(ut*c+V*f+$*i)),t}function Xa(n){const t=n[0],e=n[0*4+1],r=n[0*4+2],i=n[0*4+3],o=n[1*4+0],s=n[1*4+1],a=n[1*4+2],c=n[1*4+3],u=n[2*4+0],h=n[2*4+1],l=n[2*4+2],f=n[2*4+3],p=n[3*4+0],m=n[3*4+1],d=n[3*4+2],y=n[3*4+3],g=l*y,x=d*f,_=a*y,v=d*c,w=a*f,M=l*c,A=r*y,T=d*i,U=r*f,C=l*i,O=r*c,B=a*i,E=g*s+v*h+w*m-(x*s+_*h+M*m),z=x*e+A*h+C*m-(g*e+T*h+U*m),F=_*e+T*s+O*m-(v*e+A*s+B*m),G=M*e+U*s+B*h-(w*e+C*s+O*h);return t*E+o*z+u*F+p*G}const Ha=Hi;function Wi(n,t,e){e=e||new tt(16);const r=n[0],i=n[1],o=n[2],s=n[3],a=n[4+0],c=n[4+1],u=n[4+2],h=n[4+3],l=n[8+0],f=n[8+1],p=n[8+2],m=n[8+3],d=n[12+0],y=n[12+1],g=n[12+2],x=n[12+3],_=t[0],v=t[1],w=t[2],M=t[3],A=t[4+0],T=t[4+1],U=t[4+2],C=t[4+3],O=t[8+0],B=t[8+1],E=t[8+2],z=t[8+3],F=t[12+0],G=t[12+1],k=t[12+2],L=t[12+3];return e[0]=r*_+a*v+l*w+d*M,e[1]=i*_+c*v+f*w+y*M,e[2]=o*_+u*v+p*w+g*M,e[3]=s*_+h*v+m*w+x*M,e[4]=r*A+a*T+l*U+d*C,e[5]=i*A+c*T+f*U+y*C,e[6]=o*A+u*T+p*U+g*C,e[7]=s*A+h*T+m*U+x*C,e[8]=r*O+a*B+l*E+d*z,e[9]=i*O+c*B+f*E+y*z,e[10]=o*O+u*B+p*E+g*z,e[11]=s*O+h*B+m*E+x*z,e[12]=r*F+a*G+l*k+d*L,e[13]=i*F+c*G+f*k+y*L,e[14]=o*F+u*G+p*k+g*L,e[15]=s*F+h*G+m*k+x*L,e}const Wa=Wi;function Ya(n,t,e){return e=e||Xi(),n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11]),e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function ja(n,t){return t=t||ee(),t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function Ja(n,t,e){e=e||ee();const r=t*4;return e[0]=n[r+0],e[1]=n[r+1],e[2]=n[r+2],e}function Za(n,t,e,r){r!==n&&(r=ur(n,r));const i=e*4;return r[i+0]=t[0],r[i+1]=t[1],r[i+2]=t[2],r}function Qa(n,t){t=t||ee();const e=n[0],r=n[1],i=n[2],o=n[4],s=n[5],a=n[6],c=n[8],u=n[9],h=n[10];return t[0]=Math.sqrt(e*e+r*r+i*i),t[1]=Math.sqrt(o*o+s*s+a*a),t[2]=Math.sqrt(c*c+u*u+h*h),t}function Ka(n,t,e,r,i){i=i||new tt(16);const o=Math.tan(Math.PI*.5-.5*n),s=1/(e-r);return i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r*s,i[11]=-1,i[12]=0,i[13]=0,i[14]=e*r*s,i[15]=0,i}function tc(n,t,e,r,i,o,s){return s=s||new tt(16),s[0]=2/(t-n),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(r-e),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1/(i-o),s[11]=0,s[12]=(t+n)/(n-t),s[13]=(r+e)/(e-r),s[14]=i/(i-o),s[15]=1,s}function ec(n,t,e,r,i,o,s){s=s||new tt(16);const a=t-n,c=r-e,u=i-o;return s[0]=2*i/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*i/c,s[6]=0,s[7]=0,s[8]=(n+t)/a,s[9]=(r+e)/c,s[10]=o/u,s[11]=-1,s[12]=0,s[13]=0,s[14]=i*o/u,s[15]=0,s}let Yt,ae,Vt;function nc(n,t,e,r){return r=r||new tt(16),Yt=Yt||ee(),ae=ae||ee(),Vt=Vt||ee(),Sn(cr(n,t,Vt),Vt),Sn(Jn(e,Vt,Yt),Yt),Sn(Jn(Vt,Yt,ae),ae),r[0]=Yt[0],r[1]=Yt[1],r[2]=Yt[2],r[3]=0,r[4]=ae[0],r[5]=ae[1],r[6]=ae[2],r[7]=0,r[8]=Vt[0],r[9]=Vt[1],r[10]=Vt[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function rc(n,t){return t=t||new tt(16),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ic(n,t,e){e=e||new tt(16);const r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],c=n[2],u=n[3],h=n[1*4+0],l=n[1*4+1],f=n[1*4+2],p=n[1*4+3],m=n[2*4+0],d=n[2*4+1],y=n[2*4+2],g=n[2*4+3],x=n[3*4+0],_=n[3*4+1],v=n[3*4+2],w=n[3*4+3];return n!==e&&(e[0]=s,e[1]=a,e[2]=c,e[3]=u,e[4]=h,e[5]=l,e[6]=f,e[7]=p,e[8]=m,e[9]=d,e[10]=y,e[11]=g),e[12]=s*r+h*i+m*o+x,e[13]=a*r+l*i+d*o+_,e[14]=c*r+f*i+y*o+v,e[15]=u*r+p*i+g*o+w,e}function oc(n,t){t=t||new tt(16);const e=Math.cos(n),r=Math.sin(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sc(n,t,e){e=e||new tt(16);const r=n[4],i=n[5],o=n[6],s=n[7],a=n[8],c=n[9],u=n[10],h=n[11],l=Math.cos(t),f=Math.sin(t);return e[4]=l*r+f*a,e[5]=l*i+f*c,e[6]=l*o+f*u,e[7]=l*s+f*h,e[8]=l*a-f*r,e[9]=l*c-f*i,e[10]=l*u-f*o,e[11]=l*h-f*s,n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function ac(n,t){t=t||new tt(16);const e=Math.cos(n),r=Math.sin(n);return t[0]=e,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cc(n,t,e){e=e||new tt(16);const r=n[0*4+0],i=n[0*4+1],o=n[0*4+2],s=n[0*4+3],a=n[2*4+0],c=n[2*4+1],u=n[2*4+2],h=n[2*4+3],l=Math.cos(t),f=Math.sin(t);return e[0]=l*r-f*a,e[1]=l*i-f*c,e[2]=l*o-f*u,e[3]=l*s-f*h,e[8]=l*a+f*r,e[9]=l*c+f*i,e[10]=l*u+f*o,e[11]=l*h+f*s,n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function uc(n,t){t=t||new tt(16);const e=Math.cos(n),r=Math.sin(n);return t[0]=e,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hc(n,t,e){e=e||new tt(16);const r=n[0*4+0],i=n[0*4+1],o=n[0*4+2],s=n[0*4+3],a=n[1*4+0],c=n[1*4+1],u=n[1*4+2],h=n[1*4+3],l=Math.cos(t),f=Math.sin(t);return e[0]=l*r+f*a,e[1]=l*i+f*c,e[2]=l*o+f*u,e[3]=l*s+f*h,e[4]=l*a-f*r,e[5]=l*c-f*i,e[6]=l*u-f*o,e[7]=l*h-f*s,n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function Yi(n,t,e){e=e||new tt(16);let r=n[0],i=n[1],o=n[2];const s=Math.sqrt(r*r+i*i+o*o);r/=s,i/=s,o/=s;const a=r*r,c=i*i,u=o*o,h=Math.cos(t),l=Math.sin(t),f=1-h;return e[0]=a+(1-a)*h,e[1]=r*i*f+o*l,e[2]=r*o*f-i*l,e[3]=0,e[4]=r*i*f-o*l,e[5]=c+(1-c)*h,e[6]=i*o*f+r*l,e[7]=0,e[8]=r*o*f+i*l,e[9]=i*o*f-r*l,e[10]=u+(1-u)*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}const lc=Yi;function ji(n,t,e,r){r=r||new tt(16);let i=t[0],o=t[1],s=t[2];const a=Math.sqrt(i*i+o*o+s*s);i/=a,o/=a,s/=a;const c=i*i,u=o*o,h=s*s,l=Math.cos(e),f=Math.sin(e),p=1-l,m=c+(1-c)*l,d=i*o*p+s*f,y=i*s*p-o*f,g=i*o*p-s*f,x=u+(1-u)*l,_=o*s*p+i*f,v=i*s*p+o*f,w=o*s*p-i*f,M=h+(1-h)*l,A=n[0],T=n[1],U=n[2],C=n[3],O=n[4],B=n[5],E=n[6],z=n[7],F=n[8],G=n[9],k=n[10],L=n[11];return r[0]=m*A+d*O+y*F,r[1]=m*T+d*B+y*G,r[2]=m*U+d*E+y*k,r[3]=m*C+d*z+y*L,r[4]=g*A+x*O+_*F,r[5]=g*T+x*B+_*G,r[6]=g*U+x*E+_*k,r[7]=g*C+x*z+_*L,r[8]=v*A+w*O+M*F,r[9]=v*T+w*B+M*G,r[10]=v*U+w*E+M*k,r[11]=v*C+w*z+M*L,n!==r&&(r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r}const fc=ji;function pc(n,t){return t=t||new tt(16),t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mc(n,t,e){e=e||new tt(16);const r=t[0],i=t[1],o=t[2];return e[0]=r*n[0*4+0],e[1]=r*n[0*4+1],e[2]=r*n[0*4+2],e[3]=r*n[0*4+3],e[4]=i*n[1*4+0],e[5]=i*n[1*4+1],e[6]=i*n[1*4+2],e[7]=i*n[1*4+3],e[8]=o*n[2*4+0],e[9]=o*n[2*4+1],e[10]=o*n[2*4+2],e[11]=o*n[2*4+3],n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}var Ee=Object.freeze({__proto__:null,setDefaultType:ka,create:Va,negate:Na,copy:ur,clone:Ia,equalsApproximately:Da,equals:$a,identity:Xi,transpose:qa,inverse:Hi,determinant:Xa,invert:Ha,multiply:Wi,mul:Wa,setTranslation:Ya,getTranslation:ja,getAxis:Ja,setAxis:Za,getScaling:Qa,perspective:Ka,ortho:tc,frustum:ec,lookAt:nc,translation:rc,translate:ic,rotationX:oc,rotateX:sc,rotationY:ac,rotateY:cc,rotationZ:uc,rotateZ:hc,axisRotation:Yi,rotation:lc,axisRotate:ji,rotate:fc,scaling:pc,scale:mc});let nt=Float32Array;function yc(n){const t=nt;return nt=n,t}function Ji(n,t,e,r){const i=new nt(4);return n!==void 0&&(i[0]=n,t!==void 0&&(i[1]=t,e!==void 0&&(i[2]=e,r!==void 0&&(i[3]=r)))),i}const dc=Ji;function gc(n,t){return t=t||new nt(4),t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t}function xc(n,t){return t=t||new nt(4),t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t}function _c(n,t){return t=t||new nt(4),t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t}function vc(n,t=0,e=1,r){return r=r||new nt(4),r[0]=Math.min(e,Math.max(t,n[0])),r[1]=Math.min(e,Math.max(t,n[1])),r[2]=Math.min(e,Math.max(t,n[2])),r[3]=Math.min(e,Math.max(t,n[3])),r}function bc(n,t,e){return e=e||new nt(4),e[0]=n[0]+t[0],e[1]=n[1]+t[1],e[2]=n[2]+t[2],e[3]=n[3]+t[3],e}function wc(n,t,e,r){return r=r||new nt(4),r[0]=n[0]+t[0]*e,r[1]=n[1]+t[1]*e,r[2]=n[2]+t[2]*e,r[3]=n[3]+t[3]*e,r}function Zi(n,t,e){return e=e||new nt(4),e[0]=n[0]-t[0],e[1]=n[1]-t[1],e[2]=n[2]-t[2],e[3]=n[3]-t[3],e}const Mc=Zi;function Sc(n,t){return Math.abs(n[0]-t[0])<ot&&Math.abs(n[1]-t[1])<ot&&Math.abs(n[2]-t[2])<ot&&Math.abs(n[3]-t[3])<ot}function Ac(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]}function Pc(n,t,e,r){return r=r||new nt(4),r[0]=n[0]+e*(t[0]-n[0]),r[1]=n[1]+e*(t[1]-n[1]),r[2]=n[2]+e*(t[2]-n[2]),r[3]=n[3]+e*(t[3]-n[3]),r}function zc(n,t,e,r){return r=r||new nt(4),r[0]=n[0]+e[0]*(t[0]-n[0]),r[1]=n[1]+e[1]*(t[1]-n[1]),r[2]=n[2]+e[2]*(t[2]-n[2]),r[3]=n[3]+e[3]*(t[3]-n[3]),r}function Cc(n,t,e){return e=e||new nt(4),e[0]=Math.max(n[0],t[0]),e[1]=Math.max(n[1],t[1]),e[2]=Math.max(n[2],t[2]),e[3]=Math.max(n[3],t[3]),e}function Tc(n,t,e){return e=e||new nt(4),e[0]=Math.min(n[0],t[0]),e[1]=Math.min(n[1],t[1]),e[2]=Math.min(n[2],t[2]),e[3]=Math.min(n[3],t[3]),e}function Qi(n,t,e){return e=e||new nt(4),e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t,e[3]=n[3]*t,e}const Ec=Qi;function Bc(n,t,e){return e=e||new nt(4),e[0]=n[0]/t,e[1]=n[1]/t,e[2]=n[2]/t,e[3]=n[3]/t,e}function Ki(n,t){return t=t||new nt(4),t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t}const Oc=Ki;function Uc(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function to(n){const t=n[0],e=n[1],r=n[2],i=n[3];return Math.sqrt(t*t+e*e+r*r+i*i)}const Fc=to;function eo(n){const t=n[0],e=n[1],r=n[2],i=n[3];return t*t+e*e+r*r+i*i}const Gc=eo;function no(n,t){const e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2],o=n[3]-t[3];return Math.sqrt(e*e+r*r+i*i+o*o)}const Rc=no;function ro(n,t){const e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2],o=n[3]-t[3];return e*e+r*r+i*i+o*o}const Lc=ro;function kc(n,t){t=t||new nt(4);const e=n[0],r=n[1],i=n[2],o=n[3],s=Math.sqrt(e*e+r*r+i*i+o*o);return s>1e-5?(t[0]=e/s,t[1]=r/s,t[2]=i/s,t[3]=o/s):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Vc(n,t){return t=t||new nt(4),t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t}function io(n,t){return t=t||new nt(4),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}const Nc=io;function oo(n,t,e){return e=e||new nt(4),e[0]=n[0]*t[0],e[1]=n[1]*t[1],e[2]=n[2]*t[2],e[3]=n[3]*t[3],e}const Ic=oo;function so(n,t,e){return e=e||new nt(4),e[0]=n[0]/t[0],e[1]=n[1]/t[1],e[2]=n[2]/t[2],e[3]=n[3]/t[3],e}const Dc=so;function $c(n){return n=n||new nt(4),n[0]=0,n[1]=0,n[2]=0,n[3]=0,n}function qc(n,t,e){e=e||new nt(4);const r=n[0],i=n[1],o=n[2],s=n[3];return e[0]=t[0]*r+t[4]*i+t[8]*o+t[12]*s,e[1]=t[1]*r+t[5]*i+t[9]*o+t[13]*s,e[2]=t[2]*r+t[6]*i+t[10]*o+t[14]*s,e[3]=t[3]*r+t[7]*i+t[11]*o+t[15]*s,e}var Xc=Object.freeze({__proto__:null,setDefaultType:yc,create:Ji,fromValues:dc,ceil:gc,floor:xc,round:_c,clamp:vc,add:bc,addScaled:wc,subtract:Zi,sub:Mc,equalsApproximately:Sc,equals:Ac,lerp:Pc,lerpV:zc,max:Cc,min:Tc,mulScalar:Qi,scale:Ec,divScalar:Bc,inverse:Ki,invert:Oc,dot:Uc,length:to,len:Fc,lengthSq:eo,lenSq:Gc,distance:no,dist:Rc,distanceSq:ro,distSq:Lc,normalize:kc,negate:Vc,copy:io,clone:Nc,multiply:oo,mul:Ic,divide:so,div:Dc,zero:$c,transformMat4:qc});const Hc=4*10,Wc=0,Yc=4*8,jc=36,Nr=new Float32Array([1,-1,1,1,1,0,.5,1,0,1,-1,-1,1,1,0,0,1,1,1,1,-1,-1,-1,1,0,0,0,1,1,0,1,-1,-1,1,.5,0,0,1,0,0,1,-1,1,1,1,0,1,1,0,1,-1,-1,-1,1,0,0,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,-1,1,1,1,0,.5,1,1,1,1,-1,-1,1,1,0,0,1,1,0,1,1,-1,1,1,1,0,1,0,0,1,1,1,1,1,1,1,1,0,1,1,-1,-1,1,1,0,0,1,1,0,-1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,1,.5,1,0,1,1,0,-1,1,-1,1,0,1,0,1,0,0,-1,1,1,1,0,1,1,1,0,1,1,1,-1,1,1,1,0,1,1,0,-1,-1,1,1,0,0,1,1,0,1,-1,1,1,1,0,1,1,1,1,1,-1,1,-1,1,0,1,0,1,1,0,-1,-1,-1,1,0,0,0,.5,0,0,-1,-1,1,1,0,0,1,1,0,1,-1,1,-1,1,0,1,.3,1,1,0,1,1,1,1,1,1,1,1,0,1,-1,1,1,1,0,1,1,1,1,1,-1,-1,1,1,.3,0,1,1,1,0,-1,-1,1,1,0,0,1,1,1,0,1,-1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,1,1,-1,-1,1,1,0,0,1,0,1,-1,-1,-1,1,0,0,0,.3,1,1,-1,1,-1,1,0,1,0,1,1,0,1,1,-1,1,1,1,0,1,0,0,1,-1,-1,1,.3,0,0,1,0,1,-1,1,-1,1,0,1,0,1,1,0]),Jc=`// cubemap\r
struct ModelMatrix {\r
  modelMatrix : mat4x4<f32>,\r
}\r
struct CameraViewMatrix {\r
  cameraViewMatrix : mat4x4<f32>,\r
}\r
\r
@binding(0) @group(0) var<uniform> modelMatrix : ModelMatrix; //main: uniformBuffer main2: uniformBuffer\r
@binding(1) @group(0) var<uniform> cameraViewMatrix : CameraViewMatrix; //main: uniformBuffer main2: uniformBuffer\r
\r
\r
struct VertexOutput {\r
  @builtin(position) Position : vec4<f32>,\r
  @location(0) fragUV : vec2<f32>,\r
  @location(1) fragPosition: vec4<f32>,\r
}\r
\r
@vertex\r
fn main(\r
  @location(0) position : vec4<f32>,\r
  @location(1) uv : vec2<f32>\r
) -> VertexOutput {\r
  var output : VertexOutput;\r
  output.Position = cameraViewMatrix.cameraViewMatrix * modelMatrix.modelMatrix * position;\r
  output.fragUV = uv;\r
  output.fragPosition = 0.5 * (position + vec4(1.0, 1.0, 1.0, 1.0));\r
  return output;\r
}\r
`,Zc=`// cubemap\r
@group(0) @binding(2) var mySampler: sampler;\r
@group(0) @binding(3) var myTexture: texture_cube<f32>;\r
\r
@fragment\r
fn main(\r
  @location(0) fragUV: vec2<f32>,\r
  @location(1) fragPosition: vec4<f32>\r
) -> @location(0) vec4<f32> {\r
  // Our camera and the skybox cube are both centered at (0, 0, 0)\r
  // so we can use the cube geomtry position to get viewing vector to sample the cube texture.\r
  // The magnitude of the vector doesn't matter.\r
  //我们的相机和skybox立方体都以（0，0，0）为中心\r
  //因此，我们可以使用立方体的地理位置来获得观看向量来对立方体纹理进行采样。\r
  //矢量的大小无关紧要。\r
  var cubemapVec = fragPosition.xyz - vec3(0.5);\r
  return textureSample(myTexture, mySampler, cubemapVec);\r
  // return vec4<f32>(0.0, 0.0, 0.0, 1.0);\r
    // return vec4<f32>(1.0, 1.0, 1.0, 0.5);\r
}\r
`;async function Qc(n,t,e,r){const i=n.createBuffer({size:Nr.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});new Float32Array(i.getMappedRange()).set(Nr),i.unmap();const o=n.createRenderPipeline({label:"pipeline",layout:r,vertex:{module:n.createShaderModule({code:Jc}),entryPoint:"main",buffers:[{arrayStride:Hc,attributes:[{shaderLocation:0,offset:Wc,format:"float32x4"},{shaderLocation:1,offset:Yc,format:"float32x2"}]}]},fragment:{module:n.createShaderModule({code:Zc}),entryPoint:"main",targets:[{format:t}]},primitive:{topology:"triangle-list",cullMode:"front"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"}});let s;{const y=[new URL("http://139.159.253.241/WebGPU/img/cubemap_2/px.png").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_2/nx.png").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_2/py.png").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_2/ny.png").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_2/pz.png").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_2/nz.png").toString()].map(async x=>{const _=await fetch(x);return createImageBitmap(await _.blob())}),g=await Promise.all(y);s=n.createTexture({dimension:"2d",size:[g[0].width,g[0].height,6],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});for(let x=0;x<g.length;x++){const _=g[x];n.queue.copyExternalImageToTexture({source:_},{texture:s,origin:[0,0,x]},[_.width,_.height])}}let a;{const y=[new URL("http://139.159.253.241/WebGPU/img/cubemap_1/px.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_1/nx.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_1/py.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_1/ny.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_1/pz.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap_1/nz.jpg").toString()].map(async x=>{const _=await fetch(x);return createImageBitmap(await _.blob())}),g=await Promise.all(y);a=n.createTexture({dimension:"2d",size:[g[0].width,g[0].height,6],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});for(let x=0;x<g.length;x++){const _=g[x];n.queue.copyExternalImageToTexture({source:_},{texture:a,origin:[0,0,x]},[_.width,_.height])}}let c;{const y=[new URL("http://139.159.253.241/WebGPU/img/cubemap/posx.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap/negx.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap/posy.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap/negy.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap/posz.jpg").toString(),new URL("http://139.159.253.241/WebGPU/img/cubemap/negz.jpg").toString()].map(async x=>{const _=await fetch(x);return createImageBitmap(await _.blob())}),g=await Promise.all(y);c=n.createTexture({dimension:"2d",size:[g[0].width,g[0].height,6],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});for(let x=0;x<g.length;x++){const _=g[x];n.queue.copyExternalImageToTexture({source:_},{texture:c,origin:[0,0,x]},[_.width,_.height])}}const u=n.createSampler({magFilter:"linear",minFilter:"linear"}),h=4*16,l=n.createBuffer({size:h,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),f=Ee.scaling(Qt.fromValues(1e3,1e3,1e3)),p=new Float32Array(f);return n.queue.writeBuffer(l,0,p.buffer,p.byteOffset,p.byteLength),{skyBoxVerticesBuffer:i,skyBoxPipeline:o,skyBoxmapTexture:s,skyBoxmapTexture2:a,skyBoxmapTexture3:c,sampler:u,skyBoxModelMatrixBuffer:l,cubeVertexCount:jc}}var An=1e-6,bt=typeof Float32Array<"u"?Float32Array:Array;function Kc(n){bt=n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function tu(){var n=new bt(9);return bt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function hn(){var n=new bt(16);return bt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function eu(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ir(n,t){var e=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],h=t[8],l=t[9],f=t[10],p=t[11],m=t[12],d=t[13],y=t[14],g=t[15],x=e*a-r*s,_=e*c-i*s,v=e*u-o*s,w=r*c-i*a,M=r*u-o*a,A=i*u-o*c,T=h*d-l*m,U=h*y-f*m,C=h*g-p*m,O=l*y-f*d,B=l*g-p*d,E=f*g-p*y,z=x*E-_*B+v*O+w*C-M*U+A*T;return z?(z=1/z,n[0]=(a*E-c*B+u*O)*z,n[1]=(i*B-r*E-o*O)*z,n[2]=(d*A-y*M+g*w)*z,n[3]=(f*M-l*A-p*w)*z,n[4]=(c*C-s*E-u*U)*z,n[5]=(e*E-i*C+o*U)*z,n[6]=(y*v-m*A-g*_)*z,n[7]=(h*A-f*v+p*_)*z,n[8]=(s*B-a*C+u*T)*z,n[9]=(r*C-e*B-o*T)*z,n[10]=(m*M-d*v+g*x)*z,n[11]=(l*v-h*M-p*x)*z,n[12]=(a*U-s*O-c*T)*z,n[13]=(e*O-r*U+i*T)*z,n[14]=(d*_-m*w-y*x)*z,n[15]=(h*w-l*_+f*x)*z,n):null}function nu(n,t,e,r,i){var o=1/Math.tan(t/2),s;return n[0]=o/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0?(s=1/(r-i),n[10]=i*s,n[14]=i*r*s):(n[10]=-1,n[14]=-r),n}function ru(n,t,e,r){var i,o,s,a,c,u,h,l,f,p,m=t[0],d=t[1],y=t[2],g=r[0],x=r[1],_=r[2],v=e[0],w=e[1],M=e[2];return Math.abs(m-v)<An&&Math.abs(d-w)<An&&Math.abs(y-M)<An?eu(n):(h=m-v,l=d-w,f=y-M,p=1/Math.hypot(h,l,f),h*=p,l*=p,f*=p,i=x*f-_*l,o=_*h-g*f,s=g*l-x*h,p=Math.hypot(i,o,s),p?(p=1/p,i*=p,o*=p,s*=p):(i=0,o=0,s=0),a=l*s-f*o,c=f*i-h*s,u=h*o-l*i,p=Math.hypot(a,c,u),p?(p=1/p,a*=p,c*=p,u*=p):(a=0,c=0,u=0),n[0]=i,n[1]=a,n[2]=h,n[3]=0,n[4]=o,n[5]=c,n[6]=l,n[7]=0,n[8]=s,n[9]=u,n[10]=f,n[11]=0,n[12]=-(i*m+o*d+s*y),n[13]=-(a*m+c*d+u*y),n[14]=-(h*m+l*d+f*y),n[15]=1,n)}function Kt(){var n=new bt(3);return bt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function iu(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function ze(n,t,e){var r=new bt(3);return r[0]=n,r[1]=t,r[2]=e,r}function ou(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function On(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function su(n,t){var e=t[0],r=t[1],i=t[2],o=e*e+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n}function au(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Be(n,t,e){var r=t[0],i=t[1],o=t[2],s=e[0],a=e[1],c=e[2];return n[0]=i*c-o*a,n[1]=o*s-r*c,n[2]=r*a-i*s,n}function cu(n,t,e){var r=e[0],i=e[1],o=e[2],s=e[3],a=t[0],c=t[1],u=t[2],h=i*u-o*c,l=o*a-r*u,f=r*c-i*a,p=i*f-o*l,m=o*h-r*f,d=r*l-i*h,y=s*2;return h*=y,l*=y,f*=y,p*=2,m*=2,d*=2,n[0]=a+h+p,n[1]=c+l+m,n[2]=u+f+d,n}var uu=iu;(function(){var n=Kt();return function(t,e,r,i,o,s){var a,c;for(e||(e=3),r||(r=0),i?c=Math.min(i*e+r,t.length):c=t.length,a=r;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],o(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}})();function hu(){var n=new bt(4);return bt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function lu(n,t){var e=t[0],r=t[1],i=t[2],o=t[3],s=e*e+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),n[0]=e*s,n[1]=r*s,n[2]=i*s,n[3]=o*s,n}(function(){var n=hu();return function(t,e,r,i,o,s){var a,c;for(e||(e=4),r||(r=0),i?c=Math.min(i*e+r,t.length):c=t.length,a=r;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],n[3]=t[a+3],o(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3];return t}})();function Xe(){var n=new bt(4);return bt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Zn(n,t,e){e=e*.5;var r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function fu(n,t,e){var r=t[0],i=t[1],o=t[2],s=t[3],a=e[0],c=e[1],u=e[2],h=e[3];return n[0]=r*h+s*a+i*u-o*c,n[1]=i*h+s*c+o*a-r*u,n[2]=o*h+s*u+r*c-i*a,n[3]=s*h-r*a-i*c-o*u,n}function Un(n,t,e,r){var i=t[0],o=t[1],s=t[2],a=t[3],c=e[0],u=e[1],h=e[2],l=e[3],f,p,m,d,y;return p=i*c+o*u+s*h+a*l,p<0&&(p=-p,c=-c,u=-u,h=-h,l=-l),1-p>An?(f=Math.acos(p),m=Math.sin(f),d=Math.sin((1-r)*f)/m,y=Math.sin(r*f)/m):(d=1-r,y=r),n[0]=d*i+y*c,n[1]=d*o+y*u,n[2]=d*s+y*h,n[3]=d*a+y*l,n}function pu(n,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[o*3+o]-t[s*3+s]+1),n[i]=.5*r,r=.5/r,n[3]=(t[o*3+s]-t[s*3+o])*r,n[o]=(t[o*3+i]+t[i*3+o])*r,n[s]=(t[s*3+i]+t[i*3+s])*r}return n}var mu=fu,hr=lu;(function(){var n=Kt(),t=ze(1,0,0),e=ze(0,1,0);return function(r,i,o){var s=au(i,o);return s<-.999999?(Be(n,t,i),uu(n)<1e-6&&Be(n,e,i),su(n,n),Zn(r,n,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Be(n,i,o),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+s,hr(r,r))}})();(function(){var n=Xe(),t=Xe();return function(e,r,i,o,s,a){return Un(n,r,s,a),Un(t,i,o,a),Un(e,n,t,2*a*(1-a)),e}})();(function(){var n=tu();return function(t,e,r,i){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],hr(t,pu(t,n))}})();function yu(){var n=new bt(2);return bt!=Float32Array&&(n[0]=0,n[1]=0),n}function du(n,t){var e=new bt(2);return e[0]=n,e[1]=t,e}function gu(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n}(function(){var n=yu();return function(t,e,r,i,o,s){var a,c;for(e||(e=2),r||(r=0),i?c=Math.min(i*e+r,t.length):c=t.length,a=r;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],o(n,n,s),t[a]=n[0],t[a+1]=n[1];return t}})();Kc(Array);class xu{constructor(t,e,r,i,o){it(this,"canvas");it(this,"verticalFOV",45);it(this,"nearClip",.1);it(this,"farClip",100);it(this,"translationSpeed",5);it(this,"rotationSpeed",3);it(this,"projection",hn());it(this,"view",hn());it(this,"inverseProjection",hn());it(this,"inverseView",hn());it(this,"position",Kt());it(this,"forwardDirection",Kt());it(this,"upDirection",Kt());it(this,"move",!1);it(this,"translateX",0);it(this,"translateY",0);it(this,"translateZ",0);it(this,"rotate",!1);it(this,"mouseMovement",[0,0]);it(this,"updatePos",()=>{if(this.move){let t=Kt();Be(t,this.forwardDirection,this.upDirection),this.translateX!==0&&On(this.position,this.position,t,this.translationSpeed*this.translateX),this.translateY!==0&&On(this.position,this.position,this.upDirection,this.translationSpeed*this.translateY),this.translateZ!==0&&On(this.position,this.position,this.forwardDirection,this.translationSpeed*this.translateZ),Be(t,this.forwardDirection,this.upDirection),t=Kt(),Be(t,this.forwardDirection,this.upDirection);const e=du(this.mouseMovement[0],this.mouseMovement[1]);gu(e,e,.001);const r=e[1]*this.rotationSpeed,i=e[0]*this.rotationSpeed,o=Xe();Zn(o,t,-r);const s=Xe();Zn(s,this.upDirection,-i);const a=Xe();mu(a,o,s),hr(a,a),cu(this.forwardDirection,this.forwardDirection,a),this.recalculateProjection(),this.recalculateView(),this.mouseMovement=[0,0]}});it(this,"recalculateProjection",()=>{nu(this.projection,this.verticalFOV,this.canvas.width/this.canvas.height,this.nearClip,this.farClip),Ir(this.inverseProjection,this.projection)});it(this,"recalculateView",()=>{const t=Kt();ou(t,this.position,this.forwardDirection),ru(this.view,this.position,t,ze(0,1,0)),Ir(this.inverseView,this.view)});this.canvas=t,this.verticalFOV=e,this.nearClip=r,this.farClip=i,this.translationSpeed=o,this.rotationSpeed=3,this.forwardDirection=ze(0,0,-1),this.upDirection=ze(0,1,0),this.position=ze(0,0,3),this.recalculateProjection(),this.recalculateView(),document.addEventListener("mousedown",async u=>{if(u.button===2&&!document.pointerLockElement)try{await t.requestPointerLock({unadjustedMovement:!0})}catch{alert("Please left click the view before trying to move with right click.")}}),document.addEventListener("mouseup",()=>{document.exitPointerLock()}),document.addEventListener("pointerlockchange",()=>{document.pointerLockElement==t?(this.move=!0,document.addEventListener("mousemove",c),document.addEventListener("keydown",s),document.addEventListener("keyup",a)):(this.move=!1,document.removeEventListener("mousemove",c),document.removeEventListener("keydown",s))});const s=u=>{u.code==="KeyW"?this.translateZ=1:u.code==="KeyS"&&(this.translateZ=-1),u.code==="KeyD"?this.translateX=1:u.code==="KeyA"&&(this.translateX=-1),u.code==="KeyE"?this.translateY=1:u.code==="KeyQ"&&(this.translateY=-1)},a=u=>{u.code==="KeyW"?this.translateZ=0:u.code==="KeyS"&&(this.translateZ=0),u.code==="KeyD"?this.translateX=0:u.code==="KeyA"&&(this.translateX=0),u.code==="KeyE"?this.translateY=0:u.code==="KeyQ"&&(this.translateY=0)},c=u=>{this.mouseMovement[0]+=u.movementX,this.mouseMovement[1]+=u.movementY,console.log(u.movementX,u.movementY)}}}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ao="155",co=300,Dr=1e3,ln=1001,$r=1002,_u=1006,vu=1008,bu=1009,wu=1015,Mu=1023,Su=3e3,Fn=3001,Gn="",Rn="srgb",qr=35044,fn=2e3,Xr=2001;class lr{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(e)===-1&&r[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const o=i.indexOf(e);o!==-1&&i.splice(o,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const i=r.slice(0);for(let o=0,s=i.length;o<s;o++)i[o].call(this,t);t.target=null}}}const vt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function rn(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(vt[n&255]+vt[n>>8&255]+vt[n>>16&255]+vt[n>>24&255]+"-"+vt[t&255]+vt[t>>8&255]+"-"+vt[t>>16&15|64]+vt[t>>24&255]+"-"+vt[e&63|128]+vt[e>>8&255]+"-"+vt[e>>16&255]+vt[e>>24&255]+vt[r&255]+vt[r>>8&255]+vt[r>>16&255]+vt[r>>24&255]).toLowerCase()}function zt(n,t,e){return Math.max(t,Math.min(e,n))}function Le(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function wt(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}class R{constructor(t=0,e=0){R.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,r=this.y,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6],this.y=i[1]*e+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(zt(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y;return e*e+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const r=Math.cos(e),i=Math.sin(e),o=this.x-t.x,s=this.y-t.y;return this.x=o*r-s*i+t.x,this.y=o*i+s*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Fe{constructor(t,e,r,i,o,s,a,c,u){Fe.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,r,i,o,s,a,c,u)}set(t,e,r,i,o,s,a,c,u){const h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=o,h[5]=c,h[6]=r,h[7]=s,h[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,o=this.elements,s=r[0],a=r[3],c=r[6],u=r[1],h=r[4],l=r[7],f=r[2],p=r[5],m=r[8],d=i[0],y=i[3],g=i[6],x=i[1],_=i[4],v=i[7],w=i[2],M=i[5],A=i[8];return o[0]=s*d+a*x+c*w,o[3]=s*y+a*_+c*M,o[6]=s*g+a*v+c*A,o[1]=u*d+h*x+l*w,o[4]=u*y+h*_+l*M,o[7]=u*g+h*v+l*A,o[2]=f*d+p*x+m*w,o[5]=f*y+p*_+m*M,o[8]=f*g+p*v+m*A,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],h=t[8];return e*s*h-e*a*u-r*o*h+r*a*c+i*o*u-i*s*c}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],h=t[8],l=h*s-a*u,f=a*c-h*o,p=u*o-s*c,m=e*l+r*f+i*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const d=1/m;return t[0]=l*d,t[1]=(i*u-h*r)*d,t[2]=(a*r-i*s)*d,t[3]=f*d,t[4]=(h*e-i*c)*d,t[5]=(i*o-a*e)*d,t[6]=p*d,t[7]=(r*c-u*e)*d,t[8]=(s*e-r*o)*d,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,i,o,s,a){const c=Math.cos(o),u=Math.sin(o);return this.set(r*c,r*u,-r*(c*s+u*a)+s+t,-i*u,i*c,-i*(-u*s+c*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Ln.makeScale(t,e)),this}rotate(t){return this.premultiply(Ln.makeRotation(-t)),this}translate(t,e){return this.premultiply(Ln.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,r,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,r=t.elements;for(let i=0;i<9;i++)if(e[i]!==r[i])return!1;return!0}fromArray(t,e=0){for(let r=0;r<9;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ln=new Fe;function Au(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function Hr(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const Wr={};function kn(n){n in Wr||(Wr[n]=!0,console.warn(n))}function Vn(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}let de;class Pu{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{de===void 0&&(de=Hr("canvas")),de.width=t.width,de.height=t.height;const r=de.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=de}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Hr("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const i=r.getImageData(0,0,t.width,t.height),o=i.data;for(let s=0;s<o.length;s++)o[s]=Vn(o[s]/255)*255;return r.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let r=0;r<e.length;r++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[r]=Math.floor(Vn(e[r]/255)*255):e[r]=Vn(e[r]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let zu=0;class Cu{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:zu++}),this.uuid=rn(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?o.push(Nn(i[s].image)):o.push(Nn(i[s]))}else o=Nn(i);r.url=o}return e||(t.images[this.uuid]=r),r}}function Nn(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Pu.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Tu=0;class he extends lr{constructor(t=he.DEFAULT_IMAGE,e=he.DEFAULT_MAPPING,r=ln,i=ln,o=_u,s=vu,a=Mu,c=bu,u=he.DEFAULT_ANISOTROPY,h=Gn){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Tu++}),this.uuid=rn(),this.name="",this.source=new Cu(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=o,this.minFilter=s,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=c,this.offset=new R(0,0),this.repeat=new R(1,1),this.center=new R(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Fe,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof h=="string"?this.colorSpace=h:(kn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===Fn?Rn:Gn),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),e||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==co)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Dr:t.x=t.x-Math.floor(t.x);break;case ln:t.x=t.x<0?0:1;break;case $r:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Dr:t.y=t.y-Math.floor(t.y);break;case ln:t.y=t.y<0?0:1;break;case $r:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return kn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Rn?Fn:Su}set encoding(t){kn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Fn?Rn:Gn}}he.DEFAULT_IMAGE=null;he.DEFAULT_MAPPING=co;he.DEFAULT_ANISOTROPY=1;class on{constructor(t=0,e=0,r=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=r,this._w=i}static slerpFlat(t,e,r,i,o,s,a){let c=r[i+0],u=r[i+1],h=r[i+2],l=r[i+3];const f=o[s+0],p=o[s+1],m=o[s+2],d=o[s+3];if(a===0){t[e+0]=c,t[e+1]=u,t[e+2]=h,t[e+3]=l;return}if(a===1){t[e+0]=f,t[e+1]=p,t[e+2]=m,t[e+3]=d;return}if(l!==d||c!==f||u!==p||h!==m){let y=1-a;const g=c*f+u*p+h*m+l*d,x=g>=0?1:-1,_=1-g*g;if(_>Number.EPSILON){const w=Math.sqrt(_),M=Math.atan2(w,g*x);y=Math.sin(y*M)/w,a=Math.sin(a*M)/w}const v=a*x;if(c=c*y+f*v,u=u*y+p*v,h=h*y+m*v,l=l*y+d*v,y===1-a){const w=1/Math.sqrt(c*c+u*u+h*h+l*l);c*=w,u*=w,h*=w,l*=w}}t[e]=c,t[e+1]=u,t[e+2]=h,t[e+3]=l}static multiplyQuaternionsFlat(t,e,r,i,o,s){const a=r[i],c=r[i+1],u=r[i+2],h=r[i+3],l=o[s],f=o[s+1],p=o[s+2],m=o[s+3];return t[e]=a*m+h*l+c*p-u*f,t[e+1]=c*m+h*f+u*l-a*p,t[e+2]=u*m+h*p+a*f-c*l,t[e+3]=h*m-a*l-c*f-u*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const r=t._x,i=t._y,o=t._z,s=t._order,a=Math.cos,c=Math.sin,u=a(r/2),h=a(i/2),l=a(o/2),f=c(r/2),p=c(i/2),m=c(o/2);switch(s){case"XYZ":this._x=f*h*l+u*p*m,this._y=u*p*l-f*h*m,this._z=u*h*m+f*p*l,this._w=u*h*l-f*p*m;break;case"YXZ":this._x=f*h*l+u*p*m,this._y=u*p*l-f*h*m,this._z=u*h*m-f*p*l,this._w=u*h*l+f*p*m;break;case"ZXY":this._x=f*h*l-u*p*m,this._y=u*p*l+f*h*m,this._z=u*h*m+f*p*l,this._w=u*h*l-f*p*m;break;case"ZYX":this._x=f*h*l-u*p*m,this._y=u*p*l+f*h*m,this._z=u*h*m-f*p*l,this._w=u*h*l+f*p*m;break;case"YZX":this._x=f*h*l+u*p*m,this._y=u*p*l+f*h*m,this._z=u*h*m-f*p*l,this._w=u*h*l-f*p*m;break;case"XZY":this._x=f*h*l-u*p*m,this._y=u*p*l-f*h*m,this._z=u*h*m+f*p*l,this._w=u*h*l+f*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const r=e/2,i=Math.sin(r);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,r=e[0],i=e[4],o=e[8],s=e[1],a=e[5],c=e[9],u=e[2],h=e[6],l=e[10],f=r+a+l;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-c)*p,this._y=(o-u)*p,this._z=(s-i)*p}else if(r>a&&r>l){const p=2*Math.sqrt(1+r-a-l);this._w=(h-c)/p,this._x=.25*p,this._y=(i+s)/p,this._z=(o+u)/p}else if(a>l){const p=2*Math.sqrt(1+a-r-l);this._w=(o-u)/p,this._x=(i+s)/p,this._y=.25*p,this._z=(c+h)/p}else{const p=2*Math.sqrt(1+l-r-a);this._w=(s-i)/p,this._x=(o+u)/p,this._y=(c+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let r=t.dot(e)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(zt(this.dot(t),-1,1)))}rotateTowards(t,e){const r=this.angleTo(t);if(r===0)return this;const i=Math.min(1,e/r);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const r=t._x,i=t._y,o=t._z,s=t._w,a=e._x,c=e._y,u=e._z,h=e._w;return this._x=r*h+s*a+i*u-o*c,this._y=i*h+s*c+o*a-r*u,this._z=o*h+s*u+r*c-i*a,this._w=s*h-r*a-i*c-o*u,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const r=this._x,i=this._y,o=this._z,s=this._w;let a=s*t._w+r*t._x+i*t._y+o*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=r,this._y=i,this._z=o,this;const c=1-a*a;if(c<=Number.EPSILON){const p=1-e;return this._w=p*s+e*this._w,this._x=p*r+e*this._x,this._y=p*i+e*this._y,this._z=p*o+e*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(c),h=Math.atan2(u,a),l=Math.sin((1-e)*h)/u,f=Math.sin(e*h)/u;return this._w=s*l+this._w*f,this._x=r*l+this._x*f,this._y=i*l+this._y*f,this._z=o*l+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,e,r){return this.copy(t).slerp(e,r)}random(){const t=Math.random(),e=Math.sqrt(1-t),r=Math.sqrt(t),i=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(e*Math.cos(i),r*Math.sin(o),r*Math.cos(o),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class S{constructor(t=0,e=0,r=0){S.prototype.isVector3=!0,this.x=t,this.y=e,this.z=r}set(t,e,r){return r===void 0&&(r=this.z),this.x=t,this.y=e,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Yr.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Yr.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,r=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[3]*r+o[6]*i,this.y=o[1]*e+o[4]*r+o[7]*i,this.z=o[2]*e+o[5]*r+o[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,r=this.y,i=this.z,o=t.elements,s=1/(o[3]*e+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*e+o[4]*r+o[8]*i+o[12])*s,this.y=(o[1]*e+o[5]*r+o[9]*i+o[13])*s,this.z=(o[2]*e+o[6]*r+o[10]*i+o[14])*s,this}applyQuaternion(t){const e=this.x,r=this.y,i=this.z,o=t.x,s=t.y,a=t.z,c=t.w,u=c*e+s*i-a*r,h=c*r+a*e-o*i,l=c*i+o*r-s*e,f=-o*e-s*r-a*i;return this.x=u*c+f*-o+h*-a-l*-s,this.y=h*c+f*-s+l*-o-u*-a,this.z=l*c+f*-a+u*-s-h*-o,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,r=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[4]*r+o[8]*i,this.y=o[1]*e+o[5]*r+o[9]*i,this.z=o[2]*e+o[6]*r+o[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const r=t.x,i=t.y,o=t.z,s=e.x,a=e.y,c=e.z;return this.x=i*c-o*a,this.y=o*s-r*c,this.z=r*a-i*s,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return In.copy(this).projectOnVector(t),this.sub(In)}reflect(t){return this.sub(In.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(zt(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,r){const i=Math.sin(e)*t;return this.x=i*Math.sin(r),this.y=Math.cos(e)*t,this.z=i*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(e),this.y=r*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const In=new S,Yr=new on;class sn{constructor(t=new S(1/0,1/0,1/0),e=new S(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e+=3)this.expandByPoint(It.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,r=t.count;e<r;e++)this.expandByPoint(It.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=It.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),t.boundingBox!==void 0)t.boundingBox===null&&t.computeBoundingBox(),ge.copy(t.boundingBox),ge.applyMatrix4(t.matrixWorld),this.union(ge);else{const i=t.geometry;if(i!==void 0)if(e&&i.attributes!==void 0&&i.attributes.position!==void 0){const o=i.attributes.position;for(let s=0,a=o.count;s<a;s++)It.fromBufferAttribute(o,s).applyMatrix4(t.matrixWorld),this.expandByPoint(It)}else i.boundingBox===null&&i.computeBoundingBox(),ge.copy(i.boundingBox),ge.applyMatrix4(t.matrixWorld),this.union(ge)}const r=t.children;for(let i=0,o=r.length;i<o;i++)this.expandByObject(r[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,It),It.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ke),pn.subVectors(this.max,ke),xe.subVectors(t.a,ke),_e.subVectors(t.b,ke),ve.subVectors(t.c,ke),jt.subVectors(_e,xe),Jt.subVectors(ve,_e),ce.subVectors(xe,ve);let e=[0,-jt.z,jt.y,0,-Jt.z,Jt.y,0,-ce.z,ce.y,jt.z,0,-jt.x,Jt.z,0,-Jt.x,ce.z,0,-ce.x,-jt.y,jt.x,0,-Jt.y,Jt.x,0,-ce.y,ce.x,0];return!Dn(e,xe,_e,ve,pn)||(e=[1,0,0,0,1,0,0,0,1],!Dn(e,xe,_e,ve,pn))?!1:(mn.crossVectors(jt,Jt),e=[mn.x,mn.y,mn.z],Dn(e,xe,_e,ve,pn))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,It).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(It).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Nt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Nt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Nt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Nt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Nt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Nt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Nt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Nt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Nt),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Nt=[new S,new S,new S,new S,new S,new S,new S,new S],It=new S,ge=new sn,xe=new S,_e=new S,ve=new S,jt=new S,Jt=new S,ce=new S,ke=new S,pn=new S,mn=new S,ue=new S;function Dn(n,t,e,r,i){for(let o=0,s=n.length-3;o<=s;o+=3){ue.fromArray(n,o);const a=i.x*Math.abs(ue.x)+i.y*Math.abs(ue.y)+i.z*Math.abs(ue.z),c=t.dot(ue),u=e.dot(ue),h=r.dot(ue);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>a)return!1}return!0}const Eu=new sn,Ve=new S,$n=new S;class Bu{constructor(t=new S,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const r=this.center;e!==void 0?r.copy(e):Eu.setFromPoints(t).getCenter(r);let i=0;for(let o=0,s=t.length;o<s;o++)i=Math.max(i,r.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const r=this.center.distanceToSquared(t);return e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ve.subVectors(t,this.center);const e=Ve.lengthSq();if(e>this.radius*this.radius){const r=Math.sqrt(e),i=(r-this.radius)*.5;this.center.addScaledVector(Ve,i/r),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):($n.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ve.copy(t.center).add($n)),this.expandByPoint(Ve.copy(t.center).sub($n))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}class Et{constructor(t,e,r,i,o,s,a,c,u,h,l,f,p,m,d,y){Et.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,r,i,o,s,a,c,u,h,l,f,p,m,d,y)}set(t,e,r,i,o,s,a,c,u,h,l,f,p,m,d,y){const g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=i,g[1]=o,g[5]=s,g[9]=a,g[13]=c,g[2]=u,g[6]=h,g[10]=l,g[14]=f,g[3]=p,g[7]=m,g[11]=d,g[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Et().fromArray(this.elements)}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}copyPosition(t){const e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,r=t.elements,i=1/be.setFromMatrixColumn(t,0).length(),o=1/be.setFromMatrixColumn(t,1).length(),s=1/be.setFromMatrixColumn(t,2).length();return e[0]=r[0]*i,e[1]=r[1]*i,e[2]=r[2]*i,e[3]=0,e[4]=r[4]*o,e[5]=r[5]*o,e[6]=r[6]*o,e[7]=0,e[8]=r[8]*s,e[9]=r[9]*s,e[10]=r[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,r=t.x,i=t.y,o=t.z,s=Math.cos(r),a=Math.sin(r),c=Math.cos(i),u=Math.sin(i),h=Math.cos(o),l=Math.sin(o);if(t.order==="XYZ"){const f=s*h,p=s*l,m=a*h,d=a*l;e[0]=c*h,e[4]=-c*l,e[8]=u,e[1]=p+m*u,e[5]=f-d*u,e[9]=-a*c,e[2]=d-f*u,e[6]=m+p*u,e[10]=s*c}else if(t.order==="YXZ"){const f=c*h,p=c*l,m=u*h,d=u*l;e[0]=f+d*a,e[4]=m*a-p,e[8]=s*u,e[1]=s*l,e[5]=s*h,e[9]=-a,e[2]=p*a-m,e[6]=d+f*a,e[10]=s*c}else if(t.order==="ZXY"){const f=c*h,p=c*l,m=u*h,d=u*l;e[0]=f-d*a,e[4]=-s*l,e[8]=m+p*a,e[1]=p+m*a,e[5]=s*h,e[9]=d-f*a,e[2]=-s*u,e[6]=a,e[10]=s*c}else if(t.order==="ZYX"){const f=s*h,p=s*l,m=a*h,d=a*l;e[0]=c*h,e[4]=m*u-p,e[8]=f*u+d,e[1]=c*l,e[5]=d*u+f,e[9]=p*u-m,e[2]=-u,e[6]=a*c,e[10]=s*c}else if(t.order==="YZX"){const f=s*c,p=s*u,m=a*c,d=a*u;e[0]=c*h,e[4]=d-f*l,e[8]=m*l+p,e[1]=l,e[5]=s*h,e[9]=-a*h,e[2]=-u*h,e[6]=p*l+m,e[10]=f-d*l}else if(t.order==="XZY"){const f=s*c,p=s*u,m=a*c,d=a*u;e[0]=c*h,e[4]=-l,e[8]=u*h,e[1]=f*l+d,e[5]=s*h,e[9]=p*l-m,e[2]=m*l-p,e[6]=a*h,e[10]=d*l+f}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ou,t,Uu)}lookAt(t,e,r){const i=this.elements;return St.subVectors(t,e),St.lengthSq()===0&&(St.z=1),St.normalize(),Zt.crossVectors(r,St),Zt.lengthSq()===0&&(Math.abs(r.z)===1?St.x+=1e-4:St.z+=1e-4,St.normalize(),Zt.crossVectors(r,St)),Zt.normalize(),yn.crossVectors(St,Zt),i[0]=Zt.x,i[4]=yn.x,i[8]=St.x,i[1]=Zt.y,i[5]=yn.y,i[9]=St.y,i[2]=Zt.z,i[6]=yn.z,i[10]=St.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,o=this.elements,s=r[0],a=r[4],c=r[8],u=r[12],h=r[1],l=r[5],f=r[9],p=r[13],m=r[2],d=r[6],y=r[10],g=r[14],x=r[3],_=r[7],v=r[11],w=r[15],M=i[0],A=i[4],T=i[8],U=i[12],C=i[1],O=i[5],B=i[9],E=i[13],z=i[2],F=i[6],G=i[10],k=i[14],L=i[3],$=i[7],X=i[11],Y=i[15];return o[0]=s*M+a*C+c*z+u*L,o[4]=s*A+a*O+c*F+u*$,o[8]=s*T+a*B+c*G+u*X,o[12]=s*U+a*E+c*k+u*Y,o[1]=h*M+l*C+f*z+p*L,o[5]=h*A+l*O+f*F+p*$,o[9]=h*T+l*B+f*G+p*X,o[13]=h*U+l*E+f*k+p*Y,o[2]=m*M+d*C+y*z+g*L,o[6]=m*A+d*O+y*F+g*$,o[10]=m*T+d*B+y*G+g*X,o[14]=m*U+d*E+y*k+g*Y,o[3]=x*M+_*C+v*z+w*L,o[7]=x*A+_*O+v*F+w*$,o[11]=x*T+_*B+v*G+w*X,o[15]=x*U+_*E+v*k+w*Y,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[4],i=t[8],o=t[12],s=t[1],a=t[5],c=t[9],u=t[13],h=t[2],l=t[6],f=t[10],p=t[14],m=t[3],d=t[7],y=t[11],g=t[15];return m*(+o*c*l-i*u*l-o*a*f+r*u*f+i*a*p-r*c*p)+d*(+e*c*p-e*u*f+o*s*f-i*s*p+i*u*h-o*c*h)+y*(+e*u*l-e*a*p-o*s*l+r*s*p+o*a*h-r*u*h)+g*(-i*a*h-e*c*l+e*a*f+i*s*l-r*s*f+r*c*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,r){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=r),this}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],h=t[8],l=t[9],f=t[10],p=t[11],m=t[12],d=t[13],y=t[14],g=t[15],x=l*y*u-d*f*u+d*c*p-a*y*p-l*c*g+a*f*g,_=m*f*u-h*y*u-m*c*p+s*y*p+h*c*g-s*f*g,v=h*d*u-m*l*u+m*a*p-s*d*p-h*a*g+s*l*g,w=m*l*c-h*d*c-m*a*f+s*d*f+h*a*y-s*l*y,M=e*x+r*_+i*v+o*w;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/M;return t[0]=x*A,t[1]=(d*f*o-l*y*o-d*i*p+r*y*p+l*i*g-r*f*g)*A,t[2]=(a*y*o-d*c*o+d*i*u-r*y*u-a*i*g+r*c*g)*A,t[3]=(l*c*o-a*f*o-l*i*u+r*f*u+a*i*p-r*c*p)*A,t[4]=_*A,t[5]=(h*y*o-m*f*o+m*i*p-e*y*p-h*i*g+e*f*g)*A,t[6]=(m*c*o-s*y*o-m*i*u+e*y*u+s*i*g-e*c*g)*A,t[7]=(s*f*o-h*c*o+h*i*u-e*f*u-s*i*p+e*c*p)*A,t[8]=v*A,t[9]=(m*l*o-h*d*o-m*r*p+e*d*p+h*r*g-e*l*g)*A,t[10]=(s*d*o-m*a*o+m*r*u-e*d*u-s*r*g+e*a*g)*A,t[11]=(h*a*o-s*l*o-h*r*u+e*l*u+s*r*p-e*a*p)*A,t[12]=w*A,t[13]=(h*d*i-m*l*i+m*r*f-e*d*f-h*r*y+e*l*y)*A,t[14]=(m*a*i-s*d*i-m*r*c+e*d*c+s*r*y-e*a*y)*A,t[15]=(s*l*i-h*a*i+h*r*c-e*l*c-s*r*f+e*a*f)*A,this}scale(t){const e=this.elements,r=t.x,i=t.y,o=t.z;return e[0]*=r,e[4]*=i,e[8]*=o,e[1]*=r,e[5]*=i,e[9]*=o,e[2]*=r,e[6]*=i,e[10]*=o,e[3]*=r,e[7]*=i,e[11]*=o,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}makeTranslation(t,e,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const r=Math.cos(e),i=Math.sin(e),o=1-r,s=t.x,a=t.y,c=t.z,u=o*s,h=o*a;return this.set(u*s+r,u*a-i*c,u*c+i*a,0,u*a+i*c,h*a+r,h*c-i*s,0,u*c-i*a,h*c+i*s,o*c*c+r,0,0,0,0,1),this}makeScale(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,e,r,i,o,s){return this.set(1,r,o,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,r){const i=this.elements,o=e._x,s=e._y,a=e._z,c=e._w,u=o+o,h=s+s,l=a+a,f=o*u,p=o*h,m=o*l,d=s*h,y=s*l,g=a*l,x=c*u,_=c*h,v=c*l,w=r.x,M=r.y,A=r.z;return i[0]=(1-(d+g))*w,i[1]=(p+v)*w,i[2]=(m-_)*w,i[3]=0,i[4]=(p-v)*M,i[5]=(1-(f+g))*M,i[6]=(y+x)*M,i[7]=0,i[8]=(m+_)*A,i[9]=(y-x)*A,i[10]=(1-(f+d))*A,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,r){const i=this.elements;let o=be.set(i[0],i[1],i[2]).length();const s=be.set(i[4],i[5],i[6]).length(),a=be.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),t.x=i[12],t.y=i[13],t.z=i[14],Tt.copy(this);const u=1/o,h=1/s,l=1/a;return Tt.elements[0]*=u,Tt.elements[1]*=u,Tt.elements[2]*=u,Tt.elements[4]*=h,Tt.elements[5]*=h,Tt.elements[6]*=h,Tt.elements[8]*=l,Tt.elements[9]*=l,Tt.elements[10]*=l,e.setFromRotationMatrix(Tt),r.x=o,r.y=s,r.z=a,this}makePerspective(t,e,r,i,o,s,a=fn){const c=this.elements,u=2*o/(e-t),h=2*o/(r-i),l=(e+t)/(e-t),f=(r+i)/(r-i);let p,m;if(a===fn)p=-(s+o)/(s-o),m=-2*s*o/(s-o);else if(a===Xr)p=-s/(s-o),m=-s*o/(s-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=l,c[12]=0,c[1]=0,c[5]=h,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=m,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,r,i,o,s,a=fn){const c=this.elements,u=1/(e-t),h=1/(r-i),l=1/(s-o),f=(e+t)*u,p=(r+i)*h;let m,d;if(a===fn)m=(s+o)*l,d=-2*l;else if(a===Xr)m=o*l,d=-1*l;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*h,c[9]=0,c[13]=-p,c[2]=0,c[6]=0,c[10]=d,c[14]=-m,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){const e=this.elements,r=t.elements;for(let i=0;i<16;i++)if(e[i]!==r[i])return!1;return!0}fromArray(t,e=0){for(let r=0;r<16;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}const be=new S,Tt=new Et,Ou=new S(0,0,0),Uu=new S(1,1,1),Zt=new S,yn=new S,St=new S,jr=new Et,Jr=new on;class Cn{constructor(t=0,e=0,r=0,i=Cn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,r,i=this._order){return this._x=t,this._y=e,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,r=!0){const i=t.elements,o=i[0],s=i[4],a=i[8],c=i[1],u=i[5],h=i[9],l=i[2],f=i[6],p=i[10];switch(e){case"XYZ":this._y=Math.asin(zt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-zt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-l,o),this._z=0);break;case"ZXY":this._x=Math.asin(zt(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-l,p),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-zt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,u));break;case"YZX":this._z=Math.asin(zt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-l,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-zt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,r){return jr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(jr,e,r)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Jr.setFromEuler(this),this.setFromQuaternion(Jr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Cn.DEFAULT_ORDER="XYZ";class Fu{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Gu=0;const Zr=new S,we=new on,Dt=new Et,dn=new S,Ne=new S,Ru=new S,Lu=new on,Qr=new S(1,0,0),Kr=new S(0,1,0),ti=new S(0,0,1),ku={type:"added"},ei={type:"removed"};class ne extends lr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Gu++}),this.uuid=rn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ne.DEFAULT_UP.clone();const t=new S,e=new Cn,r=new on,i=new S(1,1,1);function o(){r.setFromEuler(e,!1)}function s(){e.setFromQuaternion(r,void 0,!1)}e._onChange(o),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Et},normalMatrix:{value:new Fe}}),this.matrix=new Et,this.matrixWorld=new Et,this.matrixAutoUpdate=ne.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ne.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Fu,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return we.setFromAxisAngle(t,e),this.quaternion.multiply(we),this}rotateOnWorldAxis(t,e){return we.setFromAxisAngle(t,e),this.quaternion.premultiply(we),this}rotateX(t){return this.rotateOnAxis(Qr,t)}rotateY(t){return this.rotateOnAxis(Kr,t)}rotateZ(t){return this.rotateOnAxis(ti,t)}translateOnAxis(t,e){return Zr.copy(t).applyQuaternion(this.quaternion),this.position.add(Zr.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Qr,t)}translateY(t){return this.translateOnAxis(Kr,t)}translateZ(t){return this.translateOnAxis(ti,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Dt.copy(this.matrixWorld).invert())}lookAt(t,e,r){t.isVector3?dn.copy(t):dn.set(t,e,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Ne.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Dt.lookAt(Ne,dn,this.up):Dt.lookAt(dn,Ne,this.up),this.quaternion.setFromRotationMatrix(Dt),i&&(Dt.extractRotation(i.matrixWorld),we.setFromRotationMatrix(Dt),this.quaternion.premultiply(we.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ku)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ei)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(ei)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Dt.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Dt.multiply(t.parent.matrixWorld)),t.applyMatrix4(Dt),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r].getObjectByProperty(t,e);if(s!==void 0)return s}}getObjectsByProperty(t,e){let r=[];this[t]===e&&r.push(this);for(let i=0,o=this.children.length;i<o;i++){const s=this.children[i].getObjectsByProperty(t,e);s.length>0&&(r=r.concat(s))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ne,t,Ru),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ne,Lu,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let r=0,i=e.length;r<i;r++){const o=e[r];(o.matrixWorldAutoUpdate===!0||t===!0)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const r=this.parent;if(t===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const i=this.children;for(let o=0,s=i.length;o<s;o++){const a=i[o];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function o(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let u=0,h=c.length;u<h;u++){const l=c[u];o(t.shapes,l)}else o(t.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,u=this.material.length;c<u;c++)a.push(o(t.materials,this.material[c]));i.material=a}else i.material=o(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(o(t.animations,c))}}if(e){const a=s(t.geometries),c=s(t.materials),u=s(t.textures),h=s(t.images),l=s(t.shapes),f=s(t.skeletons),p=s(t.animations),m=s(t.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),u.length>0&&(r.textures=u),h.length>0&&(r.images=h),l.length>0&&(r.shapes=l),f.length>0&&(r.skeletons=f),p.length>0&&(r.animations=p),m.length>0&&(r.nodes=m)}return r.object=i,r;function s(a){const c=[];for(const u in a){const h=a[u];delete h.metadata,c.push(h)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let r=0;r<t.children.length;r++){const i=t.children[r];this.add(i.clone())}return this}}ne.DEFAULT_UP=new S(0,1,0);ne.DEFAULT_MATRIX_AUTO_UPDATE=!0;ne.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ht=new S,gn=new R;class Oe{constructor(t,e,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=r,this.usage=qr,this.updateRange={offset:0,count:-1},this.gpuType=wu,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,r){t*=this.itemSize,r*=e.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[t+i]=e.array[r+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,r=this.count;e<r;e++)gn.fromBufferAttribute(this,e),gn.applyMatrix3(t),this.setXY(e,gn.x,gn.y);else if(this.itemSize===3)for(let e=0,r=this.count;e<r;e++)ht.fromBufferAttribute(this,e),ht.applyMatrix3(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}applyMatrix4(t){for(let e=0,r=this.count;e<r;e++)ht.fromBufferAttribute(this,e),ht.applyMatrix4(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)ht.fromBufferAttribute(this,e),ht.applyNormalMatrix(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)ht.fromBufferAttribute(this,e),ht.transformDirection(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let r=this.array[t*this.itemSize+e];return this.normalized&&(r=Le(r,this.array)),r}setComponent(t,e,r){return this.normalized&&(r=wt(r,this.array)),this.array[t*this.itemSize+e]=r,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Le(e,this.array)),e}setX(t,e){return this.normalized&&(e=wt(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Le(e,this.array)),e}setY(t,e){return this.normalized&&(e=wt(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Le(e,this.array)),e}setZ(t,e){return this.normalized&&(e=wt(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Le(e,this.array)),e}setW(t,e){return this.normalized&&(e=wt(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,r){return t*=this.itemSize,this.normalized&&(e=wt(e,this.array),r=wt(r,this.array)),this.array[t+0]=e,this.array[t+1]=r,this}setXYZ(t,e,r,i){return t*=this.itemSize,this.normalized&&(e=wt(e,this.array),r=wt(r,this.array),i=wt(i,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this}setXYZW(t,e,r,i,o){return t*=this.itemSize,this.normalized&&(e=wt(e,this.array),r=wt(r,this.array),i=wt(i,this.array),o=wt(o,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this.array[t+3]=o,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==qr&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}}class Vu extends Oe{constructor(t,e,r){super(new Uint16Array(t),e,r)}}class Nu extends Oe{constructor(t,e,r){super(new Uint32Array(t),e,r)}}class q extends Oe{constructor(t,e,r){super(new Float32Array(t),e,r)}}let Iu=0;const Pt=new Et,qn=new ne,Me=new S,At=new sn,Ie=new sn,yt=new S;class Ct extends lr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Iu++}),this.uuid=rn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Au(t)?Nu:Vu)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,r=0){this.groups.push({start:t,count:e,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new Fe().getNormalMatrix(t);r.applyNormalMatrix(o),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Pt.makeRotationFromQuaternion(t),this.applyMatrix4(Pt),this}rotateX(t){return Pt.makeRotationX(t),this.applyMatrix4(Pt),this}rotateY(t){return Pt.makeRotationY(t),this.applyMatrix4(Pt),this}rotateZ(t){return Pt.makeRotationZ(t),this.applyMatrix4(Pt),this}translate(t,e,r){return Pt.makeTranslation(t,e,r),this.applyMatrix4(Pt),this}scale(t,e,r){return Pt.makeScale(t,e,r),this.applyMatrix4(Pt),this}lookAt(t){return qn.lookAt(t),qn.updateMatrix(),this.applyMatrix4(qn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Me).negate(),this.translate(Me.x,Me.y,Me.z),this}setFromPoints(t){const e=[];for(let r=0,i=t.length;r<i;r++){const o=t[r];e.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new q(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new sn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let r=0,i=e.length;r<i;r++){const o=e[r];At.setFromBufferAttribute(o),this.morphTargetsRelative?(yt.addVectors(this.boundingBox.min,At.min),this.boundingBox.expandByPoint(yt),yt.addVectors(this.boundingBox.max,At.max),this.boundingBox.expandByPoint(yt)):(this.boundingBox.expandByPoint(At.min),this.boundingBox.expandByPoint(At.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bu);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new S,1/0);return}if(t){const r=this.boundingSphere.center;if(At.setFromBufferAttribute(t),e)for(let o=0,s=e.length;o<s;o++){const a=e[o];Ie.setFromBufferAttribute(a),this.morphTargetsRelative?(yt.addVectors(At.min,Ie.min),At.expandByPoint(yt),yt.addVectors(At.max,Ie.max),At.expandByPoint(yt)):(At.expandByPoint(Ie.min),At.expandByPoint(Ie.max))}At.getCenter(r);let i=0;for(let o=0,s=t.count;o<s;o++)yt.fromBufferAttribute(t,o),i=Math.max(i,r.distanceToSquared(yt));if(e)for(let o=0,s=e.length;o<s;o++){const a=e[o],c=this.morphTargetsRelative;for(let u=0,h=a.count;u<h;u++)yt.fromBufferAttribute(a,u),c&&(Me.fromBufferAttribute(t,u),yt.add(Me)),i=Math.max(i,r.distanceToSquared(yt))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.array,i=e.position.array,o=e.normal.array,s=e.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Oe(new Float32Array(4*a),4));const c=this.getAttribute("tangent").array,u=[],h=[];for(let C=0;C<a;C++)u[C]=new S,h[C]=new S;const l=new S,f=new S,p=new S,m=new R,d=new R,y=new R,g=new S,x=new S;function _(C,O,B){l.fromArray(i,C*3),f.fromArray(i,O*3),p.fromArray(i,B*3),m.fromArray(s,C*2),d.fromArray(s,O*2),y.fromArray(s,B*2),f.sub(l),p.sub(l),d.sub(m),y.sub(m);const E=1/(d.x*y.y-y.x*d.y);isFinite(E)&&(g.copy(f).multiplyScalar(y.y).addScaledVector(p,-d.y).multiplyScalar(E),x.copy(p).multiplyScalar(d.x).addScaledVector(f,-y.x).multiplyScalar(E),u[C].add(g),u[O].add(g),u[B].add(g),h[C].add(x),h[O].add(x),h[B].add(x))}let v=this.groups;v.length===0&&(v=[{start:0,count:r.length}]);for(let C=0,O=v.length;C<O;++C){const B=v[C],E=B.start,z=B.count;for(let F=E,G=E+z;F<G;F+=3)_(r[F+0],r[F+1],r[F+2])}const w=new S,M=new S,A=new S,T=new S;function U(C){A.fromArray(o,C*3),T.copy(A);const O=u[C];w.copy(O),w.sub(A.multiplyScalar(A.dot(O))).normalize(),M.crossVectors(T,O);const E=M.dot(h[C])<0?-1:1;c[C*4]=w.x,c[C*4+1]=w.y,c[C*4+2]=w.z,c[C*4+3]=E}for(let C=0,O=v.length;C<O;++C){const B=v[C],E=B.start,z=B.count;for(let F=E,G=E+z;F<G;F+=3)U(r[F+0]),U(r[F+1]),U(r[F+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Oe(new Float32Array(e.count*3),3),this.setAttribute("normal",r);else for(let f=0,p=r.count;f<p;f++)r.setXYZ(f,0,0,0);const i=new S,o=new S,s=new S,a=new S,c=new S,u=new S,h=new S,l=new S;if(t)for(let f=0,p=t.count;f<p;f+=3){const m=t.getX(f+0),d=t.getX(f+1),y=t.getX(f+2);i.fromBufferAttribute(e,m),o.fromBufferAttribute(e,d),s.fromBufferAttribute(e,y),h.subVectors(s,o),l.subVectors(i,o),h.cross(l),a.fromBufferAttribute(r,m),c.fromBufferAttribute(r,d),u.fromBufferAttribute(r,y),a.add(h),c.add(h),u.add(h),r.setXYZ(m,a.x,a.y,a.z),r.setXYZ(d,c.x,c.y,c.z),r.setXYZ(y,u.x,u.y,u.z)}else for(let f=0,p=e.count;f<p;f+=3)i.fromBufferAttribute(e,f+0),o.fromBufferAttribute(e,f+1),s.fromBufferAttribute(e,f+2),h.subVectors(s,o),l.subVectors(i,o),h.cross(l),r.setXYZ(f+0,h.x,h.y,h.z),r.setXYZ(f+1,h.x,h.y,h.z),r.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,r=t.count;e<r;e++)yt.fromBufferAttribute(t,e),yt.normalize(),t.setXYZ(e,yt.x,yt.y,yt.z)}toNonIndexed(){function t(a,c){const u=a.array,h=a.itemSize,l=a.normalized,f=new u.constructor(c.length*h);let p=0,m=0;for(let d=0,y=c.length;d<y;d++){a.isInterleavedBufferAttribute?p=c[d]*a.data.stride+a.offset:p=c[d]*h;for(let g=0;g<h;g++)f[m++]=u[p++]}return new Oe(f,h,l)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ct,r=this.index.array,i=this.attributes;for(const a in i){const c=i[a],u=t(c,r);e.setAttribute(a,u)}const o=this.morphAttributes;for(const a in o){const c=[],u=o[a];for(let h=0,l=u.length;h<l;h++){const f=u[h],p=t(f,r);c.push(p)}e.morphAttributes[a]=c}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,c=s.length;a<c;a++){const u=s[a];e.addGroup(u.start,u.count,u.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const u in c)c[u]!==void 0&&(t[u]=c[u]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const r=this.attributes;for(const c in r){const u=r[c];t.data.attributes[c]=u.toJSON(t.data)}const i={};let o=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],h=[];for(let l=0,f=u.length;l<f;l++){const p=u[l];h.push(p.toJSON(t.data))}h.length>0&&(i[c]=h,o=!0)}o&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone(e));const i=t.attributes;for(const u in i){const h=i[u];this.setAttribute(u,h.clone(e))}const o=t.morphAttributes;for(const u in o){const h=[],l=o[u];for(let f=0,p=l.length;f<p;f++)h.push(l[f].clone(e));this.morphAttributes[u]=h}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let u=0,h=s.length;u<h;u++){const l=s[u];this.addGroup(l.start,l.count,l.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}class fr extends Ct{constructor(t=1,e=1,r=1,i=1,o=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:i,heightSegments:o,depthSegments:s};const a=this;i=Math.floor(i),o=Math.floor(o),s=Math.floor(s);const c=[],u=[],h=[],l=[];let f=0,p=0;m("z","y","x",-1,-1,r,e,t,s,o,0),m("z","y","x",1,-1,r,e,-t,s,o,1),m("x","z","y",1,1,t,r,e,i,s,2),m("x","z","y",1,-1,t,r,-e,i,s,3),m("x","y","z",1,-1,t,e,r,i,o,4),m("x","y","z",-1,-1,t,e,-r,i,o,5),this.setIndex(c),this.setAttribute("position",new q(u,3)),this.setAttribute("normal",new q(h,3)),this.setAttribute("uv",new q(l,2));function m(d,y,g,x,_,v,w,M,A,T,U){const C=v/A,O=w/T,B=v/2,E=w/2,z=M/2,F=A+1,G=T+1;let k=0,L=0;const $=new S;for(let X=0;X<G;X++){const Y=X*O-E;for(let ut=0;ut<F;ut++){const mt=ut*C-B;$[d]=mt*x,$[y]=Y*_,$[g]=z,u.push($.x,$.y,$.z),$[d]=0,$[y]=0,$[g]=M>0?1:-1,h.push($.x,$.y,$.z),l.push(ut/A),l.push(1-X/T),k+=1}}for(let X=0;X<T;X++)for(let Y=0;Y<A;Y++){const ut=f+Y+F*X,mt=f+Y+F*(X+1),ct=f+(Y+1)+F*(X+1),V=f+(Y+1)+F*X;c.push(ut,mt,V),c.push(mt,ct,V),L+=6}a.addGroup(p,L,U),p+=L,f+=k}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new fr(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}class pr extends Ct{constructor(t=1,e=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:i};const o=t/2,s=e/2,a=Math.floor(r),c=Math.floor(i),u=a+1,h=c+1,l=t/a,f=e/c,p=[],m=[],d=[],y=[];for(let g=0;g<h;g++){const x=g*f-s;for(let _=0;_<u;_++){const v=_*l-o;m.push(v,-x,0),d.push(0,0,1),y.push(_/a),y.push(1-g/c)}}for(let g=0;g<c;g++)for(let x=0;x<a;x++){const _=x+u*g,v=x+u*(g+1),w=x+1+u*(g+1),M=x+1+u*g;p.push(_,v,M),p.push(v,w,M)}this.setIndex(p),this.setAttribute("position",new q(m,3)),this.setAttribute("normal",new q(d,3)),this.setAttribute("uv",new q(y,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new pr(t.width,t.height,t.widthSegments,t.heightSegments)}}class Rt{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const r=this.getUtoTmapping(t);return this.getPoint(r,e)}getPoints(t=5){const e=[];for(let r=0;r<=t;r++)e.push(this.getPoint(r/t));return e}getSpacedPoints(t=5){const e=[];for(let r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let r,i=this.getPoint(0),o=0;e.push(0);for(let s=1;s<=t;s++)r=this.getPoint(s/t),o+=r.distanceTo(i),e.push(o),i=r;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const r=this.getLengths();let i=0;const o=r.length;let s;e?s=e:s=t*r[o-1];let a=0,c=o-1,u;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),u=r[i]-s,u<0)a=i+1;else if(u>0)c=i-1;else{c=i;break}if(i=c,r[i]===s)return i/(o-1);const h=r[i],f=r[i+1]-h,p=(s-h)/f;return(i+p)/(o-1)}getTangent(t,e){let i=t-1e-4,o=t+1e-4;i<0&&(i=0),o>1&&(o=1);const s=this.getPoint(i),a=this.getPoint(o),c=e||(s.isVector2?new R:new S);return c.copy(a).sub(s).normalize(),c}getTangentAt(t,e){const r=this.getUtoTmapping(t);return this.getTangent(r,e)}computeFrenetFrames(t,e){const r=new S,i=[],o=[],s=[],a=new S,c=new Et;for(let p=0;p<=t;p++){const m=p/t;i[p]=this.getTangentAt(m,new S)}o[0]=new S,s[0]=new S;let u=Number.MAX_VALUE;const h=Math.abs(i[0].x),l=Math.abs(i[0].y),f=Math.abs(i[0].z);h<=u&&(u=h,r.set(1,0,0)),l<=u&&(u=l,r.set(0,1,0)),f<=u&&r.set(0,0,1),a.crossVectors(i[0],r).normalize(),o[0].crossVectors(i[0],a),s[0].crossVectors(i[0],o[0]);for(let p=1;p<=t;p++){if(o[p]=o[p-1].clone(),s[p]=s[p-1].clone(),a.crossVectors(i[p-1],i[p]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(zt(i[p-1].dot(i[p]),-1,1));o[p].applyMatrix4(c.makeRotationAxis(a,m))}s[p].crossVectors(i[p],o[p])}if(e===!0){let p=Math.acos(zt(o[0].dot(o[t]),-1,1));p/=t,i[0].dot(a.crossVectors(o[0],o[t]))>0&&(p=-p);for(let m=1;m<=t;m++)o[m].applyMatrix4(c.makeRotationAxis(i[m],p*m)),s[m].crossVectors(i[m],o[m])}return{tangents:i,normals:o,binormals:s}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class mr extends Rt{constructor(t=0,e=0,r=1,i=1,o=0,s=Math.PI*2,a=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=r,this.yRadius=i,this.aStartAngle=o,this.aEndAngle=s,this.aClockwise=a,this.aRotation=c}getPoint(t,e){const r=e||new R,i=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const s=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=i;for(;o>i;)o-=i;o<Number.EPSILON&&(s?o=0:o=i),this.aClockwise===!0&&!s&&(o===i?o=-i:o=o-i);const a=this.aStartAngle+t*o;let c=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),l=Math.sin(this.aRotation),f=c-this.aX,p=u-this.aY;c=f*h-p*l+this.aX,u=f*l+p*h+this.aY}return r.set(c,u)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Du extends mr{constructor(t,e,r,i,o,s){super(t,e,r,r,i,o,s),this.isArcCurve=!0,this.type="ArcCurve"}}function yr(){let n=0,t=0,e=0,r=0;function i(o,s,a,c){n=o,t=a,e=-3*o+3*s-2*a-c,r=2*o-2*s+a+c}return{initCatmullRom:function(o,s,a,c,u){i(s,a,u*(a-o),u*(c-s))},initNonuniformCatmullRom:function(o,s,a,c,u,h,l){let f=(s-o)/u-(a-o)/(u+h)+(a-s)/h,p=(a-s)/h-(c-s)/(h+l)+(c-a)/l;f*=h,p*=h,i(s,a,f,p)},calc:function(o){const s=o*o,a=s*o;return n+t*o+e*s+r*a}}}const xn=new S,Xn=new yr,Hn=new yr,Wn=new yr;class $u extends Rt{constructor(t=[],e=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=r,this.tension=i}getPoint(t,e=new S){const r=e,i=this.points,o=i.length,s=(o-(this.closed?0:1))*t;let a=Math.floor(s),c=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/o)+1)*o:c===0&&a===o-1&&(a=o-2,c=1);let u,h;this.closed||a>0?u=i[(a-1)%o]:(xn.subVectors(i[0],i[1]).add(i[0]),u=xn);const l=i[a%o],f=i[(a+1)%o];if(this.closed||a+2<o?h=i[(a+2)%o]:(xn.subVectors(i[o-1],i[o-2]).add(i[o-1]),h=xn),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let m=Math.pow(u.distanceToSquared(l),p),d=Math.pow(l.distanceToSquared(f),p),y=Math.pow(f.distanceToSquared(h),p);d<1e-4&&(d=1),m<1e-4&&(m=d),y<1e-4&&(y=d),Xn.initNonuniformCatmullRom(u.x,l.x,f.x,h.x,m,d,y),Hn.initNonuniformCatmullRom(u.y,l.y,f.y,h.y,m,d,y),Wn.initNonuniformCatmullRom(u.z,l.z,f.z,h.z,m,d,y)}else this.curveType==="catmullrom"&&(Xn.initCatmullRom(u.x,l.x,f.x,h.x,this.tension),Hn.initCatmullRom(u.y,l.y,f.y,h.y,this.tension),Wn.initCatmullRom(u.z,l.z,f.z,h.z,this.tension));return r.set(Xn.calc(c),Hn.calc(c),Wn.calc(c)),r}copy(t){super.copy(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,r=this.points.length;e<r;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const i=t.points[e];this.points.push(new S().fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function ni(n,t,e,r,i){const o=(r-t)*.5,s=(i-e)*.5,a=n*n,c=n*a;return(2*e-2*r+o+s)*c+(-3*e+3*r-2*o-s)*a+o*n+e}function qu(n,t){const e=1-n;return e*e*t}function Xu(n,t){return 2*(1-n)*n*t}function Hu(n,t){return n*n*t}function He(n,t,e,r){return qu(n,t)+Xu(n,e)+Hu(n,r)}function Wu(n,t){const e=1-n;return e*e*e*t}function Yu(n,t){const e=1-n;return 3*e*e*n*t}function ju(n,t){return 3*(1-n)*n*n*t}function Ju(n,t){return n*n*n*t}function We(n,t,e,r,i){return Wu(n,t)+Yu(n,e)+ju(n,r)+Ju(n,i)}class uo extends Rt{constructor(t=new R,e=new R,r=new R,i=new R){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=r,this.v3=i}getPoint(t,e=new R){const r=e,i=this.v0,o=this.v1,s=this.v2,a=this.v3;return r.set(We(t,i.x,o.x,s.x,a.x),We(t,i.y,o.y,s.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Zu extends Rt{constructor(t=new S,e=new S,r=new S,i=new S){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=r,this.v3=i}getPoint(t,e=new S){const r=e,i=this.v0,o=this.v1,s=this.v2,a=this.v3;return r.set(We(t,i.x,o.x,s.x,a.x),We(t,i.y,o.y,s.y,a.y),We(t,i.z,o.z,s.z,a.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class dr extends Rt{constructor(t=new R,e=new R){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new R){const r=e;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new R){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Qu extends Rt{constructor(t=new S,e=new S){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new S){const r=e;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new S){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ho extends Rt{constructor(t=new R,e=new R,r=new R){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=r}getPoint(t,e=new R){const r=e,i=this.v0,o=this.v1,s=this.v2;return r.set(He(t,i.x,o.x,s.x),He(t,i.y,o.y,s.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ku extends Rt{constructor(t=new S,e=new S,r=new S){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=r}getPoint(t,e=new S){const r=e,i=this.v0,o=this.v1,s=this.v2;return r.set(He(t,i.x,o.x,s.x),He(t,i.y,o.y,s.y),He(t,i.z,o.z,s.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class lo extends Rt{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new R){const r=e,i=this.points,o=(i.length-1)*t,s=Math.floor(o),a=o-s,c=i[s===0?s:s-1],u=i[s],h=i[s>i.length-2?i.length-1:s+1],l=i[s>i.length-3?i.length-1:s+2];return r.set(ni(a,c.x,u.x,h.x,l.x),ni(a,c.y,u.y,h.y,l.y)),r}copy(t){super.copy(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,r=this.points.length;e<r;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const i=t.points[e];this.points.push(new R().fromArray(i))}return this}}var th=Object.freeze({__proto__:null,ArcCurve:Du,CatmullRomCurve3:$u,CubicBezierCurve:uo,CubicBezierCurve3:Zu,EllipseCurve:mr,LineCurve:dr,LineCurve3:Qu,QuadraticBezierCurve:ho,QuadraticBezierCurve3:Ku,SplineCurve:lo});class eh extends Rt{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new dr(e,t))}getPoint(t,e){const r=t*this.getLength(),i=this.getCurveLengths();let o=0;for(;o<i.length;){if(i[o]>=r){const s=i[o]-r,a=this.curves[o],c=a.getLength(),u=c===0?0:1-s/c;return a.getPointAt(u,e)}o++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let r=0,i=this.curves.length;r<i;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let r;for(let i=0,o=this.curves;i<o.length;i++){const s=o[i],a=s.isEllipseCurve?t*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,c=s.getPoints(a);for(let u=0;u<c.length;u++){const h=c[u];r&&r.equals(h)||(e.push(h),r=h)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,r=t.curves.length;e<r;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,r=this.curves.length;e<r;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,r=t.curves.length;e<r;e++){const i=t.curves[e];this.curves.push(new th[i.type]().fromJSON(i))}return this}}class Qn extends eh{constructor(t){super(),this.type="Path",this.currentPoint=new R,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const r=new dr(this.currentPoint.clone(),new R(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,r,i){const o=new ho(this.currentPoint.clone(),new R(t,e),new R(r,i));return this.curves.push(o),this.currentPoint.set(r,i),this}bezierCurveTo(t,e,r,i,o,s){const a=new uo(this.currentPoint.clone(),new R(t,e),new R(r,i),new R(o,s));return this.curves.push(a),this.currentPoint.set(o,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),r=new lo(e);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,r,i,o,s){const a=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(t+a,e+c,r,i,o,s),this}absarc(t,e,r,i,o,s){return this.absellipse(t,e,r,r,i,o,s),this}ellipse(t,e,r,i,o,s,a,c){const u=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+u,e+h,r,i,o,s,a,c),this}absellipse(t,e,r,i,o,s,a,c){const u=new mr(t,e,r,i,o,s,a,c);if(this.curves.length>0){const l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);const h=u.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class gr extends Ct{constructor(t=[new R(0,-.5),new R(.5,0),new R(0,.5)],e=12,r=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},e=Math.floor(e),i=zt(i,0,Math.PI*2);const o=[],s=[],a=[],c=[],u=[],h=1/e,l=new S,f=new R,p=new S,m=new S,d=new S;let y=0,g=0;for(let x=0;x<=t.length-1;x++)switch(x){case 0:y=t[x+1].x-t[x].x,g=t[x+1].y-t[x].y,p.x=g*1,p.y=-y,p.z=g*0,d.copy(p),p.normalize(),c.push(p.x,p.y,p.z);break;case t.length-1:c.push(d.x,d.y,d.z);break;default:y=t[x+1].x-t[x].x,g=t[x+1].y-t[x].y,p.x=g*1,p.y=-y,p.z=g*0,m.copy(p),p.x+=d.x,p.y+=d.y,p.z+=d.z,p.normalize(),c.push(p.x,p.y,p.z),d.copy(m)}for(let x=0;x<=e;x++){const _=r+x*h*i,v=Math.sin(_),w=Math.cos(_);for(let M=0;M<=t.length-1;M++){l.x=t[M].x*v,l.y=t[M].y,l.z=t[M].x*w,s.push(l.x,l.y,l.z),f.x=x/e,f.y=M/(t.length-1),a.push(f.x,f.y);const A=c[3*M+0]*v,T=c[3*M+1],U=c[3*M+0]*w;u.push(A,T,U)}}for(let x=0;x<e;x++)for(let _=0;_<t.length-1;_++){const v=_+x*t.length,w=v,M=v+t.length,A=v+t.length+1,T=v+1;o.push(w,M,T),o.push(A,T,M)}this.setIndex(o),this.setAttribute("position",new q(s,3)),this.setAttribute("uv",new q(a,2)),this.setAttribute("normal",new q(u,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new gr(t.points,t.segments,t.phiStart,t.phiLength)}}class xr extends gr{constructor(t=1,e=1,r=4,i=8){const o=new Qn;o.absarc(0,-e/2,t,Math.PI*1.5,0),o.absarc(0,e/2,t,0,Math.PI*.5),super(o.getPoints(r),i),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:r,radialSegments:i}}static fromJSON(t){return new xr(t.radius,t.length,t.capSegments,t.radialSegments)}}class _r extends Ct{constructor(t=1,e=32,r=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},e=Math.max(3,e);const o=[],s=[],a=[],c=[],u=new S,h=new R;s.push(0,0,0),a.push(0,0,1),c.push(.5,.5);for(let l=0,f=3;l<=e;l++,f+=3){const p=r+l/e*i;u.x=t*Math.cos(p),u.y=t*Math.sin(p),s.push(u.x,u.y,u.z),a.push(0,0,1),h.x=(s[f]/t+1)/2,h.y=(s[f+1]/t+1)/2,c.push(h.x,h.y)}for(let l=1;l<=e;l++)o.push(l,l+1,0);this.setIndex(o),this.setAttribute("position",new q(s,3)),this.setAttribute("normal",new q(a,3)),this.setAttribute("uv",new q(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new _r(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Tn extends Ct{constructor(t=1,e=1,r=1,i=32,o=1,s=!1,a=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:c};const u=this;i=Math.floor(i),o=Math.floor(o);const h=[],l=[],f=[],p=[];let m=0;const d=[],y=r/2;let g=0;x(),s===!1&&(t>0&&_(!0),e>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new q(l,3)),this.setAttribute("normal",new q(f,3)),this.setAttribute("uv",new q(p,2));function x(){const v=new S,w=new S;let M=0;const A=(e-t)/r;for(let T=0;T<=o;T++){const U=[],C=T/o,O=C*(e-t)+t;for(let B=0;B<=i;B++){const E=B/i,z=E*c+a,F=Math.sin(z),G=Math.cos(z);w.x=O*F,w.y=-C*r+y,w.z=O*G,l.push(w.x,w.y,w.z),v.set(F,A,G).normalize(),f.push(v.x,v.y,v.z),p.push(E,1-C),U.push(m++)}d.push(U)}for(let T=0;T<i;T++)for(let U=0;U<o;U++){const C=d[U][T],O=d[U+1][T],B=d[U+1][T+1],E=d[U][T+1];h.push(C,O,E),h.push(O,B,E),M+=6}u.addGroup(g,M,0),g+=M}function _(v){const w=m,M=new R,A=new S;let T=0;const U=v===!0?t:e,C=v===!0?1:-1;for(let B=1;B<=i;B++)l.push(0,y*C,0),f.push(0,C,0),p.push(.5,.5),m++;const O=m;for(let B=0;B<=i;B++){const z=B/i*c+a,F=Math.cos(z),G=Math.sin(z);A.x=U*G,A.y=y*C,A.z=U*F,l.push(A.x,A.y,A.z),f.push(0,C,0),M.x=F*.5+.5,M.y=G*.5*C+.5,p.push(M.x,M.y),m++}for(let B=0;B<i;B++){const E=w+B,z=O+B;v===!0?h.push(z,z+1,E):h.push(z+1,z,E),T+=3}u.addGroup(g,T,v===!0?1:2),g+=T}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Tn(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class vr extends Tn{constructor(t=1,e=1,r=32,i=1,o=!1,s=0,a=Math.PI*2){super(0,t,e,r,i,o,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a}}static fromJSON(t){return new vr(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class fo extends Qn{constructor(t){super(t),this.uuid=rn(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let r=0,i=this.holes.length;r<i;r++)e[r]=this.holes[r].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,r=t.holes.length;e<r;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,r=this.holes.length;e<r;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,r=t.holes.length;e<r;e++){const i=t.holes[e];this.holes.push(new Qn().fromJSON(i))}return this}}const nh={triangulate:function(n,t,e=2){const r=t&&t.length,i=r?t[0]*e:n.length;let o=po(n,0,i,e,!0);const s=[];if(!o||o.next===o.prev)return s;let a,c,u,h,l,f,p;if(r&&(o=ah(n,t,o,e)),n.length>80*e){a=u=n[0],c=h=n[1];for(let m=e;m<i;m+=e)l=n[m],f=n[m+1],l<a&&(a=l),f<c&&(c=f),l>u&&(u=l),f>h&&(h=f);p=Math.max(u-a,h-c),p=p!==0?32767/p:0}return Qe(o,s,e,a,c,p,0),s}};function po(n,t,e,r,i){let o,s;if(i===xh(n,t,e,r)>0)for(o=t;o<e;o+=r)s=ri(o,n[o],n[o+1],s);else for(o=e-r;o>=t;o-=r)s=ri(o,n[o],n[o+1],s);return s&&En(s,s.next)&&(tn(s),s=s.next),s}function fe(n,t){if(!n)return n;t||(t=n);let e=n,r;do if(r=!1,!e.steiner&&(En(e,e.next)||st(e.prev,e,e.next)===0)){if(tn(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function Qe(n,t,e,r,i,o,s){if(!n)return;!s&&o&&fh(n,r,i,o);let a=n,c,u;for(;n.prev!==n.next;){if(c=n.prev,u=n.next,o?ih(n,r,i,o):rh(n)){t.push(c.i/e|0),t.push(n.i/e|0),t.push(u.i/e|0),tn(n),n=u.next,a=u.next;continue}if(n=u,n===a){s?s===1?(n=oh(fe(n),t,e),Qe(n,t,e,r,i,o,2)):s===2&&sh(n,t,e,r,i,o):Qe(fe(n),t,e,r,i,o,1);break}}}function rh(n){const t=n.prev,e=n,r=n.next;if(st(t,e,r)>=0)return!1;const i=t.x,o=e.x,s=r.x,a=t.y,c=e.y,u=r.y,h=i<o?i<s?i:s:o<s?o:s,l=a<c?a<u?a:u:c<u?c:u,f=i>o?i>s?i:s:o>s?o:s,p=a>c?a>u?a:u:c>u?c:u;let m=r.next;for(;m!==t;){if(m.x>=h&&m.x<=f&&m.y>=l&&m.y<=p&&Ce(i,a,o,c,s,u,m.x,m.y)&&st(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function ih(n,t,e,r){const i=n.prev,o=n,s=n.next;if(st(i,o,s)>=0)return!1;const a=i.x,c=o.x,u=s.x,h=i.y,l=o.y,f=s.y,p=a<c?a<u?a:u:c<u?c:u,m=h<l?h<f?h:f:l<f?l:f,d=a>c?a>u?a:u:c>u?c:u,y=h>l?h>f?h:f:l>f?l:f,g=Kn(p,m,t,e,r),x=Kn(d,y,t,e,r);let _=n.prevZ,v=n.nextZ;for(;_&&_.z>=g&&v&&v.z<=x;){if(_.x>=p&&_.x<=d&&_.y>=m&&_.y<=y&&_!==i&&_!==s&&Ce(a,h,c,l,u,f,_.x,_.y)&&st(_.prev,_,_.next)>=0||(_=_.prevZ,v.x>=p&&v.x<=d&&v.y>=m&&v.y<=y&&v!==i&&v!==s&&Ce(a,h,c,l,u,f,v.x,v.y)&&st(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;_&&_.z>=g;){if(_.x>=p&&_.x<=d&&_.y>=m&&_.y<=y&&_!==i&&_!==s&&Ce(a,h,c,l,u,f,_.x,_.y)&&st(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;v&&v.z<=x;){if(v.x>=p&&v.x<=d&&v.y>=m&&v.y<=y&&v!==i&&v!==s&&Ce(a,h,c,l,u,f,v.x,v.y)&&st(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function oh(n,t,e){let r=n;do{const i=r.prev,o=r.next.next;!En(i,o)&&mo(i,r,r.next,o)&&Ke(i,o)&&Ke(o,i)&&(t.push(i.i/e|0),t.push(r.i/e|0),t.push(o.i/e|0),tn(r),tn(r.next),r=n=o),r=r.next}while(r!==n);return fe(r)}function sh(n,t,e,r,i,o){let s=n;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&yh(s,a)){let c=yo(s,a);s=fe(s,s.next),c=fe(c,c.next),Qe(s,t,e,r,i,o,0),Qe(c,t,e,r,i,o,0);return}a=a.next}s=s.next}while(s!==n)}function ah(n,t,e,r){const i=[];let o,s,a,c,u;for(o=0,s=t.length;o<s;o++)a=t[o]*r,c=o<s-1?t[o+1]*r:n.length,u=po(n,a,c,r,!1),u===u.next&&(u.steiner=!0),i.push(mh(u));for(i.sort(ch),o=0;o<i.length;o++)e=uh(i[o],e);return e}function ch(n,t){return n.x-t.x}function uh(n,t){const e=hh(n,t);if(!e)return t;const r=yo(e,n);return fe(r,r.next),fe(e,e.next)}function hh(n,t){let e=t,r=-1/0,i;const o=n.x,s=n.y;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const f=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(f<=o&&f>r&&(r=f,i=e.x<e.next.x?e:e.next,f===o))return i}e=e.next}while(e!==t);if(!i)return null;const a=i,c=i.x,u=i.y;let h=1/0,l;e=i;do o>=e.x&&e.x>=c&&o!==e.x&&Ce(s<u?o:r,s,c,u,s<u?r:o,s,e.x,e.y)&&(l=Math.abs(s-e.y)/(o-e.x),Ke(e,n)&&(l<h||l===h&&(e.x>i.x||e.x===i.x&&lh(i,e)))&&(i=e,h=l)),e=e.next;while(e!==a);return i}function lh(n,t){return st(n.prev,n,t.prev)<0&&st(t.next,n,n.next)<0}function fh(n,t,e,r){let i=n;do i.z===0&&(i.z=Kn(i.x,i.y,t,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,ph(i)}function ph(n){let t,e,r,i,o,s,a,c,u=1;do{for(e=n,n=null,o=null,s=0;e;){for(s++,r=e,a=0,t=0;t<u&&(a++,r=r.nextZ,!!r);t++);for(c=u;a>0||c>0&&r;)a!==0&&(c===0||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:n=i,i.prevZ=o,o=i;e=r}o.nextZ=null,u*=2}while(s>1);return n}function Kn(n,t,e,r,i){return n=(n-e)*i|0,t=(t-r)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1}function mh(n){let t=n,e=n;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==n);return e}function Ce(n,t,e,r,i,o,s,a){return(i-s)*(t-a)>=(n-s)*(o-a)&&(n-s)*(r-a)>=(e-s)*(t-a)&&(e-s)*(o-a)>=(i-s)*(r-a)}function yh(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!dh(n,t)&&(Ke(n,t)&&Ke(t,n)&&gh(n,t)&&(st(n.prev,n,t.prev)||st(n,t.prev,t))||En(n,t)&&st(n.prev,n,n.next)>0&&st(t.prev,t,t.next)>0)}function st(n,t,e){return(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y)}function En(n,t){return n.x===t.x&&n.y===t.y}function mo(n,t,e,r){const i=vn(st(n,t,e)),o=vn(st(n,t,r)),s=vn(st(e,r,n)),a=vn(st(e,r,t));return!!(i!==o&&s!==a||i===0&&_n(n,e,t)||o===0&&_n(n,r,t)||s===0&&_n(e,n,r)||a===0&&_n(e,t,r))}function _n(n,t,e){return t.x<=Math.max(n.x,e.x)&&t.x>=Math.min(n.x,e.x)&&t.y<=Math.max(n.y,e.y)&&t.y>=Math.min(n.y,e.y)}function vn(n){return n>0?1:n<0?-1:0}function dh(n,t){let e=n;do{if(e.i!==n.i&&e.next.i!==n.i&&e.i!==t.i&&e.next.i!==t.i&&mo(e,e.next,n,t))return!0;e=e.next}while(e!==n);return!1}function Ke(n,t){return st(n.prev,n,n.next)<0?st(n,t,n.next)>=0&&st(n,n.prev,t)>=0:st(n,t,n.prev)<0||st(n,n.next,t)<0}function gh(n,t){let e=n,r=!1;const i=(n.x+t.x)/2,o=(n.y+t.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&i<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==n);return r}function yo(n,t){const e=new tr(n.i,n.x,n.y),r=new tr(t.i,t.x,t.y),i=n.next,o=t.prev;return n.next=t,t.prev=n,e.next=i,i.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function ri(n,t,e,r){const i=new tr(n,t,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function tn(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function tr(n,t,e){this.i=n,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xh(n,t,e,r){let i=0;for(let o=t,s=e-r;o<e;o+=r)i+=(n[s]-n[o])*(n[o+1]+n[s+1]),s=o;return i}class Ye{static area(t){const e=t.length;let r=0;for(let i=e-1,o=0;o<e;i=o++)r+=t[i].x*t[o].y-t[o].x*t[i].y;return r*.5}static isClockWise(t){return Ye.area(t)<0}static triangulateShape(t,e){const r=[],i=[],o=[];ii(t),oi(r,t);let s=t.length;e.forEach(ii);for(let c=0;c<e.length;c++)i.push(s),s+=e[c].length,oi(r,e[c]);const a=nh.triangulate(r,i);for(let c=0;c<a.length;c+=3)o.push(a.slice(c,c+3));return o}}function ii(n){const t=n.length;t>2&&n[t-1].equals(n[0])&&n.pop()}function oi(n,t){for(let e=0;e<t.length;e++)n.push(t[e].x),n.push(t[e].y)}class br extends Ct{constructor(t=.5,e=1,r=32,i=1,o=0,s=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:s},r=Math.max(3,r),i=Math.max(1,i);const a=[],c=[],u=[],h=[];let l=t;const f=(e-t)/i,p=new S,m=new R;for(let d=0;d<=i;d++){for(let y=0;y<=r;y++){const g=o+y/r*s;p.x=l*Math.cos(g),p.y=l*Math.sin(g),c.push(p.x,p.y,p.z),u.push(0,0,1),m.x=(p.x/e+1)/2,m.y=(p.y/e+1)/2,h.push(m.x,m.y)}l+=f}for(let d=0;d<i;d++){const y=d*(r+1);for(let g=0;g<r;g++){const x=g+y,_=x,v=x+r+1,w=x+r+2,M=x+1;a.push(_,v,M),a.push(v,w,M)}}this.setIndex(a),this.setAttribute("position",new q(c,3)),this.setAttribute("normal",new q(u,3)),this.setAttribute("uv",new q(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new br(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class wr extends Ct{constructor(t=new fo([new R(0,.5),new R(-.5,-.5),new R(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const r=[],i=[],o=[],s=[];let a=0,c=0;if(Array.isArray(t)===!1)u(t);else for(let h=0;h<t.length;h++)u(t[h]),this.addGroup(a,c,h),a+=c,c=0;this.setIndex(r),this.setAttribute("position",new q(i,3)),this.setAttribute("normal",new q(o,3)),this.setAttribute("uv",new q(s,2));function u(h){const l=i.length/3,f=h.extractPoints(e);let p=f.shape;const m=f.holes;Ye.isClockWise(p)===!1&&(p=p.reverse());for(let y=0,g=m.length;y<g;y++){const x=m[y];Ye.isClockWise(x)===!0&&(m[y]=x.reverse())}const d=Ye.triangulateShape(p,m);for(let y=0,g=m.length;y<g;y++){const x=m[y];p=p.concat(x)}for(let y=0,g=p.length;y<g;y++){const x=p[y];i.push(x.x,x.y,0),o.push(0,0,1),s.push(x.x,x.y)}for(let y=0,g=d.length;y<g;y++){const x=d[y],_=x[0]+l,v=x[1]+l,w=x[2]+l;r.push(_,v,w),c+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return _h(e,t)}static fromJSON(t,e){const r=[];for(let i=0,o=t.shapes.length;i<o;i++){const s=e[t.shapes[i]];r.push(s)}return new wr(r,t.curveSegments)}}function _h(n,t){if(t.shapes=[],Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const i=n[e];t.shapes.push(i.uuid)}else t.shapes.push(n.uuid);return t}class Mr extends Ct{constructor(t=1,e=32,r=16,i=0,o=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:i,phiLength:o,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),r=Math.max(2,Math.floor(r));const c=Math.min(s+a,Math.PI);let u=0;const h=[],l=new S,f=new S,p=[],m=[],d=[],y=[];for(let g=0;g<=r;g++){const x=[],_=g/r;let v=0;g===0&&s===0?v=.5/e:g===r&&c===Math.PI&&(v=-.5/e);for(let w=0;w<=e;w++){const M=w/e;l.x=-t*Math.cos(i+M*o)*Math.sin(s+_*a),l.y=t*Math.cos(s+_*a),l.z=t*Math.sin(i+M*o)*Math.sin(s+_*a),m.push(l.x,l.y,l.z),f.copy(l).normalize(),d.push(f.x,f.y,f.z),y.push(M+v,1-_),x.push(u++)}h.push(x)}for(let g=0;g<r;g++)for(let x=0;x<e;x++){const _=h[g][x+1],v=h[g][x],w=h[g+1][x],M=h[g+1][x+1];(g!==0||s>0)&&p.push(_,v,M),(g!==r-1||c<Math.PI)&&p.push(v,w,M)}this.setIndex(p),this.setAttribute("position",new q(m,3)),this.setAttribute("normal",new q(d,3)),this.setAttribute("uv",new q(y,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Mr(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Sr extends Ct{constructor(t=1,e=.4,r=12,i=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:i,arc:o},r=Math.floor(r),i=Math.floor(i);const s=[],a=[],c=[],u=[],h=new S,l=new S,f=new S;for(let p=0;p<=r;p++)for(let m=0;m<=i;m++){const d=m/i*o,y=p/r*Math.PI*2;l.x=(t+e*Math.cos(y))*Math.cos(d),l.y=(t+e*Math.cos(y))*Math.sin(d),l.z=e*Math.sin(y),a.push(l.x,l.y,l.z),h.x=t*Math.cos(d),h.y=t*Math.sin(d),f.subVectors(l,h).normalize(),c.push(f.x,f.y,f.z),u.push(m/i),u.push(p/r)}for(let p=1;p<=r;p++)for(let m=1;m<=i;m++){const d=(i+1)*p+m-1,y=(i+1)*(p-1)+m-1,g=(i+1)*(p-1)+m,x=(i+1)*p+m;s.push(d,y,x),s.push(y,g,x)}this.setIndex(s),this.setAttribute("position",new q(a,3)),this.setAttribute("normal",new q(c,3)),this.setAttribute("uv",new q(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Sr(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Ar extends Ct{constructor(t=1,e=.4,r=64,i=8,o=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:i,p:o,q:s},r=Math.floor(r),i=Math.floor(i);const a=[],c=[],u=[],h=[],l=new S,f=new S,p=new S,m=new S,d=new S,y=new S,g=new S;for(let _=0;_<=r;++_){const v=_/r*o*Math.PI*2;x(v,o,s,t,p),x(v+.01,o,s,t,m),y.subVectors(m,p),g.addVectors(m,p),d.crossVectors(y,g),g.crossVectors(d,y),d.normalize(),g.normalize();for(let w=0;w<=i;++w){const M=w/i*Math.PI*2,A=-e*Math.cos(M),T=e*Math.sin(M);l.x=p.x+(A*g.x+T*d.x),l.y=p.y+(A*g.y+T*d.y),l.z=p.z+(A*g.z+T*d.z),c.push(l.x,l.y,l.z),f.subVectors(l,p).normalize(),u.push(f.x,f.y,f.z),h.push(_/r),h.push(w/i)}}for(let _=1;_<=r;_++)for(let v=1;v<=i;v++){const w=(i+1)*(_-1)+(v-1),M=(i+1)*_+(v-1),A=(i+1)*_+v,T=(i+1)*(_-1)+v;a.push(w,M,T),a.push(M,A,T)}this.setIndex(a),this.setAttribute("position",new q(c,3)),this.setAttribute("normal",new q(u,3)),this.setAttribute("uv",new q(h,2));function x(_,v,w,M,A){const T=Math.cos(_),U=Math.sin(_),C=w/v*_,O=Math.cos(C);A.x=M*(2+O)*.5*T,A.y=M*(2+O)*U*.5,A.z=M*Math.sin(C)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ar(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ao}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ao);async function si(n,t,e,r,i,o,s){const a=await n.createRenderPipelineAsync({label:"ThreeGeometryPipeline",layout:e,vertex:{module:n.createShaderModule({code:i}),entryPoint:"main",buffers:[{arrayStride:32,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x3"},{shaderLocation:2,offset:24,format:"float32x2"}]}]},fragment:{module:n.createShaderModule({code:o}),entryPoint:"main",targets:[{format:t,blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"zero",dstFactor:"zero",operation:"add"}}}]},primitive:{topology:s.topologyIsline_list?"triangle-list":"line-list",cullMode:"none",frontFace:"ccw"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"}});let c;if(r=="BoxGeometry")c=new fr(1,1,1,10,10,10);else if(r=="CapsuleGeometry")c=new xr(1,1,32,64);else if(r=="CircleGeometry")c=new _r(1,32);else if(r=="ConeGeometry")c=new vr(1,1,32);else if(r=="CylinderGeometry")c=new Tn(1,1,1,32);else if(r=="PlaneGeometry")c=new pr(2,2,192,192);else if(r=="RingGeometry")c=new br(.5,1,32);else if(r=="ShapeGeometry"){const v=new fo;v.moveTo(0+.5,0+.5),v.bezierCurveTo(0+.5,0+.5,0+.4,0,0,0),v.bezierCurveTo(0-.6,0,0-.6,0+.7,0-.6,0+.7),v.bezierCurveTo(0-.6,0+1.1,0-.3,0+1.54,0+.5,0+1.9),v.bezierCurveTo(0+1.2,0+1.54,0+1.6,0+1.1,0+1.6,0+.7),v.bezierCurveTo(0+1.6,0+.7,0+1.6,0,0+1,0),v.bezierCurveTo(0+.7,0,0+.5,0+.5,0+.5,0+.5),c=new wr(v)}else r=="SphereGeometry"?c=new Mr(1,32,16):r=="TorusGeometry"?c=new Sr(1,.3,16,100):r=="TorusKnotGeometry"&&(c=new Ar(1,.3,100,16));if(c==null)throw new Error;let u=c.attributes.normal.array,h=c.attributes.uv.array,l=c.attributes.position.array,f=c.attributes.position.count,p=new Float32Array(f*8);for(let x=0;x<f;x++)p[x*8+0]=l[x*3+0],p[x*8+1]=l[x*3+1],p[x*8+2]=l[x*3+2],p[x*8+3]=u[x*3+0],p[x*8+4]=u[x*3+1],p[x*8+5]=u[x*3+2],p[x*8+6]=h[x*2+0],p[x*8+7]=h[x*2+1];if(c.index==null)throw new Error;let m=c.index.array,d=c.index.count;const y=n.createBuffer({label:"GPUBuffer store vertex",size:p.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE}),g=n.createBuffer({label:"GPUBuffer store vertex index",size:m.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE});return n.queue.writeBuffer(g,0,m),n.queue.writeBuffer(y,0,p),{ThreeGeometryPipeline:a,vertexindexFromThree:g,vertexBufferFromThree:y,arrayFromThreeIndexCount:d}}function vh(n){const t=n.createBindGroupLayout({label:"SkyBoxBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"cube",multisampled:!1}}]}),e=n.createPipelineLayout({bindGroupLayouts:[t]}),r=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:5,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),i=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,texture:{sampleType:"depth"}},{binding:4,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,sampler:{type:"comparison"}},{binding:5,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),o=n.createPipelineLayout({bindGroupLayouts:[r,i]}),s=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:5,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:6,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:7,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),a=n.createPipelineLayout({bindGroupLayouts:[s,i]});return{SkyBoxBindGroupLayout:t,SkyBoxPipelineLayout:e,initThreeGeometryBindingGroupLayout:s,initThreeGeometryPipelineLayout:a,initflatThreeGeometryBindingGroupLayout1:r,initflatThreeGeometryBindingGroupLayout2:i,initflatThreeGeometryPipelineLayout:o}}const bh=`@binding(0) @group(0) var lastFrameTexture: texture_2d<f32>;\r
@binding(1) @group(0) var mySampler: sampler;\r
@binding(5) @group(0) var<uniform> lightPosition : vec4<f32>;\r
@binding(2) @group(1) var cubeTextureImg: texture_2d<f32>;\r
@binding(3) @group(1) var shadowMap: texture_depth_2d;\r
@binding(4) @group(1)  var shadowSampler: sampler_comparison;\r
\r
@fragment\r
fn main(\r
    @location(0) fragUV : vec2<f32>,\r
    @location(1) fragPosition: vec3<f32>,\r
    @location(2) fragNormal: vec3<f32>,\r
    @location(3) timeOfFrag: f32,\r
    @location(4) shadowPos: vec3<f32>,\r
    @location(5) chooseFragmentAttr1: vec4<f32>,\r
    @location(6) chooseFragmentAttr2: vec4<f32>,\r
    @location(7) chooseFragmentAttr3: vec4<f32>,\r
    @location(8) chooseFragmentAttr4: vec4<f32>\r
) -> @location(0) vec4<f32> {    \r
    // 上一帧画面\r
    let texColor = textureSample(lastFrameTexture, mySampler, fragUV * 0.8 + vec2(0.1));\r
    let f = select(1.0, 0.0, length(texColor.rgb - vec3(0.5)) < 0.01);\r
    // 图片\r
    let texColor_img1 = textureSample(cubeTextureImg, mySampler, fragUV * 0.8 + vec2(0.1));\r
    // 图片 + UV坐标复合\r
    let texColor_img = textureSample(cubeTextureImg, mySampler, fragUV);\r
    // 图片 + 渐变 + 上一帧画面 + 阴影\r
    // Directional Light   点积且排除夹角为钝角情况--这意味着该点在灯光背面\r
    let diffuse: f32 = max(dot(normalize(lightPosition.xyz), fragNormal), 0.0);\r
    // add shadow factor\r
    var shadow : f32 = 0.0;\r
    // // apply Percentage-closer filtering (PCF)\r
    // // sample nearest 9 texels to smooth result\r
    let size = f32(textureDimensions(shadowMap).x);\r
    for (var y : i32 = -1 ; y <= 1 ; y = y + 1) {\r
        for (var x : i32 = -1 ; x <= 1 ; x = x + 1) {\r
            let offset = vec2<f32>(f32(x) / size, f32(y) / size);\r
            shadow = shadow + textureSampleCompare(\r
                shadowMap, \r
                shadowSampler,\r
                shadowPos.xy + offset, \r
                shadowPos.z - 0.005  // apply a small bias to avoid acne\r
            );\r
        }\r
    }\r
    shadow = shadow / 9.0;\r
    // // ambient + diffuse * shadow\r
    let lightFactor = min(0.3 + shadow * diffuse, 1.0);\r
    var color_mixin = texColor_img1 * timeOfFrag + (1 - timeOfFrag) * texColor;\r
\r
    let ambintLightColor = vec3(1.0,1.0,1.0);\r
    let pointLightColor = vec3(1.0,1.0,1.0);\r
    let dirLightColor = vec3(1.0,1.0,1.0);\r
    var lightResult = vec3(0.0, 0.0, 0.0);\r
\r
    let ambientIntensity: f32 = chooseFragmentAttr1.y;\r
    var pointLight: array<vec4<f32>, 2>;\r
    pointLight[0] = chooseFragmentAttr2;\r
    pointLight[1] = chooseFragmentAttr3;\r
    let directionLight: vec4<f32> = chooseFragmentAttr4;\r
\r
    // ambient\r
    lightResult += ambintLightColor * ambientIntensity;\r
\r
    // Directional Light\r
    // 将directionLight数组的第一个元素directionLight[0]的前三个\r
    // 分量（x、y和z）提取出来，并赋值给directionPosition变量。这里使用.xyz语法表示提取vec4中的前三个分量。\r
    var directionPosition = directionLight.xyz;\r
    var directionIntensity: f32 = directionLight.w;\r
    lightResult += dirLightColor * directionIntensity * diffuse;\r
\r
    // Point Light\r
    var pointPosition = pointLight[0].xyz;\r
    var pointIntensity: f32 = pointLight[1].x;\r
    var pointRadius: f32 = pointLight[1].y;\r
    var L = pointPosition - fragPosition;\r
    var distance = length(L);\r
    if(distance < pointRadius){\r
        // 计算漫反射分量。这里使用点光源方向向量与法线向量的点积，确保夹角在 0 到 90 度之间。\r
        var diffuse: f32 = max(dot(normalize(L), fragNormal), 0.0);\r
        // 计算距离衰减因子。这里使用了一个简单的二次方衰减，距离越远，影响越小。\r
        var distanceFactor: f32 = pow(1.0 - distance / pointRadius, 2.0);\r
        // 根据漫反射、光照强度和距离衰减，将点光源的颜色叠加到 lightResult 中。\r
        lightResult += pointLightColor * pointIntensity * diffuse * distanceFactor;\r
    }\r
\r
\r
    for(var i = 0u; i < 4; i++){\r
        let vecAttr = chooseFragmentAttr1;\r
        // if(i > f32(4)){\r
        //     vecAttr = chooseFragmentAttr2;\r
        // };\r
        if(3.5 < vecAttr.x){\r
            return texColor;\r
        }else if(2.5 < vecAttr.x){\r
            return texColor_img1 * timeOfFrag + (1 - timeOfFrag) * texColor;\r
        }else if(1.5 < vecAttr.x){\r
            // return texColor_img * lightFactor;\r
            return vec4<f32>(texColor_img.xyz * lightResult, 1.0);\r
        }else{\r
            \r
            return lightFactor * color_mixin;\r
        }\r
    }\r
    return texColor_img; \r
\r
    // 上一帧画面\r
    // return texColor;\r
\r
    // 图片 + 渐变 + 上一帧画面\r
    // return texColor_img1 * timeOfFrag + (1 - timeOfFrag) * texColor;\r
    \r
    // 纯图片\r
    // return texColor_img;\r
\r
    // 图片 + 渐变 + 上一帧画面 + 阴影\r
    // return lightFactor * color_mixin;\r
}`,wh=`// three\r
@binding(2) @group(0) var<uniform> modelMatrix : mat4x4<f32>;\r
@binding(3) @group(0) var<uniform> viewprojectMatrix : mat4x4<f32>;\r
@binding(4) @group(0) var<uniform> time : f32;\r
@binding(5) @group(0) var<uniform> cameraPosition : mat4x4<f32>;\r
@binding(6) @group(0) var<uniform> lightProjection : mat4x4<f32>;\r
@binding(7) @group(0) var<uniform> shaderAttr : mat4x4<f32>;\r
\r
struct VertexOutput {\r
    @builtin(position) Position : vec4<f32>,\r
    @location(0) fragUV : vec2<f32>,\r
    @location(1) fragPosition: vec3<f32>,\r
    @location(2) fragNormal: vec3<f32>,\r
    @location(3) timeOfFrag: f32,\r
    @location(4) shadowPos: vec3<f32>,\r
    @location(5) chooseFragmentAttr1: vec4<f32>,\r
    @location(6) chooseFragmentAttr2: vec4<f32>,\r
    @location(7) chooseFragmentAttr3: vec4<f32>,\r
    @location(8) chooseFragmentAttr4: vec4<f32>\r
};\r
\r
@vertex\r
fn main(\r
    @location(0) position : vec3<f32>,\r
    @location(1) normal : vec3<f32>,\r
    @location(2) uv : vec2<f32>,\r
) -> VertexOutput {\r
    var output : VertexOutput;\r
    var size = 1.0;\r
    var pos = vec4(position.x * size, position.y * size, position.z, 1.0);\r
    output.Position = viewprojectMatrix * modelMatrix * pos;\r
    // 每个片元的世界坐标，用以计算光源\r
    output.fragPosition = (modelMatrix * pos).xyz;\r
    output.fragUV = uv;\r
    // w分量为0 ，为了移除平移的影响  \r
    // 没有考虑非等比缩放  --正规矩阵\r
    // output.fragNormal = (modelMatrix * vec4<f32>(normal, 0.0)).xyz;\r
    // chatGPT: 在变换后对 output.fragNormal 进行归一化，以解决非等比缩放\r
    output.fragNormal = normalize((modelMatrix * vec4<f32>(normal, 0.0)).xyz);\r
    output.timeOfFrag = time;\r
    output.chooseFragmentAttr1 = shaderAttr[0];\r
    output.chooseFragmentAttr2 = shaderAttr[1];\r
    output.chooseFragmentAttr3 = shaderAttr[2];\r
    output.chooseFragmentAttr4 = shaderAttr[3];\r
\r
    let posFromLight: vec4<f32> = lightProjection * modelMatrix * vec4<f32>(position, 1.0);\r
    // Convert shadowPos XY to (0, 1) to fit texture UV\r
    output.shadowPos = vec3<f32>(posFromLight.xy * vec2<f32>(0.5, -0.5)\r
                     + vec2<f32>(0.5, 0.5), posFromLight.z);\r
    return output;\r
}\r
`,Mh=`@group(0) @binding(0) var<uniform> lightPosition : vec4<f32>;\r
@group(0) @binding(5) var mySampler: sampler;\r
@group(1) @binding(2) var textureImg: texture_2d<f32>;\r
@group(1) @binding(3) var shadowMap: texture_depth_2d;\r
@group(1) @binding(4) var shadowSampler: sampler_comparison;\r
@group(1) @binding(5) var imgSampler: sampler;\r
\r
@fragment\r
fn main(\r
    @location(0) fragUV : vec2<f32>,\r
    @location(1) fragInPosition: vec4<f32>,\r
    @location(2) fragNormal: vec3<f32>,\r
    @location(3) timeOfFrag: f32,\r
    @location(4) shadowPos: vec3<f32>,\r
) -> @location(0) vec4<f32> {\r
    // Directional Light\r
    let diffuse: f32 = max(dot(normalize(lightPosition.xyz), fragNormal), 0.0);\r
    // add shadow factor\r
    var shadow : f32 = 0.0;\r
    // // apply Percentage-closer filtering (PCF)\r
    // // sample nearest 9 texels to smooth result\r
    let size = f32(textureDimensions(shadowMap).x);\r
    for (var y : i32 = -1 ; y <= 1 ; y = y + 1) {\r
        for (var x : i32 = -1 ; x <= 1 ; x = x + 1) {\r
            let offset = vec2<f32>(f32(x) / size, f32(y) / size);\r
            shadow = shadow + textureSampleCompare(\r
                shadowMap, \r
                shadowSampler,\r
                shadowPos.xy + offset, \r
                shadowPos.z - 0.005  // apply a small bias to avoid acne\r
            );\r
        }\r
    }\r
    shadow = shadow / 9.0;\r
    // // ambient + diffuse * shadow\r
    let lightFactor = min(0.3 + shadow * diffuse, 1.0);\r
    // return vec4<f32>(lightFactor * vec3<f32>(fragUV,1.0), 1.0);\r
    return vec4<f32>(lightFactor * vec3<f32>(fragUV,1.0), 1.0);\r
    // let textureImgColor = textureSample(textureImg,imgSampler, fragUV);\r
    // return vec4<f32>(lightFactor * textureImgColor.xyz, 1.0);\r
}\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
// // shaderToy试做\r
// @group(0) @binding(0) var<uniform> lightPosition : vec4<f32>;\r
// @group(0) @binding(5) var mySampler: sampler;\r
// @group(1) @binding(2) var textureImg: texture_2d<f32>;\r
// @group(1) @binding(3) var shadowMap: texture_depth_2d;\r
// @group(1) @binding(4) var shadowSampler: sampler_comparison;\r
// @group(1) @binding(5) var imgSampler: sampler;\r
\r
// fn axios(normalUV : vec2<f32>) -> vec3<f32>{\r
//     var outColor = vec3<f32>(0.);\r
//     if(abs(normalUV.y) < fwidth(normalUV.y)){\r
//         outColor = vec3<f32>(1.0, 0.0, 0.0);\r
//     }\r
//     if(abs(normalUV.x) < fwidth(normalUV.x)){\r
//         outColor = vec3<f32>(0.0, 1.0, 0.0);\r
//     }\r
//     var cell = fract(normalUV);\r
//     if(cell.x < fwidth(normalUV.x)){\r
//         outColor = vec3<f32>(1.0);\r
//     }\r
//     if(cell.y < fwidth(normalUV.y)){\r
//         outColor = vec3<f32>(1.0);\r
//     }\r
//     return outColor;\r
// };\r
// // fn Grid(uv: vec2<f32>) -> vec3<f32> {\r
// //     var color:vec3<f32> = vec3(0.);\r
// //     var fraction: vec2<f32> = 1. - 2. * abs(fract(uv) - 0.5);\r
\r
// //     if (abs(uv.x) <= 2. * fwidth(uv.x)) {\r
// //         color.g = 1.;\r
// //     } else if (abs(uv.y) <= 2. * fwidth(uv.y)) {\r
// //         color.r = 1.;\r
// //     } else if (fraction.x < 3. * fwidth(uv.x) || fraction.y < 3. * fwidth(uv.y)) {\r
// //         color = vec3(1.);\r
// //     }\r
// //     return color;\r
// // };\r
// fn segment(p: vec2<f32>, a: vec2<f32>, b: vec2<f32>, w: f32) -> f32{\r
//     var f:f32 = 0.;\r
//     var ba:vec2<f32> = b - a;\r
//     var pa:vec2<f32> = p - a;\r
//     var proj:f32 = clamp(dot(pa, ba) / dot(ba, ba), 0., 1.);\r
//     var d:f32 = length(proj * ba - pa);\r
//     if (d <= w) {\r
//         f = 1.;\r
//     }\r
//     return f;\r
// };\r
\r
// @fragment\r
// fn main(\r
//     @builtin(position) fragInPos : vec4<f32>,\r
//     @builtin(front_facing) frontFacing : bool,\r
//     // @builtin(frag_depth) fragDep : f32,\r
//     @builtin(sample_index) sampleIndex : u32,\r
//     @builtin(sample_mask) sampleMask : u32,\r
\r
//     @location(0) fragUV : vec2<f32>,\r
//     @location(1) fragInPosition: vec4<f32>,\r
//     @location(2) fragNormal: vec3<f32>,\r
//     @location(3) timeOfFrag: f32,\r
//     @location(4) shadowPos: vec3<f32>,\r
// ) -> @location(0) vec4<f32> {\r
//     // var outColor = vec4<f32>(fragUV,1.0,1.0);\r
//     // return vec4<f32>(sin(fragInPos.x),cos(fragInPos.y),1.0,1.0);\r
\r
//     var uv = (fragUV - vec2<f32>(0.5, 0.5)) * 2;\r
//     // var outColor = axios(uv);\r
\r
//     var outColor = vec3<f32>(segment(uv, vec2(2.0,2.0), vec2(-2.0,-2.0), fwidth(fragUV.x)));;\r
//     return vec4<f32>(outColor,1.0);\r
// }`,Sh=`// three\r
@binding(0) @group(0) var<uniform> cameraPosition : mat4x4<f32>;\r
@binding(1) @group(0) var<uniform> lightProjection : mat4x4<f32>;\r
@binding(2) @group(0) var<uniform> modelMatrix : mat4x4<f32>;\r
@binding(3) @group(0) var<uniform> viewprojectMatrix : mat4x4<f32>;\r
@binding(4) @group(0) var<uniform> time : f32;\r
@binding(0) @group(1) var<uniform> flatElevation : f32;\r
@binding(1) @group(1) var<uniform> uBigWavesFrequency : vec2<f32>;\r
\r
struct VertexOutput {\r
    @builtin(position) Position : vec4<f32>,\r
    @location(0) fragUV : vec2<f32>,\r
    @location(1) fragPosition: vec4<f32>,\r
    @location(2) fragNormal: vec3<f32>,\r
    @location(3) timeOfFrag: f32,\r
    @location(4) shadowPos: vec3<f32>,\r
};\r
\r
@vertex\r
fn main(\r
    @location(0) position : vec3<f32>,\r
    @location(1) normal : vec3<f32>,\r
    @location(2) uv : vec2<f32>,\r
) -> VertexOutput {\r
    var output : VertexOutput;\r
    var position_model = modelMatrix * vec4<f32>(position, 1.0);\r
    var elevation = sin(position_model.x * uBigWavesFrequency.x + time)\r
                    * sin(position_model.z * uBigWavesFrequency.y + time)\r
                    * flatElevation;\r
    var pos = vec4(\r
        position_model.x,\r
        position_model.y + elevation,\r
        position_model.z,\r
        1.0);\r
    \r
    let posFromCamera = viewprojectMatrix * pos;\r
    output.Position = posFromCamera;\r
    output.fragPosition = posFromCamera;\r
    output.fragUV = uv;\r
    output.fragNormal = (modelMatrix * vec4<f32>(normal, 0.0)).xyz;\r
    output.timeOfFrag = time;\r
\r
    let posFromLight: vec4<f32> = lightProjection * modelMatrix * vec4<f32>(position, 1.0);\r
// Convert shadowPos XY to (0, 1) to fit texture UV\r
    output.shadowPos = vec3<f32>(posFromLight.xy * vec2<f32>(0.5, -0.5)\r
                     + vec2<f32>(0.5, 0.5), posFromLight.z);\r
    return output;\r
}\r
// // three\r
// @binding(0) @group(0) var<uniform> cameraPosition : mat4x4<f32>;\r
// @binding(1) @group(0) var<uniform> lightProjection : mat4x4<f32>;\r
// @binding(2) @group(0) var<uniform> modelMatrix : mat4x4<f32>;\r
// @binding(3) @group(0) var<uniform> viewprojectMatrix : mat4x4<f32>;\r
// @binding(4) @group(0) var<uniform> time : f32;\r
// @binding(0) @group(1) var<uniform> flatElevation : f32;\r
// @binding(1) @group(1) var<uniform> uBigWavesFrequency : vec2<f32>;\r
\r
// struct VertexOutput {\r
//     @builtin(position) Position : vec4<f32>,\r
//     @location(0) fragUV : vec2<f32>,\r
//     @location(1) fragPosition: vec4<f32>,\r
//     @location(2) fragNormal: vec3<f32>,\r
//     @location(3) timeOfFrag: f32,\r
//     @location(4) shadowPos: vec3<f32>,\r
// };\r
\r
// @vertex\r
// fn main(\r
//     @location(0) position : vec3<f32>,\r
//     @location(1) normal : vec3<f32>,\r
//     @location(2) uv : vec2<f32>,\r
// ) -> VertexOutput {\r
//     var output : VertexOutput;\r
//     var position_model = modelMatrix * vec4<f32>(position, 1.0);\r
//     var elevation = sin(position.x * uBigWavesFrequency.x + time)\r
//                     * sin(position.z * uBigWavesFrequency.y + time)\r
//                     * flatElevation;\r
//     var pos = vec4(\r
//         position.x,\r
//         position.y + elevation,\r
//         position.z,\r
//         1.0);\r
//     let pos = vec4<f32>(position, 1.0);\r
\r
//     let posFromCamera = viewprojectMatrix * position_model;\r
//     output.Position = posFromCamera;\r
//     output.fragPosition = modelMatrix * pos;\r
//     output.fragUV = uv;\r
//     output.fragNormal = (modelMatrix * vec4<f32>(normal, 0.0)).xyz;\r
//     output.timeOfFrag = time;\r
\r
//     let posFromLight: vec4<f32> = lightProjection * modelMatrix * vec4<f32>(position, 1.0);\r
// // Convert shadowPos XY to (0, 1) to fit texture UV\r
//     output.shadowPos = vec3<f32>(posFromLight.xy * vec2<f32>(0.5, -0.5)\r
//                      + vec2<f32>(0.5, 0.5), posFromLight.z);\r
//     return output;\r
// }\r
`,ai={topologyIsline_list:!0},ci={topologyIsline_list:!0},Ah=4*16;async function Ph(n){const t=n.createBuffer({size:4,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),e=n.createBuffer({size:4,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),r=n.createBuffer({size:4*2,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),i=n.createBuffer({size:4*16,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),o=n.createBuffer({size:Ah,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM});let s;{const u=await fetch(new URL("http://139.159.253.241/WebGPU/img/img1_1k.jpg").toString()),h=await createImageBitmap(await u.blob());s=n.createTexture({size:[h.width,h.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),n.queue.copyExternalImageToTexture({source:h},{texture:s},[h.width,h.height])}let a;{const u=await fetch(new URL("http://139.159.253.241/WebGPU/img/img1_1k.jpg").toString()),h=await createImageBitmap(await u.blob());a=n.createTexture({size:[h.width,h.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),n.queue.copyExternalImageToTexture({source:h},{texture:a},[h.width,h.height])}let c;{const u=await fetch(new URL("http://139.159.253.241/WebGPU/particlesImg/6.png").toString()),h=await createImageBitmap(await u.blob());c=n.createTexture({size:[h.width,h.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),n.queue.copyExternalImageToTexture({source:h},{texture:c},[h.width,h.height])}return{timeFrameDeferenceBuffer:t,flatElevationBuffer:e,flatBigWavesFrequencyBuffer:r,threejsMeshAttrForShaderBuffer:i,cameraVPMatrixBuffer:o,cubeTextureImg:s,cubeTextureImg_8k:a,particlesTextureImg:c}}async function zh(n,t){const e=n.createBuffer({label:"GPUBuffer store 4x4 matrix",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),r=n.createBuffer({label:"GPUBuffer for light projection",size:4*4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),i=te.fromValues(0,100,-7),o=te.fromValues(0,0,1),s=te.fromValues(0,0,-7),a=at.lookAt(i,s,o),c=at.perspective(Math.PI/6,t.width/t.height,.01,1e3),u=at.ortho(-40,40,-40,40,-50,200),h=at.multiply(c,a),l=at.multiply(u,a);return n.queue.writeBuffer(e,0,i),n.queue.writeBuffer(r,0,l),{lightPositionBuffer:e,lightViewProjectionBuffer:r,lightViewProjectionMatrix:h,lightViewOrthoMatrix:l}}function Ch(n){if(n&&!(typeof window>"u")){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=n,document.head.appendChild(t),n}}function Te(n,t){var e=n.__state.conversionName.toString(),r=Math.round(n.r),i=Math.round(n.g),o=Math.round(n.b),s=n.a,a=Math.round(n.h),c=n.s.toFixed(1),u=n.v.toFixed(1);if(t||e==="THREE_CHAR_HEX"||e==="SIX_CHAR_HEX"){for(var h=n.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}else{if(e==="CSS_RGB")return"rgb("+r+","+i+","+o+")";if(e==="CSS_RGBA")return"rgba("+r+","+i+","+o+","+s+")";if(e==="HEX")return"0x"+n.hex.toString(16);if(e==="RGB_ARRAY")return"["+r+","+i+","+o+"]";if(e==="RGBA_ARRAY")return"["+r+","+i+","+o+","+s+"]";if(e==="RGB_OBJ")return"{r:"+r+",g:"+i+",b:"+o+"}";if(e==="RGBA_OBJ")return"{r:"+r+",g:"+i+",b:"+o+",a:"+s+"}";if(e==="HSV_OBJ")return"{h:"+a+",s:"+c+",v:"+u+"}";if(e==="HSVA_OBJ")return"{h:"+a+",s:"+c+",v:"+u+",a:"+s+"}"}return"unknown format"}var ui=Array.prototype.forEach,De=Array.prototype.slice,P={BREAK:{},extend:function(t){return this.each(De.call(arguments,1),function(e){var r=this.isObject(e)?Object.keys(e):[];r.forEach((function(i){this.isUndefined(e[i])||(t[i]=e[i])}).bind(this))},this),t},defaults:function(t){return this.each(De.call(arguments,1),function(e){var r=this.isObject(e)?Object.keys(e):[];r.forEach((function(i){this.isUndefined(t[i])&&(t[i]=e[i])}).bind(this))},this),t},compose:function(){var t=De.call(arguments);return function(){for(var e=De.call(arguments),r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},each:function(t,e,r){if(t){if(ui&&t.forEach&&t.forEach===ui)t.forEach(e,r);else if(t.length===t.length+0){var i=void 0,o=void 0;for(i=0,o=t.length;i<o;i++)if(i in t&&e.call(r,t[i],i)===this.BREAK)return}else for(var s in t)if(e.call(r,t[s],s)===this.BREAK)return}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,r){var i=void 0;return function(){var o=this,s=arguments;function a(){i=null,r||t.apply(o,s)}var c=r||!i;clearTimeout(i),i=setTimeout(a,e),c&&t.apply(o,s)}},toArray:function(t){return t.toArray?t.toArray():De.call(t)},isUndefined:function(t){return t===void 0},isNull:function(t){return t===null},isNaN:function(n){function t(e){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return t===!1||t===!0},isFunction:function(t){return t instanceof Function}},Th=[{litmus:P.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Te},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Te},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Te},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Te}}},{litmus:P.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:P.isArray,conversions:{RGB_ARRAY:{read:function(t){return t.length!==3?!1:{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return t.length!==4?!1:{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:P.isObject,conversions:{RGBA_OBJ:{read:function(t){return P.isNumber(t.r)&&P.isNumber(t.g)&&P.isNumber(t.b)&&P.isNumber(t.a)?{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return P.isNumber(t.r)&&P.isNumber(t.g)&&P.isNumber(t.b)?{space:"RGB",r:t.r,g:t.g,b:t.b}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return P.isNumber(t.h)&&P.isNumber(t.s)&&P.isNumber(t.v)&&P.isNumber(t.a)?{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return P.isNumber(t.h)&&P.isNumber(t.s)&&P.isNumber(t.v)?{space:"HSV",h:t.h,s:t.s,v:t.v}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],$e=void 0,bn=void 0,er=function(){bn=!1;var t=arguments.length>1?P.toArray(arguments):arguments[0];return P.each(Th,function(e){if(e.litmus(t))return P.each(e.conversions,function(r,i){if($e=r.read(t),bn===!1&&$e!==!1)return bn=$e,$e.conversionName=i,$e.conversion=r,P.BREAK}),P.BREAK}),bn},hi=void 0,Pn={hsv_to_rgb:function(t,e,r){var i=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),s=r*(1-e),a=r*(1-o*e),c=r*(1-(1-o)*e),u=[[r,c,s],[a,r,s],[s,r,c],[s,a,r],[c,s,r],[r,s,a]][i];return{r:u[0]*255,g:u[1]*255,b:u[2]*255}},rgb_to_hsv:function(t,e,r){var i=Math.min(t,e,r),o=Math.max(t,e,r),s=o-i,a=void 0,c=void 0;if(o!==0)c=s/o;else return{h:NaN,s:0,v:0};return t===o?a=(e-r)/s:e===o?a=2+(r-t)/s:a=4+(t-e)/s,a/=6,a<0&&(a+=1),{h:a*360,s:c,v:o/255}},rgb_to_hex:function(t,e,r){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),i=this.hex_with_component(i,0,r),i},component_from_hex:function(t,e){return t>>e*8&255},hex_with_component:function(t,e,r){return r<<(hi=e*8)|t&~(255<<hi)}},Eh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Bt=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},Ot=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),re=function n(t,e,r){t===null&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(i===void 0){var o=Object.getPrototypeOf(t);return o===null?void 0:n(o,e,r)}else{if("value"in i)return i.value;var s=i.get;return s===void 0?void 0:s.call(r)}},ie=function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)},oe=function(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:n},dt=function(){function n(){if(Bt(this,n),this.__state=er.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Ot(n,[{key:"toString",value:function(){return Te(this)}},{key:"toHexString",value:function(){return Te(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function Pr(n,t,e){Object.defineProperty(n,t,{get:function(){return this.__state.space==="RGB"?this.__state[t]:(dt.recalculateRGB(this,t,e),this.__state[t])},set:function(i){this.__state.space!=="RGB"&&(dt.recalculateRGB(this,t,e),this.__state.space="RGB"),this.__state[t]=i}})}function zr(n,t){Object.defineProperty(n,t,{get:function(){return this.__state.space==="HSV"?this.__state[t]:(dt.recalculateHSV(this),this.__state[t])},set:function(r){this.__state.space!=="HSV"&&(dt.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=r}})}dt.recalculateRGB=function(n,t,e){if(n.__state.space==="HEX")n.__state[t]=Pn.component_from_hex(n.__state.hex,e);else if(n.__state.space==="HSV")P.extend(n.__state,Pn.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v));else throw new Error("Corrupted color state")};dt.recalculateHSV=function(n){var t=Pn.rgb_to_hsv(n.r,n.g,n.b);P.extend(n.__state,{s:t.s,v:t.v}),P.isNaN(t.h)?P.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=t.h};dt.COMPONENTS=["r","g","b","h","s","v","hex","a"];Pr(dt.prototype,"r",2);Pr(dt.prototype,"g",1);Pr(dt.prototype,"b",0);zr(dt.prototype,"h");zr(dt.prototype,"s");zr(dt.prototype,"v");Object.defineProperty(dt.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}});Object.defineProperty(dt.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=Pn.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var pe=function(){function n(t,e){Bt(this,n),this.initialValue=t[e],this.domElement=document.createElement("div"),this.object=t,this.property=e,this.__onChange=void 0,this.__onFinishChange=void 0}return Ot(n,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),Bh={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},go={};P.each(Bh,function(n,t){P.each(n,function(e){go[e]=t})});var Oh=/(\d+(\.\d+)?)px/;function Ft(n){if(n==="0"||P.isUndefined(n))return 0;var t=n.match(Oh);return P.isNull(t)?0:parseFloat(t[1])}var b={makeSelectable:function(t,e){t===void 0||t.style===void 0||(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,r){var i=r,o=e;P.isUndefined(o)&&(o=!0),P.isUndefined(i)&&(i=!0),t.style.position="absolute",o&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,r,i){var o=r||{},s=go[e];if(!s)throw new Error("Event type "+e+" not supported.");var a=document.createEvent(s);switch(s){case"MouseEvents":{var c=o.x||o.clientX||0,u=o.y||o.clientY||0;a.initMouseEvent(e,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,c,u,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var h=a.initKeyboardEvent||a.initKeyEvent;P.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(e,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break}default:{a.initEvent(e,o.bubbles||!1,o.cancelable||!0);break}}P.defaults(a,i),t.dispatchEvent(a)},bind:function(t,e,r,i){var o=i||!1;return t.addEventListener?t.addEventListener(e,r,o):t.attachEvent&&t.attachEvent("on"+e,r),b},unbind:function(t,e,r,i){var o=i||!1;return t.removeEventListener?t.removeEventListener(e,r,o):t.detachEvent&&t.detachEvent("on"+e,r),b},addClass:function(t,e){if(t.className===void 0)t.className=e;else if(t.className!==e){var r=t.className.split(/ +/);r.indexOf(e)===-1&&(r.push(e),t.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return b},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var r=t.className.split(/ +/),i=r.indexOf(e);i!==-1&&(r.splice(i,1),t.className=r.join(" "))}else t.className=void 0;return b},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return Ft(e["border-left-width"])+Ft(e["border-right-width"])+Ft(e["padding-left"])+Ft(e["padding-right"])+Ft(e.width)},getHeight:function(t){var e=getComputedStyle(t);return Ft(e["border-top-width"])+Ft(e["border-bottom-width"])+Ft(e["padding-top"])+Ft(e["padding-bottom"])+Ft(e.height)},getOffset:function(t){var e=t,r={left:0,top:0};if(e.offsetParent)do r.left+=e.offsetLeft,r.top+=e.offsetTop,e=e.offsetParent;while(e);return r},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},xo=function(n){ie(t,n);function t(e,r){Bt(this,t);var i=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),o=i;i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox");function s(){o.setValue(!o.__prev)}return b.bind(i.__checkbox,"change",s,!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return Ot(t,[{key:"setValue",value:function(r){var i=re(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),re(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(pe),Uh=function(n){ie(t,n);function t(e,r,i){Bt(this,t);var o=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),s=i,a=o;if(o.__select=document.createElement("select"),P.isArray(s)){var c={};P.each(s,function(u){c[u]=u}),s=c}return P.each(s,function(u,h){var l=document.createElement("option");l.innerHTML=h,l.setAttribute("value",u),a.__select.appendChild(l)}),o.updateDisplay(),b.bind(o.__select,"change",function(){var u=this.options[this.selectedIndex].value;a.setValue(u)}),o.domElement.appendChild(o.__select),o}return Ot(t,[{key:"setValue",value:function(r){var i=re(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return b.isActive(this.__select)?this:(this.__select.value=this.getValue(),re(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(pe),Fh=function(n){ie(t,n);function t(e,r){Bt(this,t);var i=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),o=i;function s(){o.setValue(o.__input.value)}function a(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),b.bind(i.__input,"keyup",s),b.bind(i.__input,"change",s),b.bind(i.__input,"blur",a),b.bind(i.__input,"keydown",function(c){c.keyCode===13&&this.blur()}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return Ot(t,[{key:"updateDisplay",value:function(){return b.isActive(this.__input)||(this.__input.value=this.getValue()),re(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(pe);function li(n){var t=n.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var _o=function(n){ie(t,n);function t(e,r,i){Bt(this,t);var o=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),s=i||{};return o.__min=s.min,o.__max=s.max,o.__step=s.step,P.isUndefined(o.__step)?o.initialValue===0?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=li(o.__impliedStep),o}return Ot(t,[{key:"setValue",value:function(r){var i=r;return this.__min!==void 0&&i<this.__min?i=this.__min:this.__max!==void 0&&i>this.__max&&(i=this.__max),this.__step!==void 0&&i%this.__step!==0&&(i=Math.round(i/this.__step)*this.__step),re(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(r){return this.__min=r,this}},{key:"max",value:function(r){return this.__max=r,this}},{key:"step",value:function(r){return this.__step=r,this.__impliedStep=r,this.__precision=li(r),this}}]),t}(pe);function Gh(n,t){var e=Math.pow(10,t);return Math.round(n*e)/e}var zn=function(n){ie(t,n);function t(e,r,i){Bt(this,t);var o=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i));o.__truncationSuspended=!1;var s=o,a=void 0;function c(){var m=parseFloat(s.__input.value);P.isNaN(m)||s.setValue(m)}function u(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function h(){u()}function l(m){var d=a-m.clientY;s.setValue(s.getValue()+d*s.__impliedStep),a=m.clientY}function f(){b.unbind(window,"mousemove",l),b.unbind(window,"mouseup",f),u()}function p(m){b.bind(window,"mousemove",l),b.bind(window,"mouseup",f),a=m.clientY}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),b.bind(o.__input,"change",c),b.bind(o.__input,"blur",h),b.bind(o.__input,"mousedown",p),b.bind(o.__input,"keydown",function(m){m.keyCode===13&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1,u())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return Ot(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():Gh(this.getValue(),this.__precision),re(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(_o);function fi(n,t,e,r,i){return r+(i-r)*((n-t)/(e-t))}var nr=function(n){ie(t,n);function t(e,r,i,o,s){Bt(this,t);var a=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,{min:i,max:o,step:s})),c=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),b.bind(a.__background,"mousedown",u),b.bind(a.__background,"touchstart",f),b.addClass(a.__background,"slider"),b.addClass(a.__foreground,"slider-fg");function u(d){document.activeElement.blur(),b.bind(window,"mousemove",h),b.bind(window,"mouseup",l),h(d)}function h(d){d.preventDefault();var y=c.__background.getBoundingClientRect();return c.setValue(fi(d.clientX,y.left,y.right,c.__min,c.__max)),!1}function l(){b.unbind(window,"mousemove",h),b.unbind(window,"mouseup",l),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function f(d){d.touches.length===1&&(b.bind(window,"touchmove",p),b.bind(window,"touchend",m),p(d))}function p(d){var y=d.touches[0].clientX,g=c.__background.getBoundingClientRect();c.setValue(fi(y,g.left,g.right,c.__min,c.__max))}function m(){b.unbind(window,"touchmove",p),b.unbind(window,"touchend",m),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return Ot(t,[{key:"updateDisplay",value:function(){var r=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=r*100+"%",re(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(_o),vo=function(n){ie(t,n);function t(e,r,i){Bt(this,t);var o=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),s=o;return o.__button=document.createElement("div"),o.__button.innerHTML=i===void 0?"Fire":i,b.bind(o.__button,"click",function(a){return a.preventDefault(),s.fire(),!1}),b.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return Ot(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(pe),rr=function(n){ie(t,n);function t(e,r){Bt(this,t);var i=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));i.__color=new dt(i.getValue()),i.__temp=new dt(0);var o=i;i.domElement=document.createElement("div"),b.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",b.bind(i.__input,"keydown",function(d){d.keyCode===13&&l.call(this)}),b.bind(i.__input,"blur",l),b.bind(i.__selector,"mousedown",function(){b.addClass(this,"drag").bind(window,"mouseup",function(){b.removeClass(o.__selector,"drag")})}),b.bind(i.__selector,"touchstart",function(){b.addClass(this,"drag").bind(window,"touchend",function(){b.removeClass(o.__selector,"drag")})});var s=document.createElement("div");P.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),P.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),P.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),P.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),P.extend(s.style,{width:"100%",height:"100%",background:"none"}),pi(s,"top","rgba(0,0,0,0)","#000"),P.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),Lh(i.__hue_field),P.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),b.bind(i.__saturation_field,"mousedown",a),b.bind(i.__saturation_field,"touchstart",a),b.bind(i.__field_knob,"mousedown",a),b.bind(i.__field_knob,"touchstart",a),b.bind(i.__hue_field,"mousedown",c),b.bind(i.__hue_field,"touchstart",c);function a(d){p(d),b.bind(window,"mousemove",p),b.bind(window,"touchmove",p),b.bind(window,"mouseup",u),b.bind(window,"touchend",u)}function c(d){m(d),b.bind(window,"mousemove",m),b.bind(window,"touchmove",m),b.bind(window,"mouseup",h),b.bind(window,"touchend",h)}function u(){b.unbind(window,"mousemove",p),b.unbind(window,"touchmove",p),b.unbind(window,"mouseup",u),b.unbind(window,"touchend",u),f()}function h(){b.unbind(window,"mousemove",m),b.unbind(window,"touchmove",m),b.unbind(window,"mouseup",h),b.unbind(window,"touchend",h),f()}function l(){var d=er(this.value);d!==!1?(o.__color.__state=d,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function f(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}i.__saturation_field.appendChild(s),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay();function p(d){d.type.indexOf("touch")===-1&&d.preventDefault();var y=o.__saturation_field.getBoundingClientRect(),g=d.touches&&d.touches[0]||d,x=g.clientX,_=g.clientY,v=(x-y.left)/(y.right-y.left),w=1-(_-y.top)/(y.bottom-y.top);return w>1?w=1:w<0&&(w=0),v>1?v=1:v<0&&(v=0),o.__color.v=w,o.__color.s=v,o.setValue(o.__color.toOriginal()),!1}function m(d){d.type.indexOf("touch")===-1&&d.preventDefault();var y=o.__hue_field.getBoundingClientRect(),g=d.touches&&d.touches[0]||d,x=g.clientY,_=1-(x-y.top)/(y.bottom-y.top);return _>1?_=1:_<0&&(_=0),o.__color.h=_*360,o.setValue(o.__color.toOriginal()),!1}return i}return Ot(t,[{key:"updateDisplay",value:function(){var r=er(this.getValue());if(r!==!1){var i=!1;P.each(dt.COMPONENTS,function(a){if(!P.isUndefined(r[a])&&!P.isUndefined(this.__color.__state[a])&&r[a]!==this.__color.__state[a])return i=!0,{}},this),i&&P.extend(this.__color.__state,r)}P.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,s=255-o;P.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,pi(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),P.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+s+","+s+","+s+",.7)"})}}]),t}(pe),Rh=["-moz-","-o-","-webkit-","-ms-",""];function pi(n,t,e,r){n.style.background="",P.each(Rh,function(i){n.style.cssText+="background: "+i+"linear-gradient("+t+", "+e+" 0%, "+r+" 100%); "})}function Lh(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var kh={load:function(t,e){var r=e||document,i=r.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=t,r.getElementsByTagName("head")[0].appendChild(i)},inject:function(t,e){var r=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var o=r.getElementsByTagName("head")[0];try{o.appendChild(i)}catch{}}},Vh=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,Nh=function(t,e){var r=t[e];return P.isArray(arguments[2])||P.isObject(arguments[2])?new Uh(t,e,arguments[2]):P.isNumber(r)?P.isNumber(arguments[2])&&P.isNumber(arguments[3])?P.isNumber(arguments[4])?new nr(t,e,arguments[2],arguments[3],arguments[4]):new nr(t,e,arguments[2],arguments[3]):P.isNumber(arguments[4])?new zn(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new zn(t,e,{min:arguments[2],max:arguments[3]}):P.isString(r)?new Fh(t,e):P.isFunction(r)?new vo(t,e,""):P.isBoolean(r)?new xo(t,e):null};function Ih(n){setTimeout(n,1e3/60)}var Dh=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||Ih,$h=function(){function n(){Bt(this,n),this.backgroundElement=document.createElement("div"),P.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),b.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),P.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;b.bind(this.backgroundElement,"click",function(){t.hide()})}return Ot(n,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),P.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,r=function i(){e.domElement.style.display="none",e.backgroundElement.style.display="none",b.unbind(e.domElement,"webkitTransitionEnd",i),b.unbind(e.domElement,"transitionend",i),b.unbind(e.domElement,"oTransitionEnd",i)};b.bind(this.domElement,"webkitTransitionEnd",r),b.bind(this.domElement,"transitionend",r),b.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-b.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-b.getHeight(this.domElement)/2+"px"}}]),n}(),qh=Ch(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);kh.inject(qh);var mi="dg",yi=72,di=20,en="Default",qe=function(){try{return!!window.localStorage}catch{return!1}}(),je=void 0,gi=!0,Ae=void 0,Yn=!1,bo=[],Z=function n(t){var e=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),b.addClass(this.domElement,mi),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=P.defaults(r,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),r=P.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),P.isUndefined(r.load)?r.load={preset:en}:r.preset&&(r.load.preset=r.preset),P.isUndefined(r.parent)&&r.hideable&&bo.push(this),r.resizable=P.isUndefined(r.parent)&&r.resizable,r.autoPlace&&P.isUndefined(r.scrollable)&&(r.scrollable=!0);var i=qe&&localStorage.getItem(Pe(this,"isLocal"))==="true",o=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return e.parent?e.getRoot().preset:r.load.preset},set:function(f){e.parent?e.getRoot().preset=f:r.load.preset=f,Yh(this),e.revert()}},width:{get:function(){return r.width},set:function(f){r.width=f,sr(e,f)}},name:{get:function(){return r.name},set:function(f){r.name=f,s&&(s.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(f){r.closed=f,r.closed?b.addClass(e.__ul,n.CLASS_CLOSED):b.removeClass(e.__ul,n.CLASS_CLOSED),this.onResize(),e.__closeButton&&(e.__closeButton.innerHTML=f?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return i},set:function(f){qe&&(i=f,f?b.bind(window,"unload",o):b.unbind(window,"unload",o),localStorage.setItem(Pe(e,"isLocal"),f))}}}),P.isUndefined(r.parent)){if(this.closed=r.closed||!1,b.addClass(this.domElement,n.CLASS_MAIN),b.makeSelectable(this.domElement,!1),qe&&i){e.useLocalStorage=!0;var a=localStorage.getItem(Pe(this,"gui"));a&&(r.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,b.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),r.closeOnTop?(b.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(b.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),b.bind(this.__closeButton,"click",function(){e.closed=!e.closed})}else{r.closed===void 0&&(r.closed=!0);var c=document.createTextNode(r.name);b.addClass(c,"controller-name"),s=Cr(e,c);var u=function(f){return f.preventDefault(),e.closed=!e.closed,!1};b.addClass(this.__ul,n.CLASS_CLOSED),b.addClass(s,"title"),b.bind(s,"click",u),r.closed||(this.closed=!1)}r.autoPlace&&(P.isUndefined(r.parent)&&(gi&&(Ae=document.createElement("div"),b.addClass(Ae,mi),b.addClass(Ae,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Ae),gi=!1),Ae.appendChild(this.domElement),b.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||sr(e,r.width)),this.__resizeHandler=function(){e.onResizeDebounced()},b.bind(window,"resize",this.__resizeHandler),b.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),b.bind(this.__ul,"transitionend",this.__resizeHandler),b.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&Wh(this),o=function(){qe&&localStorage.getItem(Pe(e,"isLocal"))==="true"&&localStorage.setItem(Pe(e,"gui"),JSON.stringify(e.getSaveObject()))},this.saveToLocalStorageIfPossible=o;function h(){var l=e.getRoot();l.width+=1,P.defer(function(){l.width-=1})}r.parent||h()};Z.toggleHide=function(){Yn=!Yn,P.each(bo,function(n){n.domElement.style.display=Yn?"none":""})};Z.CLASS_AUTO_PLACE="a";Z.CLASS_AUTO_PLACE_CONTAINER="ac";Z.CLASS_MAIN="main";Z.CLASS_CONTROLLER_ROW="cr";Z.CLASS_TOO_TALL="taller-than-window";Z.CLASS_CLOSED="closed";Z.CLASS_CLOSE_BUTTON="close-button";Z.CLASS_CLOSE_TOP="close-top";Z.CLASS_CLOSE_BOTTOM="close-bottom";Z.CLASS_DRAG="drag";Z.DEFAULT_WIDTH=245;Z.TEXT_CLOSED="Close Controls";Z.TEXT_OPEN="Open Controls";Z._keydownHandler=function(n){document.activeElement.type!=="text"&&(n.which===yi||n.keyCode===yi)&&Z.toggleHide()};b.bind(window,"keydown",Z._keydownHandler,!1);P.extend(Z.prototype,{add:function(t,e){return Je(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return Je(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;P.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Ae.removeChild(this.domElement);var t=this;P.each(this.__folders,function(e){t.removeFolder(e)}),b.unbind(window,"keydown",Z._keydownHandler,!1),xi(this)},addFolder:function(t){if(this.__folders[t]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var r=new Z(e);this.__folders[t]=r;var i=Cr(this,r.domElement);return b.addClass(i,"folder"),r},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],xi(t);var e=this;P.each(t.__folders,function(r){t.removeFolder(r)}),P.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=b.getOffset(t.__ul).top,r=0;P.each(t.__ul.childNodes,function(i){t.autoPlace&&i===t.__save_row||(r+=b.getHeight(i))}),window.innerHeight-e-di<r?(b.addClass(t.domElement,Z.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-di+"px"):(b.removeClass(t.domElement,Z.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&P.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:P.debounce(function(){this.onResize()},50),remember:function(){if(P.isUndefined(je)&&(je=new $h,je.domElement.innerHTML=Vh),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;P.each(Array.prototype.slice.call(arguments),function(e){t.__rememberedObjects.length===0&&Hh(t),t.__rememberedObjects.indexOf(e)===-1&&t.__rememberedObjects.push(e)}),this.autoPlace&&sr(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=wn(this)),t.folders={},P.each(this.__folders,function(e,r){t.folders[r]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=wn(this),ir(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[en]=wn(this,!0)),this.load.remembered[t]=wn(this),this.preset=t,or(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){P.each(this.__controllers,function(e){this.getRoot().load.remembered?wo(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),P.each(this.__folders,function(e){e.revert(e)}),t||ir(this.getRoot(),!1)},listen:function(t){var e=this.__listening.length===0;this.__listening.push(t),e&&Mo(this.__listening)},updateDisplay:function(){P.each(this.__controllers,function(t){t.updateDisplay()}),P.each(this.__folders,function(t){t.updateDisplay()})}});function Cr(n,t,e){var r=document.createElement("li");return t&&r.appendChild(t),e?n.__ul.insertBefore(r,e):n.__ul.appendChild(r),n.onResize(),r}function xi(n){b.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&b.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function ir(n,t){var e=n.__preset_select[n.__preset_select.selectedIndex];t?e.innerHTML=e.value+"*":e.innerHTML=e.value}function Xh(n,t,e){if(e.__li=t,e.__gui=n,P.extend(e,{options:function(s){if(arguments.length>1){var a=e.__li.nextElementSibling;return e.remove(),Je(n,e.object,e.property,{before:a,factoryArgs:[P.toArray(arguments)]})}if(P.isArray(s)||P.isObject(s)){var c=e.__li.nextElementSibling;return e.remove(),Je(n,e.object,e.property,{before:c,factoryArgs:[s]})}},name:function(s){return e.__li.firstElementChild.firstElementChild.innerHTML=s,e},listen:function(){return e.__gui.listen(e),e},remove:function(){return e.__gui.remove(e),e}}),e instanceof nr){var r=new zn(e.object,e.property,{min:e.__min,max:e.__max,step:e.__step});P.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(o){var s=e[o],a=r[o];e[o]=r[o]=function(){var c=Array.prototype.slice.call(arguments);return a.apply(r,c),s.apply(e,c)}}),b.addClass(t,"has-slider"),e.domElement.insertBefore(r.domElement,e.domElement.firstElementChild)}else if(e instanceof zn){var i=function(s){if(P.isNumber(e.__min)&&P.isNumber(e.__max)){var a=e.__li.firstElementChild.firstElementChild.innerHTML,c=e.__gui.__listening.indexOf(e)>-1;e.remove();var u=Je(n,e.object,e.property,{before:e.__li.nextElementSibling,factoryArgs:[e.__min,e.__max,e.__step]});return u.name(a),c&&u.listen(),u}return s};e.min=P.compose(i,e.min),e.max=P.compose(i,e.max)}else e instanceof xo?(b.bind(t,"click",function(){b.fakeEvent(e.__checkbox,"click")}),b.bind(e.__checkbox,"click",function(o){o.stopPropagation()})):e instanceof vo?(b.bind(t,"click",function(){b.fakeEvent(e.__button,"click")}),b.bind(t,"mouseover",function(){b.addClass(e.__button,"hover")}),b.bind(t,"mouseout",function(){b.removeClass(e.__button,"hover")})):e instanceof rr&&(b.addClass(t,"color"),e.updateDisplay=P.compose(function(o){return t.style.borderLeftColor=e.__color.toString(),o},e.updateDisplay),e.updateDisplay());e.setValue=P.compose(function(o){return n.getRoot().__preset_select&&e.isModified()&&ir(n.getRoot(),!0),o},e.setValue)}function wo(n,t){var e=n.getRoot(),r=e.__rememberedObjects.indexOf(t.object);if(r!==-1){var i=e.__rememberedObjectIndecesToControllers[r];if(i===void 0&&(i={},e.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,e.load&&e.load.remembered){var o=e.load.remembered,s=void 0;if(o[n.preset])s=o[n.preset];else if(o[en])s=o[en];else return;if(s[r]&&s[r][t.property]!==void 0){var a=s[r][t.property];t.initialValue=a,t.setValue(a)}}}}function Je(n,t,e,r){if(t[e]===void 0)throw new Error('Object "'+t+'" has no property "'+e+'"');var i=void 0;if(r.color)i=new rr(t,e);else{var o=[t,e].concat(r.factoryArgs);i=Nh.apply(n,o)}r.before instanceof pe&&(r.before=r.before.__li),wo(n,i),b.addClass(i.domElement,"c");var s=document.createElement("span");b.addClass(s,"property-name"),s.innerHTML=i.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(i.domElement);var c=Cr(n,a,r.before);return b.addClass(c,Z.CLASS_CONTROLLER_ROW),i instanceof rr?b.addClass(c,"color"):b.addClass(c,Eh(i.getValue())),Xh(n,c,i),n.__controllers.push(i),i}function Pe(n,t){return document.location.href+"."+t}function or(n,t,e){var r=document.createElement("option");r.innerHTML=t,r.value=t,n.__preset_select.appendChild(r),e&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function _i(n,t){t.style.display=n.useLocalStorage?"block":"none"}function Hh(n){var t=n.__save_row=document.createElement("li");b.addClass(n.domElement,"has-save"),n.__ul.insertBefore(t,n.__ul.firstChild),b.addClass(t,"save-row");var e=document.createElement("span");e.innerHTML="&nbsp;",b.addClass(e,"button gears");var r=document.createElement("span");r.innerHTML="Save",b.addClass(r,"button"),b.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",b.addClass(i,"button"),b.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",b.addClass(o,"button"),b.addClass(o,"revert");var s=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?P.each(n.load.remembered,function(l,f){or(n,f,f===n.preset)}):or(n,en,!1),b.bind(s,"change",function(){for(var l=0;l<n.__preset_select.length;l++)n.__preset_select[l].innerHTML=n.__preset_select[l].value;n.preset=this.value}),t.appendChild(s),t.appendChild(e),t.appendChild(r),t.appendChild(i),t.appendChild(o),qe){var a=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage"),u=document.getElementById("dg-save-locally");u.style.display="block",localStorage.getItem(Pe(n,"isLocal"))==="true"&&c.setAttribute("checked","checked"),_i(n,a),b.bind(c,"change",function(){n.useLocalStorage=!n.useLocalStorage,_i(n,a)})}var h=document.getElementById("dg-new-constructor");b.bind(h,"keydown",function(l){l.metaKey&&(l.which===67||l.keyCode===67)&&je.hide()}),b.bind(e,"click",function(){h.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),je.show(),h.focus(),h.select()}),b.bind(r,"click",function(){n.save()}),b.bind(i,"click",function(){var l=prompt("Enter a new preset name.");l&&n.saveAs(l)}),b.bind(o,"click",function(){n.revert()})}function Wh(n){var t=void 0;n.__resize_handle=document.createElement("div"),P.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function e(o){return o.preventDefault(),n.width+=t-o.clientX,n.onResize(),t=o.clientX,!1}function r(){b.removeClass(n.__closeButton,Z.CLASS_DRAG),b.unbind(window,"mousemove",e),b.unbind(window,"mouseup",r)}function i(o){return o.preventDefault(),t=o.clientX,b.addClass(n.__closeButton,Z.CLASS_DRAG),b.bind(window,"mousemove",e),b.bind(window,"mouseup",r),!1}b.bind(n.__resize_handle,"mousedown",i),b.bind(n.__closeButton,"mousedown",i),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}function sr(n,t){n.domElement.style.width=t+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=t+"px"),n.__closeButton&&(n.__closeButton.style.width=t+"px")}function wn(n,t){var e={};return P.each(n.__rememberedObjects,function(r,i){var o={},s=n.__rememberedObjectIndecesToControllers[i];P.each(s,function(a,c){o[c]=t?a.initialValue:a.getValue()}),e[i]=o}),e}function Yh(n){for(var t=0;t<n.__preset_select.length;t++)n.__preset_select[t].value===n.preset&&(n.__preset_select.selectedIndex=t)}function Mo(n){n.length!==0&&Dh.call(window,function(){Mo(n)}),P.each(n,function(t){t.updateDisplay()})}var jh=Z,Ze=function(){var n=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(h){h.preventDefault(),r(++n%t.children.length)},!1);function e(h){return t.appendChild(h.dom),h}function r(h){for(var l=0;l<t.children.length;l++)t.children[l].style.display=l===h?"block":"none";n=h}var i=(performance||Date).now(),o=i,s=0,a=e(new Ze.Panel("FPS","#0ff","#002")),c=e(new Ze.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new Ze.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:e,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){s++;var h=(performance||Date).now();if(c.update(h-i,200),h>=o+1e3&&(a.update(s*1e3/(h-o),100),o=h,s=0,u)){var l=performance.memory;u.update(l.usedJSHeapSize/1048576,l.jsHeapSizeLimit/1048576)}return h},update:function(){i=this.end()},domElement:t,setMode:r}};Ze.Panel=function(n,t,e){var r=1/0,i=0,o=Math.round,s=o(window.devicePixelRatio||1),a=80*s,c=48*s,u=3*s,h=2*s,l=3*s,f=15*s,p=74*s,m=30*s,d=document.createElement("canvas");d.width=a,d.height=c,d.style.cssText="width:80px;height:48px";var y=d.getContext("2d");return y.font="bold "+9*s+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=e,y.fillRect(0,0,a,c),y.fillStyle=t,y.fillText(n,u,h),y.fillRect(l,f,p,m),y.fillStyle=e,y.globalAlpha=.9,y.fillRect(l,f,p,m),{dom:d,update:function(g,x){r=Math.min(r,g),i=Math.max(i,g),y.fillStyle=e,y.globalAlpha=1,y.fillRect(0,0,a,f),y.fillStyle=t,y.fillText(o(g)+" "+n+" ("+o(r)+"-"+o(i)+")",u,h),y.drawImage(d,l+s,f,p-s,m,l,f,p-s,m),y.fillRect(l+p-s,f,s,m),y.fillStyle=e,y.globalAlpha=.9,y.fillRect(l+p-s,f,s,o((1-g/x)*m))}}};const Jh=Ze,me=new jh;me.width=400;const K={radiusScale:1,rotateSpeed:700,colorFrequency:.001,gl_FragColor:Xc.create(.5,.8,1,1),Elevation:.2,uBigWavesFrequency:{value:[4,1.5],xFrequency:4,yFrequency:1.5},scaleOfFlat:{xScale:13,yScale:13},isShow:!0,is_8k:!0,shape:"BoxGeometry",shaderAttr:"图片 + 渐变 + 上一帧画面 + 阴影"},Se={pointLight:{intensity:1,radius:5},directionalLight:{intensity:.3}},Zh={radius:.01,widthSegments:32,heightSegments:16,randomness:0},jn={skyMap:"水天一色"},So={num:5},Ue=me.addFolder("几何体形状");Ue.add(K,"rotateSpeed").min(5).max(100).step(.01).name("旋转速度");Ue.add(K,"colorFrequency").min(0).max(.01).step(1e-4).name("颜色波动频率");Ue.add(K,"isShow");const Ge=me.addFolder("平面");Ge.add(K,"Elevation").min(0).max(3).step(.01).name("波峰");Ge.add(K.uBigWavesFrequency,"xFrequency").min(0).max(10).step(.001).name("平面波动频率-X");Ge.add(K.uBigWavesFrequency,"yFrequency").min(0).max(10).step(.001).name("平面波动频率-Y");Ge.add(K.scaleOfFlat,"xScale").min(10).max(300).step(.001).name("平面放大-X");Ge.add(K.scaleOfFlat,"yScale").min(10).max(300).step(.001).name("平面放大-Y");const Ao=me.addFolder("球体");Ao.add(So,"num").min(5).max(1e6).step(1e3).name("数量");Ao.hide();const Qh=me.addFolder("天空盒");let Re=new Jh;Re.setMode(0);Re.domElement.style.position="absolute";Re.domElement.style.left="0px";Re.domElement.style.top="0px";document.body.appendChild(Re.domElement);const pt={range:new Float32Array([5e5,-5,5,-5,5,-5,5]),angle:Math.random()*Math.PI*2,radius:Math.random()*2,velocity:.001},Mn=me.addFolder("粒子"),Kh=`struct CameraViewProjectMatrix {\r
  cameraViewProjectMatrix : mat4x4<f32>,\r
}\r
\r
@binding(0) @group(0) var<storage> modelMatrix : array<mat4x4<f32>>;\r
@binding(1) @group(0) var<uniform> cameraViewProjectMatrix : CameraViewProjectMatrix;\r
@binding(2) @group(0) var<uniform> time : f32;\r
\r
\r
struct VertexOutput {\r
  @builtin(position) Position : vec4<f32>,\r
  @location(0) fragUV : vec2<f32>,\r
  @location(1) fragPosition: vec4<f32>,\r
  @location(2) fragNormal: vec4<f32>,\r
  @location(3) fragTime: f32,\r
}\r
\r
@vertex\r
fn main(\r
  @builtin(instance_index) index: u32,\r
  @location(0) position : vec3<f32>,\r
  @location(1) normal : vec3<f32>,\r
  @location(2) uv : vec2<f32>\r
) -> VertexOutput {\r
  var output : VertexOutput;\r
  output.Position = cameraViewProjectMatrix.cameraViewProjectMatrix * modelMatrix[index] * vec4<f32>(position, 1.0);\r
  output.fragUV = uv;\r
  output.fragPosition = 0.5 * (vec4<f32>(position, 1.0) + vec4(1.0, 1.0, 1.0, 1.0));\r
  output.fragNormal = vec4<f32>(normal, 1.0);\r
  output.fragTime = time;\r
  return output;\r
}\r
`,tl=`@binding(3) @group(0) var particlesImg : texture_2d<f32>;\r
@binding(4) @group(0) var particlesSampler : sampler;\r
\r
@fragment\r
fn main(\r
  @location(0) fragUV : vec2<f32>,\r
  @location(1) fragPosition: vec4<f32>,\r
  @location(2) fragNormal: vec4<f32>,\r
  @location(3) fragTime: f32,\r
) -> @location(0) vec4<f32> {\r
  // return textureSample(particlesImg, particlesSampler, fragUV);\r
\r
  return vec4(\r
    fragPosition.x * sin(fragTime*4),\r
    fragPosition.y * cos(fragTime*4),\r
    fragTime,\r
    1.0);\r
}`,el={vertexStride:8*4,positionsOffset:0,normalOffset:3*4,uvOffset:6*4};function nl(n,t=32,e=16,r=0){const i=[],o=[];t=Math.max(3,Math.floor(t)),e=Math.max(2,Math.floor(e));const s=Qt.create(),a=Qt.create(),c=Qt.create();let u=0;const h=[];for(let l=0;l<=e;l++){const f=[],p=l/e;let m=0;l===0?m=.5/t:l===e&&(m=-.5/t);for(let d=0;d<=t;d++){const y=d/t;if(d==t)Qt.copy(s,a);else if(d==0||l!=0&&l!==e){const g=n+(Math.random()-.5)*2*r*n;a[0]=-g*Math.cos(y*Math.PI*2)*Math.sin(p*Math.PI),a[1]=g*Math.cos(p*Math.PI),a[2]=g*Math.sin(y*Math.PI*2)*Math.sin(p*Math.PI),d==0&&Qt.copy(a,s)}i.push(...a),Qt.copy(a,c),Qt.normalize(c,c),i.push(...c),i.push(y+m,1-p),f.push(u++)}h.push(f)}for(let l=0;l<e;l++)for(let f=0;f<t;f++){const p=h[l][f+1],m=h[l][f],d=h[l+1][f],y=h[l+1][f+1];l!==0&&o.push(p,m,y),l!==e-1&&o.push(m,d,y)}return{vertices:new Float32Array(i),indices:new Uint16Array(o)}}async function rl(n,t,e,r){const{vertexStride:i,positionsOffset:o,normalOffset:s,uvOffset:a}=el,{radius:c,widthSegments:u,heightSegments:h,randomness:l}=Zh,{vertices:f,indices:p}=await nl(c,u,h,l),m=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),d=n.createPipelineLayout({bindGroupLayouts:[m]}),y=await n.createRenderPipelineAsync({label:"particlesGalaxyPipeLineLayout-Vertex&Fragment",layout:d,vertex:{module:n.createShaderModule({code:Kh}),entryPoint:"main",buffers:[{arrayStride:i,attributes:[{shaderLocation:0,offset:o,format:"float32x3"},{shaderLocation:1,offset:s,format:"float32x3"},{shaderLocation:2,offset:a,format:"float32x2"}]}]},fragment:{module:n.createShaderModule({code:tl}),entryPoint:"main",targets:[{format:e}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{depthCompare:"less",depthWriteEnabled:!0,format:"depth32float"}}),g=new Float32Array(r*4*4),x=n.createBuffer({size:r*4*4*4,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC|GPUBufferUsage.STORAGE}),_=n.createBuffer({size:f.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX}),v=n.createBuffer({size:p.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE|GPUBufferUsage.INDEX});for(let A=0;A<r;A++){const T=Math.random()*Math.PI*2,U=Math.random()*200,C=Ee.identity(),O=U*Math.cos(T),B=(Math.random()-.5)*2*.1,E=U*Math.sin(T),z=Math.random()*2;Ee.translate(C,[O,B,E],C),Ee.scale(C,[z,z,z],C),g.set(C,A*4*4)}n.queue.writeBuffer(x,0,g),n.queue.writeBuffer(_,0,f),n.queue.writeBuffer(v,0,p);const w=p.length;return{particlesGalaxyBindingGroupLayout:m,particlesGalaxyPipeLine:y,particlesModelBuffer:x,particlesVertexBuffer:_,particlesVertexIndexBuffer:v,sphereCount:w}}const il=`// 注意storage, read\r
@binding(0) @group(0) var<storage, read> mvpMatrix : array<mat4x4<f32>>;\r
@binding(1) @group(0) var<storage> pointColor : array<vec4<f32>>;\r
@binding(2) @group(0) var<uniform> cameraPosition : mat4x4<f32>;\r
@binding(3) @group(0) var<uniform> lightProjection : mat4x4<f32>;\r
@binding(6) @group(0) var<storage> modelMatrix: array<mat4x4<f32>>;\r
\r
\r
struct VertexOutput {\r
  @builtin(position) Position : vec4<f32>,\r
  @location(0) fragPosition: vec4<f32>,\r
  @location(1) fragColor: vec4<f32>,\r
  @location(2) shadowPos: vec3<f32>,\r
}\r
\r
@vertex\r
fn main(\r
  @builtin(instance_index) index: u32,\r
  @location(0) position : vec3<f32>,\r
  @location(1) color : vec3<f32>,\r
) -> VertexOutput {\r
  var output : VertexOutput;\r
  var pos = mvpMatrix[index] * vec4<f32>(position, 1.0);\r
  output.Position = pos;\r
  output.fragPosition = pos;\r
  output.fragColor = pointColor[index];\r
  let posFromLight: vec4<f32> = lightProjection * modelMatrix[index] * vec4<f32>(position, 1.0);\r
  // Convert shadowPos XY to (0, 1) to fit texture UV\r
  output.shadowPos = vec3<f32>(posFromLight.xy * vec2<f32>(0.5, -0.5)\r
                + vec2<f32>(0.5, 0.5), posFromLight.z);\r
  return output;\r
}\r
\r
`,ol=`@binding(2) @group(0) var<uniform> lightPosition : vec4<f32>;\r
@binding(4) @group(0) var shadowMap: texture_depth_2d;\r
@binding(5) @group(0)  var shadowSampler: sampler_comparison;\r
\r
@fragment\r
fn main(\r
  @location(0) fragPosition: vec4<f32>,\r
  @location(1) fragColor: vec4<f32>,\r
  @location(2) shadowPos: vec3<f32>,\r
) -> @location(0) vec4<f32> {\r
    // Directional Light\r
    let diffuse: f32 = max(dot(normalize(lightPosition.xyz), vec3<f32>(0,1,0)), 0.0);\r
    // add shadow factor\r
    var shadow : f32 = 0.0;\r
    // // apply Percentage-closer filtering (PCF)\r
    // // sample nearest 9 texels to smooth result\r
    let size = f32(textureDimensions(shadowMap).x);\r
    for (var y : i32 = -1 ; y <= 1 ; y = y + 1) {\r
        for (var x : i32 = -1 ; x <= 1 ; x = x + 1) {\r
            let offset = vec2<f32>(f32(x) / size, f32(y) / size);\r
            shadow = shadow + textureSampleCompare(\r
                shadowMap, \r
                shadowSampler,\r
                shadowPos.xy + offset, \r
                shadowPos.z - 0.005  // apply a small bias to avoid acne\r
            );\r
        }\r
    }\r
    shadow = shadow / 9.0;\r
    // // ambient + diffuse * shadow\r
    let lightFactor = min(0.3 + shadow, 1.0);\r
    return fragColor * lightFactor;\r
}`,sl=`@group(0) @binding(0) var<storage, read> input: array<f32, 7>;\r
@group(0) @binding(1) var<storage, read_write> velocity: array<vec4<f32>>;\r
// modelView: array<mat4x4<f32>>: 分割，使每个元素是一个 4x4 的浮点矩阵\r
@group(0) @binding(2) var<storage, read_write> modelView: array<mat4x4<f32>>;\r
@group(0) @binding(3) var<uniform> projection : mat4x4<f32>;\r
@group(0) @binding(4) var<storage, read_write> mvp : array<mat4x4<f32>>;\r
\r
const size = u32(256);\r
@compute @workgroup_size(size)\r
fn main(\r
  @builtin(global_invocation_id) GlobalInvocationID : vec3<u32>,\r
) {\r
    var index = GlobalInvocationID.x;\r
    if(index >= u32(input[0])){\r
        return;\r
    }\r
    var xMin = input[1];\r
    var xMax = input[2];\r
    var yMin = input[3];\r
    var yMax = input[4];\r
    var zMin = input[5];\r
    var zMax = input[6];\r
    // 表示从 modelView 数组的指定索引处提取出一个矩阵的第四列向量。\r
    var pos = modelView[index][3];\r
    var vel = velocity[index];\r
    // change x\r
    pos.x += vel.x;\r
    if(pos.x < xMin){\r
        pos.x = xMin;\r
        vel.x = -vel.x;\r
    }else if(pos.x > xMax){\r
        pos.x = xMax;\r
        vel.x = -vel.x;\r
    }\r
    // change y\r
    pos.y += vel.y;\r
    if(pos.y < yMin){\r
        pos.y = yMin;\r
        vel.y = -vel.y;\r
    }else if(pos.y > yMax){\r
        pos.y = yMax;\r
        vel.y = -vel.y;\r
    }\r
    // change z\r
    pos.z += vel.z;\r
    if(pos.z < zMin){\r
        pos.z = zMin;\r
        vel.z = -vel.z;\r
    }else if(pos.z > zMax){\r
        pos.z = zMax;\r
        vel.z = -vel.z;\r
    }\r
    // update velocity\r
    velocity[index] = vel;\r
    // update position in modelView matrix\r
    modelView[index][3] = pos;\r
    // update mvp\r
    mvp[index] = projection * modelView[index];\r
    // mvp[index] = mat4x4<f32>(\r
    //     vec4<f32>(0,0,0,1.0),\r
    //     vec4<f32>(0,0,0,1.0),\r
    //     vec4<f32>(0,0,0,1.0),\r
    //     vec4<f32>(0,0,0,1.0)\r
    // ) * modelView[index];\r
}\r
`;async function al(n,t,e){const r=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,texture:{sampleType:"depth"}},{binding:5,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,sampler:{type:"comparison"}},{binding:6,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}}]}),i=n.createPipelineLayout({bindGroupLayouts:[r]}),o=await n.createRenderPipelineAsync({label:"particlesPointPipeLineLayout-Vertex&Fragment",layout:i,vertex:{module:n.createShaderModule({code:il}),entryPoint:"main",buffers:[{arrayStride:6*4,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:3*4,format:"float32x3"}]}]},fragment:{module:n.createShaderModule({code:ol}),entryPoint:"main",targets:[{format:t}]},primitive:{topology:"point-list",cullMode:"back"},depthStencil:{depthCompare:"less",depthWriteEnabled:!0,format:"depth32float"}}),s=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),a=n.createPipelineLayout({bindGroupLayouts:[s]}),c=await n.createComputePipelineAsync({label:"particlesPointComputePipeLine",layout:a,compute:{module:n.createShaderModule({code:sl}),entryPoint:"main"}}),u=new Float32Array([5e5,-.5,.5,-.5,.5,-.5,.5]),h=n.createBuffer({size:u.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(h.getMappedRange()).set(u),h.unmap();const l=n.createBuffer({size:5e5*4*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),f=new Float32Array([1e-6,1e-6,1e-6,1,0,0]),p=n.createBuffer({size:6*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.VERTEX,mappedAtCreation:!0});new Float32Array(p.getMappedRange()).set(f),p.unmap();const m=n.createBuffer({size:5e5*4*4*4,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE}),d=new Float32Array(e*4*4),y=new Float32Array(e*4),g=new Float32Array(e*4);console.time("writerBuffer Particles Point");for(let w=0;w<e;w++){const M=Math.random()*Math.PI*2,A=Math.random()*2,T=Ee.identity(),U=A*Math.cos(M),C=(Math.random()-.5)*2,O=A*Math.sin(M),B=Math.random(),E=Math.random(),z=Math.random(),F=1;Ee.translate(T,[U,C,O],T),d.set(T,w*4*4),y.set(new Float32Array([B,E,z,F]),w*4),g.set(new Float32Array([B*pt.velocity,E*pt.velocity,z*pt.velocity,F]),w*4)}console.timeEnd("writerBuffer Particles Point");const x=n.createBuffer({size:5e5*4*4,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE});n.queue.writeBuffer(m,0,d);const _=n.createBuffer({size:5e5*4*4,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE});return n.queue.writeBuffer(_,0,y),n.queue.writeBuffer(l,0,g),{particlesPointBindingGroupLayout:r,particlesPointPipeLine:o,particlesVertexBuffer:p,particlesModelBuffer:m,inputBuffer:h,velocityBuffer:l,computeParticlesPointBindingGroupLayout:s,particlesPointComputePipeLine:c,particlesPointMVPMatrixBuffer:x,particlesModelArray:d,particlesPointColorBuffer:_}}const cl=`@group(0) @binding(0) var<storage> modelMatrix : array<mat4x4<f32>>;\r
@group(0) @binding(1) var<uniform> lightVPMatrix : mat4x4<f32>;\r
@group(1) @binding(0) var<uniform> time : f32;\r
// @group(0) @binding(2) var<uniform> time : f32;\r
@group(1) @binding(1) var<uniform> flatElevation : f32;\r
@group(1) @binding(2) var<uniform> uBigWavesFrequency : vec2<f32>;\r
\r
@vertex\r
fn main(\r
    @builtin(instance_index) index : u32,\r
    @location(0) position : vec3<f32>,\r
    // @location(1) normal : vec3<f32>,\r
    // @location(2) uv : vec2<f32>,\r
) -> @builtin(position) vec4<f32> {\r
    var position_Shadow: vec4<f32>;\r
    if(index == 0){\r
        position_Shadow = lightVPMatrix * modelMatrix[index] * vec4(position, 1.0);\r
    }else if(index==1){\r
        var position_model = modelMatrix[index] * vec4(position, 1.0);\r
        var elevation = sin(position_model.x * uBigWavesFrequency.x + time)\r
                * sin(position_model.z * uBigWavesFrequency.y + time)\r
                * flatElevation;\r
        var pos = vec4(\r
            position_model.x,\r
            position_model.y + elevation,\r
            position_model.z,\r
            1.0);\r
        position_Shadow = lightVPMatrix * pos;\r
    }\r
    return position_Shadow;\r
}\r
\r
        \r
`,ul=`@group(0) @binding(0) var<storage> modelMatrix : array<mat4x4<f32>>;\r
@group(0) @binding(1) var<uniform> lightVPMatrix : mat4x4<f32>;\r
@group(1) @binding(0) var<uniform> time : f32;\r
// @group(0) @binding(2) var<uniform> time : f32;\r
@group(1) @binding(1) var<uniform> flatElevation : f32;\r
@group(1) @binding(2) var<uniform> uBigWavesFrequency : vec2<f32>;\r
\r
@vertex\r
fn main(\r
    @builtin(instance_index) index : u32,\r
    @location(0) position : vec3<f32>,\r
) -> @builtin(position) vec4<f32> {\r
    var position_Shadow = lightVPMatrix * modelMatrix[index] * vec4(position, 1.0);\r
    return position_Shadow;\r
}\r
\r
        \r
`;async function hl(n,t){const e=n.createBindGroupLayout({label:"shadowDepthMapBindingGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),r=n.createBindGroupLayout({label:"shadowDepthMapBindingGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),i=n.createPipelineLayout({bindGroupLayouts:[e,r]}),o=await n.createRenderPipelineAsync({label:"shadowDepthMapPipeLine",layout:i,vertex:{module:n.createShaderModule({code:cl}),entryPoint:"main",buffers:[{arrayStride:8*4,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:3*4,format:"float32x3"},{shaderLocation:2,offset:6*4,format:"float32x2"}]}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"}}),s=await n.createRenderPipelineAsync({label:"shadowDepthMapPipeLine",layout:i,vertex:{module:n.createShaderModule({code:ul}),entryPoint:"main",buffers:[{arrayStride:3*4,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},primitive:{topology:"point-list",cullMode:"back"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"}}),a=n.createTexture({size:[8192,8192],usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,format:"depth32float"}),c=a.createView(),u=n.createSampler({compare:"less"});return{shadowDepthMapBindingGroupLayout:e,shadowDepthMapBindingGroupLayout1:r,shadowDepthMapPipeLine:o,shadowDepthMapForParticlesPointPipeLine:s,shadowDepthMapTexture:a,shadowDepthView:c,shadowDepthSampler:u}}async function ll(){const n=document.querySelector("canvas");if(!n)throw new Error("No Canvas");const t=4*16,{device:e,context:r,format:i,size:o,depthTexture:s,depthView:a}=await ia(n),c=new xu(n,Math.PI/6,.1,1e5,.05),{timeFrameDeferenceBuffer:u,flatElevationBuffer:h,threejsMeshAttrForShaderBuffer:l,flatBigWavesFrequencyBuffer:f,cameraVPMatrixBuffer:p,cubeTextureImg:m,cubeTextureImg_8k:d,particlesTextureImg:y}=await Ph(e),g=await zh(e,o),x=e.createTexture({size:[n.width,n.height],format:i,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),_={depthTexture:s,depthView:a,cubeTexture:x};var v=e.createBuffer({size:t*2,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC});let w=e.createTexture({size:o,format:i,sampleCount:4,usage:GPUTextureUsage.RENDER_ATTACHMENT});w.createView();const{SkyBoxBindGroupLayout:M,SkyBoxPipelineLayout:A,initThreeGeometryBindingGroupLayout:T,initThreeGeometryPipelineLayout:U,initflatThreeGeometryBindingGroupLayout1:C,initflatThreeGeometryBindingGroupLayout2:O,initflatThreeGeometryPipelineLayout:B}=vh(e),E=await hl(e),z=await Qc(e,i,n,A),F=e.createBindGroup({label:"SkyBoxBindingGroup",layout:M,entries:[{binding:0,resource:{buffer:z.skyBoxModelMatrixBuffer,offset:0,size:t}},{binding:1,resource:{buffer:p,offset:0,size:t}},{binding:2,resource:z.sampler},{binding:3,resource:z.skyBoxmapTexture.createView({dimension:"cube"})}]}),G=e.createBindGroup({label:"SkyBoxBindingGroup",layout:M,entries:[{binding:0,resource:{buffer:z.skyBoxModelMatrixBuffer,offset:0,size:t}},{binding:1,resource:{buffer:p,offset:0,size:t}},{binding:2,resource:z.sampler},{binding:3,resource:z.skyBoxmapTexture2.createView({dimension:"cube"})}]}),k=e.createBindGroup({label:"SkyBoxBindingGroup",layout:M,entries:[{binding:0,resource:{buffer:z.skyBoxModelMatrixBuffer,offset:0,size:t}},{binding:1,resource:{buffer:p,offset:0,size:t}},{binding:2,resource:z.sampler},{binding:3,resource:z.skyBoxmapTexture3.createView({dimension:"cube"})}]});Qh.add(jn,"skyMap",["水天一色","田野","桥"]).name("天空盒纹理");let L=K.shape;const $=async j=>{const{ThreeGeometryPipeline:Q,vertexindexFromThree:Ut,vertexBufferFromThree:gt,arrayFromThreeIndexCount:se}=await si(e,i,U,j,wh,bh,ai);return{ThreeGeometryPipeline:Q,vertexindexFromThree:Ut,vertexBufferFromThree:gt,arrayFromThreeIndexCount:se}};let{ThreeGeometryPipeline:X,vertexindexFromThree:Y,vertexBufferFromThree:ut,arrayFromThreeIndexCount:mt}=await $(L);Ue.add(ai,"topologyIsline_list").onChange(async()=>{X=(await $(L)).ThreeGeometryPipeline}).name("去除三角面");let ct=2,V=new Float32Array([ct,.1,0,0,-1,0,0,0,Se.pointLight.intensity,Se.pointLight.radius,0,0,.1,0,0,Se.directionalLight.intensity]);e.queue.writeBuffer(l,0,V);const Lt=me.addFolder("灯光");Lt.add(Se.pointLight,"intensity").min(0).max(1).step(.001).name("点光源光强").onChange(j=>{V[8]=j,e.queue.writeBuffer(l,0,V)}),Lt.add(Se.pointLight,"radius").min(0).max(10).step(.01).name("点光源光照半径").onChange(j=>{V[9]=j,e.queue.writeBuffer(l,0,V)}),Lt.add(Se.directionalLight,"intensity").min(0).max(1).step(.01).name("平行光光强").onChange(j=>{V[15]=j,e.queue.writeBuffer(l,0,V)}),Ue.add(K,"shaderAttr",["图片 + 阴影","图片 + 渐变 + 上一帧画面 + 阴影","图片 + 渐变 + 上一帧画面","上一帧画面"]).onChange(async j=>{switch(j){case"图片 + 渐变 + 上一帧画面 + 阴影":ct=1,V=await new Float32Array([ct,...V.slice(1,15)]),e.queue.writeBuffer(l,0,V);break;case"图片 + 阴影":ct=2,V=await new Float32Array([ct,...V.slice(1,15)]),e.queue.writeBuffer(l,0,V);break;case"图片 + 渐变 + 上一帧画面":ct=3,V=await new Float32Array([ct,...V.slice(1,15)]),e.queue.writeBuffer(l,0,V);break;case"上一帧画面":ct=4,V=await new Float32Array([ct,...V.slice(1,15)]),e.queue.writeBuffer(l,0,V);break}}).name("几何体贴图shader"),Ue.add(K,"shape",["BoxGeometry-立方体","CapsuleGeometry-胶囊","CircleGeometry-圆形","ConeGeometry-圆锥","CylinderGeometry-圆柱","PlaneGeometry-平面","RingGeometry-圆环","ShapeGeometry-心形","SphereGeometry-球","TorusGeometry-甜甜圈","TorusKnotGeometry-圆环结"]).onChange(async j=>{j=j.split("-")[0];const Q=await $(j);X=Q.ThreeGeometryPipeline,mt=Q.arrayFromThreeIndexCount,ut=Q.vertexBufferFromThree,Y=Q.vertexindexFromThree}).name("更换Three模型");const $t=async()=>{const{ThreeGeometryPipeline:j,vertexindexFromThree:Q,vertexBufferFromThree:Ut,arrayFromThreeIndexCount:gt}=await si(e,i,B,"PlaneGeometry",Sh,Mh,ci);return{flatThreeGeometryPipeline:j,flatVertexindexFromThree:Q,flatVertexBufferFromThree:Ut,flatArrayFromThreeIndexCount:gt}};let{flatThreeGeometryPipeline:qt,flatVertexindexFromThree:Xt,flatVertexBufferFromThree:N,flatArrayFromThreeIndexCount:Tr}=await $t();Ge.add(ci,"topologyIsline_list").onChange(async()=>{qt=(await $t()).flatThreeGeometryPipeline}).name("去除三角面");const xt=at.identity();at.translate(xt,te.create(-1,0,-3),xt),at.scale(xt,te.create(1,1,1),xt);const an=e.createBuffer({label:"threeGeometryModelMatrixBuffer",size:t,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM,mappedAtCreation:!0});new Float32Array(an.getMappedRange()).set(xt),an.unmap(),at.identity();const Er=e.createBuffer({label:"flatThreeGeometryModelMatrix",size:t,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),Po=e.createBindGroup({label:"threeGeometryBindingGroup1",layout:T,entries:[{binding:0,resource:x.createView()},{binding:1,resource:z.sampler},{binding:2,resource:{buffer:an}},{binding:3,resource:{buffer:p}},{binding:4,resource:{buffer:u}},{binding:5,resource:{buffer:g.lightPositionBuffer}},{binding:6,resource:{buffer:g.lightViewProjectionBuffer}},{binding:7,resource:{buffer:l}}]}),zo=e.createBindGroup({label:"flatThreeGeometryBindingGroup1",layout:C,entries:[{binding:0,resource:{buffer:g.lightPositionBuffer}},{binding:1,resource:{buffer:g.lightViewProjectionBuffer}},{binding:2,resource:{buffer:Er}},{binding:3,resource:{buffer:p}},{binding:4,resource:{buffer:u}},{binding:5,resource:z.sampler}]}),Br=e.createBindGroup({label:"flatThreeGeometryBindingGroup2",layout:O,entries:[{binding:0,resource:{buffer:h}},{binding:1,resource:{buffer:f}},{binding:2,resource:m.createView()},{binding:3,resource:E.shadowDepthView},{binding:4,resource:E.shadowDepthSampler},{binding:5,resource:z.sampler}]}),Co=e.createBindGroup({label:"flatThreeGeometryBindingGroup2",layout:O,entries:[{binding:0,resource:{buffer:h}},{binding:1,resource:{buffer:f}},{binding:2,resource:d.createView()},{binding:3,resource:E.shadowDepthView},{binding:4,resource:E.shadowDepthSampler},{binding:5,resource:z.sampler}]});let Or=So.num;const Ur=await rl(e,n,i,Or);e.createBindGroup({label:"particlesBindingGroup",layout:Ur.particlesGalaxyBindingGroupLayout,entries:[{binding:0,resource:{buffer:Ur.particlesModelBuffer,offset:0,size:Or*4*4*4}},{binding:1,resource:{buffer:p,offset:0,size:t}},{binding:2,resource:{buffer:u}},{binding:3,resource:y.createView()},{binding:4,resource:z.sampler}]});const lt=await al(e,i,pt.range[0]),ye={radius:1,scale:1};function cn(j=pt.range[0],Q=ye.scale){const Ut=new Float32Array(pt.range[0]*4*4),gt=new Float32Array(pt.range[0]*4),se=new Float32Array(pt.range[0]*4);console.time("writerBuffer Particles Point");for(let kt=0;kt<j;kt++){const Ht=Math.random()*Math.PI*2,un=Math.random()*ye.radius,Wt=at.identity(),rt=un*Math.cos(Ht),Bn=(Math.random()-.5)*2,_t=un*Math.sin(Ht),Rr=Math.random(),Lr=Math.random(),kr=Math.random(),Vr=1;at.translate(Wt,[rt,Bn,_t],Wt),Ut.set(Wt,kt*4*4),gt.set(new Float32Array([Rr,Lr,kr,Vr]),kt*4),se.set(new Float32Array([Rr*pt.velocity,Lr*pt.velocity,kr*pt.velocity,Vr]),kt*4)}console.timeEnd("writerBuffer Particles Point"),e.queue.writeBuffer(lt.particlesModelBuffer,0,Ut),e.queue.writeBuffer(lt.particlesPointColorBuffer,0,gt),e.queue.writeBuffer(lt.velocityBuffer,0,se),e.queue.writeBuffer(lt.inputBuffer,0,new Float32Array([pt.range[0],-.5*Q,.5*Q,-.5*Q,.5*Q,-.5*Q,.5*Q])),j!=null&&e.queue.writeBuffer(lt.inputBuffer,0,new Float32Array([j,-.5*Q,.5*Q,-.5*Q,.5*Q,-.5*Q,.5*Q]))}Mn.add(pt.range,0).min(1e4).max(16e6).step(1e4).onChange(()=>{cn(pt.range[0],ye.scale)}).name("粒子数量"),Mn.add(pt,"velocity").min(1e-4).max(.1).step(5e-5).onChange(()=>{cn()}).name("粒子速度"),Mn.add(ye,"radius").min(.2).max(.5).step(1e-4).onChange(()=>{cn()}).name("粒子移动半径"),Mn.add(ye,"scale").min(1).max(10).step(.005).onChange(j=>{cn(pt.range[0],ye.scale)}).name("缩放粒子活动范围");const To=e.createBindGroup({label:"particlesBindingGroup",layout:lt.particlesPointBindingGroupLayout,entries:[{binding:0,resource:{buffer:lt.particlesPointMVPMatrixBuffer}},{binding:1,resource:{buffer:lt.particlesPointColorBuffer}},{binding:2,resource:{buffer:g.lightPositionBuffer}},{binding:3,resource:{buffer:g.lightViewProjectionBuffer}},{binding:4,resource:E.shadowDepthView},{binding:5,resource:E.shadowDepthSampler},{binding:6,resource:{buffer:lt.particlesModelBuffer}}]}),Eo=e.createBindGroup({label:"particlesPointComputeBindingGroup",layout:lt.computeParticlesPointBindingGroupLayout,entries:[{binding:0,resource:{buffer:lt.inputBuffer}},{binding:1,resource:{buffer:lt.velocityBuffer}},{binding:2,resource:{buffer:lt.particlesModelBuffer}},{binding:3,resource:{buffer:p}},{binding:4,resource:{buffer:lt.particlesPointMVPMatrixBuffer}}]}),Bo=e.createBindGroup({label:"ShadowDepthMapBindingGroup",layout:E.shadowDepthMapBindingGroupLayout,entries:[{binding:0,resource:{buffer:v}},{binding:1,resource:{buffer:g.lightViewProjectionBuffer}}]}),Oo=e.createBindGroup({label:"ShadowDepthMapBindingGroup",layout:E.shadowDepthMapBindingGroupLayout1,entries:[{binding:0,resource:{buffer:u}},{binding:1,resource:{buffer:h}},{binding:2,resource:{buffer:f}}]}),Uo=e.createBindGroup({label:"ShadowDepthMapBindingGroup",layout:E.shadowDepthMapBindingGroupLayout,entries:[{binding:0,resource:{buffer:lt.particlesModelBuffer}},{binding:1,resource:{buffer:g.lightViewProjectionBuffer}}]});let Fr=performance.now();function Gr(){const j=performance.now();Re.update();let Q=performance.now(),Ut=(Q-Fr)/30;Fr=Q,e.queue.writeBuffer(u,0,new Float32Array([Math.abs(Math.sin(K.colorFrequency*Q))])),e.queue.writeBuffer(h,0,new Float32Array([K.Elevation])),e.queue.writeBuffer(f,0,new Float32Array([K.uBigWavesFrequency.xFrequency,K.uBigWavesFrequency.yFrequency])),at.rotateX(xt,Ut/K.rotateSpeed,xt),at.rotateY(xt,Ut/K.rotateSpeed,xt),at.rotateZ(xt,Ut/K.rotateSpeed,xt),at.scale(xt,te.create(K.radiusScale,K.radiusScale,K.radiusScale),xt),e.queue.writeBuffer(an,0,xt);const gt=at.identity();at.translate(gt,te.create(0,-5,-10),gt),at.rotateX(gt,-Math.PI/2,gt),at.rotateZ(gt,-Math.PI,gt),at.scale(gt,te.create(K.scaleOfFlat.xScale,K.scaleOfFlat.yScale,1),gt),e.queue.writeBuffer(Er,0,gt),e.queue.writeBuffer(v,0,xt),e.queue.writeBuffer(v,xt.byteLength,gt),V[4]=-1+3*Math.sin(j/1e3),V[6]=-3+3*Math.cos(j/1e3),V[12]=Math.sin(j/1500),V[14]=Math.cos(j/1500),e.queue.writeBuffer(l,0,V),c.recalculateProjection(),c.updatePos();const se=at.create();at.multiply(c.projection,c.view,se);const kt=new Float32Array(se);e.queue.writeBuffer(p,0,kt.buffer,kt.byteOffset,kt.byteLength);const Ht=e.createCommandEncoder(),un={colorAttachments:[{view:r.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:0,a:1}}],depthStencilAttachment:{view:_.depthView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},Wt=Ht.beginComputePass();Wt.setPipeline(lt.particlesPointComputePipeLine),Wt.setBindGroup(0,Eo),Wt.dispatchWorkgroups(Math.ceil(pt.range[0]/256)),Wt.end();{const Bn={colorAttachments:[],depthStencilAttachment:{view:E.shadowDepthView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},_t=Ht.beginRenderPass(Bn);_t.setPipeline(E.shadowDepthMapPipeLine),_t.setBindGroup(0,Bo),_t.setBindGroup(1,Oo),_t.setVertexBuffer(0,ut),_t.setIndexBuffer(Y,"uint16"),_t.drawIndexed(mt,1,0,0,0),_t.setVertexBuffer(0,N),_t.setIndexBuffer(Xt,"uint16"),_t.drawIndexed(Tr,1,0,0,1),_t.setPipeline(E.shadowDepthMapForParticlesPointPipeLine),_t.setBindGroup(0,Uo),_t.setVertexBuffer(0,lt.particlesVertexBuffer),_t.drawIndexed(1,pt.range[0]),_t.end()}const rt=Ht.beginRenderPass(un);rt.setPipeline(z.skyBoxPipeline),rt.setVertexBuffer(0,z.skyBoxVerticesBuffer),rt.setBindGroup(0,jn.skyMap=="水天一色"?F:jn.skyMap=="田野"?G:k),rt.draw(z.cubeVertexCount,1,0,0),rt.setPipeline(qt),rt.setVertexBuffer(0,N),rt.setIndexBuffer(Xt,"uint16"),rt.setBindGroup(0,zo),rt.setBindGroup(1,Br),rt.drawIndexed(Tr),rt.setPipeline(lt.particlesPointPipeLine),rt.setVertexBuffer(0,lt.particlesVertexBuffer),rt.setBindGroup(0,To),rt.drawIndexed(1,pt.range[0]),rt.setPipeline(X),rt.setVertexBuffer(0,ut),rt.setIndexBuffer(Y,"uint16"),rt.setBindGroup(0,Po),rt.setBindGroup(1,K.is_8k?Co:Br),K.isShow&&rt.drawIndexed(mt),rt.end(),Ht.copyTextureToTexture({texture:r.getCurrentTexture()},{texture:_.cubeTexture},[n.width,n.height]),e.queue.submit([Ht.finish()]),requestAnimationFrame(Gr)}Gr(),window.addEventListener("resize",()=>{o.width=n.width=n.clientWidth*devicePixelRatio,o.height=n.height=n.clientHeight*devicePixelRatio,_.depthTexture.destroy(),_.depthTexture=e.createTexture({size:o,format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT}),_.depthView=_.depthTexture.createView(),w.destroy(),w=e.createTexture({size:o,format:i,sampleCount:4,usage:GPUTextureUsage.RENDER_ATTACHMENT}),w.createView()})}ll();
